# 智能体自动化系统使用指南

## 📋 概述

智能体自动化系统是一个完全自动化的部署和同步系统，让您专注于智能体开发和修正，系统会自动处理所有后期动作。

---

## 🎯 核心功能

### ✅ 自动化功能

1. **自动监控**：持续监控代码变化
2. **自动提交**：检测到变化后自动提交代码
3. **自动推送**：自动推送到 GitHub
4. **自动同步**：自动同步到服务器
5. **自动部署**：自动重启 Nginx
6. **自动备份**：每次部署前自动备份

### 🎮 控制面板

提供友好的命令行控制面板，方便管理所有操作。

---

## 🚀 快速开始

### 1. 设置权限

```bash
chmod +x auto-deploy.sh
chmod +x agent-control-panel.sh
```

### 2. 启动自动化系统

```bash
./auto-deploy.sh start
```

### 3. 查看状态

```bash
./auto-deploy.sh status
```

---

## 🎛️ 控制面板使用

### 启动控制面板

```bash
./agent-control-panel.sh
```

### 菜单功能

| 选项 | 功能 | 说明 |
|------|------|------|
| 1 | 查看系统状态 | 查看自动化系统运行状态和日志 |
| 2 | 启动系统 | 启动自动化监控系统 |
| 3 | 停止系统 | 停止自动化监控系统 |
| 4 | 查看日志 | 实时查看部署日志 |
| 5 | 手动部署 | 手动触发一次部署 |
| 6 | 服务器状态 | 查看服务器运行状态 |
| 7 | 项目统计 | 查看项目统计信息 |
| 8 | 快速部署 | 快速部署（不备份） |
| 9 | 完整部署 | 完整部署（含备份） |
| 0 | 退出 | 退出控制面板 |

---

## 🔄 工作流程

### 推荐工作流程（自动化模式）

```
1. 启动自动化系统
   ./auto-deploy.sh start
   ↓
2. 编写/修改代码
   ↓
3. 系统自动检测变化
   ↓
4. 系统自动提交
   ↓
5. 系统自动推送
   ↓
6. 系统自动部署
   ↓
7. 完成 ✅
```

### 手动工作流程（手动模式）

```
1. 使用控制面板
   ./agent-control-panel.sh
   ↓
2. 选择操作
   - 快速部署（选项 8）
   - 或 完整部署（选项 9）
   ↓
3. 确认部署
   ↓
4. 等待完成
   ↓
5. 完成 ✅
```

---

## ⚙️ 配置说明

### 修改配置

编辑 `auto-deploy.sh` 文件：

```bash
# 监控目录
WATCH_DIR="/workspace/projects"

# 服务器地址
SERVER_HOST="123.56.142.143"

# 日志文件
LOG_FILE="/workspace/projects/auto-deploy.log"

# 监控间隔（秒）
WATCH_INTERVAL=30

# 部署冷却时间（秒）
DEPLOY_COOLDOWN=300
```

---

## 📊 功能详解

### 自动化系统（auto-deploy.sh）

#### 功能

- ✅ 监控代码变化
- ✅ 自动提交代码
- ✅ 推送到 GitHub
- ✅ 同步到服务器
- ✅ 重启 Nginx
- ✅ 验证部署

#### 命令

```bash
# 启动
./auto-deploy.sh start

# 停止
./auto-deploy.sh stop

# 状态
./auto-deploy.sh status

# 日志
./auto-deploy.sh logs

# 手动部署
./auto-deploy.sh deploy
```

---

### 控制面板（agent-control-panel.sh）

#### 功能

- ✅ 可视化菜单
- ✅ 查看系统状态
- ✅ 管理自动化系统
- ✅ 手动触发部署
- ✅ 查看服务器状态
- ✅ 查看项目统计

#### 启动

```bash
./agent-control-panel.sh
```

---

## 🔍 监控和日志

### 查看日志

```bash
# 方法 1：使用 auto-deploy.sh
./auto-deploy.sh logs

# 方法 2：直接查看
tail -f /workspace/projects/auto-deploy.log

# 方法 3：使用控制面板
./agent-control-panel.sh
# 选择选项 4
```

### 日志格式

```
[2024-02-01 14:30:00] [INFO] 智能体自动化系统启动
[2024-02-01 14:30:30] [INFO] 检测到文件变化
[2024-02-01 14:30:31] [INFO] 发现未提交的更改，自动提交...
[2024-02-01 14:30:32] [SUCCESS] 代码已自动提交
[2024-02-01 14:30:33] [INFO] 推送到 GitHub...
[2024-02-01 14:30:40] [SUCCESS] 已推送到 GitHub
[2024-02-01 14:30:41] [INFO] 同步到服务器...
[2024-02-01 14:30:50] [SUCCESS] 已同步到服务器
[2024-02-01 14:30:51] [INFO] 验证部署...
[2024-02-01 14:30:52] [SUCCESS] 部署验证通过
[2024-02-01 14:30:52] [SUCCESS] 自动部署完成！
```

---

## 🛡️ 安全特性

### 部署冷却时间

防止频繁部署：

- 默认冷却时间：300 秒（5 分钟）
- 在冷却时间内不会重复部署

### 错误处理

- Git 推送失败：停止部署，记录错误
- 服务器连接失败：停止部署，记录错误
- Nginx 重启失败：停止部署，记录错误

---

## 💡 使用建议

### 日常开发（推荐）

```bash
# 1. 启动自动化系统
./auto-deploy.sh start

# 2. 开始编码
# 修改代码，保存

# 3. 等待自动部署
# 系统会自动检测、提交、推送、部署

# 4. 查看日志（可选）
./auto-deploy.sh logs
```

### 重要改动

```bash
# 1. 使用控制面板
./agent-control-panel.sh

# 2. 选择完整部署（选项 9）
# 包含完整的备份流程

# 3. 确认并等待完成
```

### 紧急部署

```bash
# 直接使用快速部署脚本
./quick-deploy.sh
```

---

## 📈 性能优化

### 监控间隔调整

如果希望更快响应，减小监控间隔：

```bash
# 编辑 auto-deploy.sh
WATCH_INTERVAL=10  # 改为 10 秒
```

### 部署冷却时间调整

如果需要更频繁部署，减小冷却时间：

```bash
# 编辑 auto-deploy.sh
DEPLOY_COOLDOWN=60  # 改为 1 分钟
```

---

## ❓ 常见问题

### 问题 1：自动化系统无法启动

**原因**：权限不足

**解决**：
```bash
chmod +x auto-deploy.sh agent-control-panel.sh
```

---

### 问题 2：无法连接到服务器

**原因**：SSH 连接失败

**解决**：
```bash
# 测试连接
ssh root@123.56.142.143

# 配置 SSH 密钥
ssh-copy-id root@123.56.142.143
```

---

### 问题 3：部署频繁触发

**原因**：监控间隔太短

**解决**：
```bash
# 增加监控间隔
WATCH_INTERVAL=60  # 改为 60 秒
```

---

### 问题 4：自动提交失败

**原因**：Git 配置问题

**解决**：
```bash
# 配置 Git 用户
git config --global user.name "Your Name"
git config --global user.email "your@email.com"
```

---

## 🎯 最佳实践

### 1. 启动自动化系统

```bash
# 开发时启动
./auto-deploy.sh start

# 查看状态
./auto-deploy.sh status
```

### 2. 定期检查日志

```bash
# 使用控制面板查看
./agent-control-panel.sh
# 选择选项 4
```

### 3. 重要改动使用完整部署

```bash
./agent-control-panel.sh
# 选择选项 9
```

### 4. 遇到问题查看日志

```bash
tail -n 50 /workspace/projects/auto-deploy.log
```

---

## ✅ 总结

### 您只需要

1. ✅ 启动自动化系统
2. ✅ 专注于智能体开发
3. ✅ 系统自动处理一切

### 系统会自动

1. ✅ 监控代码变化
2. ✅ 提交代码
3. ✅ 推送到 GitHub
4. ✅ 同步到服务器
5. ✅ 部署应用
6. ✅ 验证部署

---

**开始使用，享受自动化带来的便利！** 🎉
