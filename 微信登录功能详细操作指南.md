# å¾®ä¿¡ç™»å½•åŠŸèƒ½è¯¦ç»†æ“ä½œæŒ‡å—

æœ¬æ–‡æ¡£æä¾›å¾®ä¿¡ç™»å½•åŠŸèƒ½ä»ç”³è¯·åˆ°éƒ¨ç½²çš„è¯¦ç»†æ“ä½œæ­¥éª¤ã€‚

---

## ç›®å½•

1. [å¾®ä¿¡å¼€æ”¾å¹³å°ç”³è¯·ç½‘ç«™åº”ç”¨](#ä¸€å¾®ä¿¡å¼€æ”¾å¹³å°ç”³è¯·ç½‘ç«™åº”ç”¨)
2. [è·å– AppID å’Œ AppSecret](#äºŒè·å–-appid-å’Œ-appsecret)
3. [é…ç½®ç¯å¢ƒå˜é‡](#ä¸‰é…ç½®ç¯å¢ƒå˜é‡)
4. [æœ¬åœ°æµ‹è¯•å¾®ä¿¡ç™»å½•](#å››æœ¬åœ°æµ‹è¯•å¾®ä¿¡ç™»å½•)
5. [éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ](#äº”éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ)
6. [å¸¸è§é—®é¢˜æ’æŸ¥](#å…­å¸¸è§é—®é¢˜æ’æŸ¥)

---

## ä¸€ã€å¾®ä¿¡å¼€æ”¾å¹³å°ç”³è¯·ç½‘ç«™åº”ç”¨

### 1.1 å‡†å¤‡å·¥ä½œ

åœ¨ç”³è¯·å¾®ä¿¡å¼€æ”¾å¹³å°ç½‘ç«™åº”ç”¨ä¹‹å‰ï¼Œéœ€è¦å‡†å¤‡ä»¥ä¸‹ææ–™ï¼š

- **è¥ä¸šæ‰§ç…§**ï¼šä¼ä¸šæˆ–æœºæ„çš„è¥ä¸šæ‰§ç…§æ‰«æä»¶
- **ç»„ç»‡æœºæ„ä»£ç è¯**ï¼šå¦‚æœè¥ä¸šæ‰§ç…§ä¸Šæ²¡æœ‰ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼Œéœ€è¦æä¾›
- **å¯¹å…¬é“¶è¡Œè´¦æˆ·ä¿¡æ¯**ï¼šç”¨äºéªŒè¯ä¼ä¸šèº«ä»½
- **è¿è¥è€…èº«ä»½è¯**ï¼šè´Ÿè´£è¿è¥è¯¥åº”ç”¨çš„äººå‘˜èº«ä»½è¯ä¿¡æ¯
- **è”ç³»æ–¹å¼**ï¼šæ‰‹æœºå·å’Œé‚®ç®±
- **åº”ç”¨å›¾æ ‡**ï¼šå°ºå¯¸å»ºè®® 108x108pxï¼Œæ ¼å¼ä¸º PNG
- **åº”ç”¨å®˜ç½‘åœ°å€**ï¼šç”¨äºå¤‡æ¡ˆçš„ç½‘ç«™åœ°å€

### 1.2 æ³¨å†Œå¾®ä¿¡å¼€æ”¾å¹³å°è´¦å·

**æ­¥éª¤ 1ï¼šè®¿é—®å¾®ä¿¡å¼€æ”¾å¹³å°**

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼šhttps://open.weixin.qq.com/

**æ­¥éª¤ 2ï¼šæ³¨å†Œå¼€å‘è€…è´¦å·**

1. ç‚¹å‡»å³ä¸Šè§’"æ³¨å†Œ"æŒ‰é’®
2. é€‰æ‹©"ä¼ä¸š"æˆ–"æœºæ„"è´¦å·ç±»å‹ï¼ˆä¸ªäººè´¦å·æ— æ³•åˆ›å»ºç½‘ç«™åº”ç”¨ï¼‰
3. å¡«å†™ä¼ä¸šä¿¡æ¯ï¼š
   - ä¼ä¸šåç§°
   - ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç 
   - æ³¨å†Œåœ°å€
   - è”ç³»äººä¿¡æ¯
4. ä¸Šä¼ è¥ä¸šæ‰§ç…§å’Œç»„ç»‡æœºæ„ä»£ç è¯ï¼ˆå¦‚æœ‰ï¼‰
5. å¡«å†™å¯¹å…¬é“¶è¡Œè´¦æˆ·ä¿¡æ¯ç”¨äºéªŒè¯
6. æäº¤å®¡æ ¸

**æ­¥éª¤ 3ï¼šç­‰å¾…è´¦å·å®¡æ ¸**

- å®¡æ ¸æ—¶é—´ï¼šé€šå¸¸ 1-3 ä¸ªå·¥ä½œæ—¥
- å®¡æ ¸ç»“æœä¼šé€šè¿‡çŸ­ä¿¡å’Œé‚®ä»¶é€šçŸ¥

### 1.3 åˆ›å»ºç½‘ç«™åº”ç”¨

**æ­¥éª¤ 1ï¼šç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°**

ä½¿ç”¨æ³¨å†ŒæˆåŠŸçš„è´¦å·ç™»å½•ï¼šhttps://open.weixin.qq.com/

**æ­¥éª¤ 2ï¼šè¿›å…¥ç®¡ç†ä¸­å¿ƒ**

ç™»å½•åï¼Œç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„"ç®¡ç†ä¸­å¿ƒ"

**æ­¥éª¤ 3ï¼šåˆ›å»ºç½‘ç«™åº”ç”¨**

1. åœ¨å·¦ä¾§èœå•ä¸­é€‰æ‹©"ç½‘ç«™åº”ç”¨"
2. ç‚¹å‡»"åˆ›å»ºç½‘ç«™åº”ç”¨"æŒ‰é’®
3. å¡«å†™åº”ç”¨åŸºæœ¬ä¿¡æ¯ï¼š

```
åº”ç”¨åç§°ï¼šçµå€¼ç”Ÿæ€å›­
åº”ç”¨ç®€ä»‹ï¼šåŸºäºAIçš„æ–‡åŒ–ä»·å€¼åˆ›é€ å¹³å°ï¼Œæä¾›æ™ºèƒ½å¯¹è¯ã€ç”¨æˆ·æ—…ç¨‹ç®¡ç†ã€çµå€¼ç»æµæ¨¡å‹ç­‰åŠŸèƒ½
åº”ç”¨å®˜ç½‘ï¼šhttps://your-domain.com
åº”ç”¨å›¾æ ‡ï¼šä¸Šä¼  108x108px çš„ PNG å›¾æ ‡
```

4. å¡«å†™å¼€å‘è€…ä¿¡æ¯ï¼š
   - å¼€å‘è€…åç§°
   - è”ç³»äººå§“å
   - è”ç³»äººæ‰‹æœº
   - è”ç³»äººé‚®ç®±
   - åº”ç”¨çš„æœåŠ¡ç±»ç›®ï¼šé€‰æ‹©"å·¥å…·"æˆ–"ç”Ÿæ´»æœåŠ¡"

5. æäº¤å®¡æ ¸

**æ­¥éª¤ 4ï¼šç­‰å¾…åº”ç”¨å®¡æ ¸**

- å®¡æ ¸æ—¶é—´ï¼šé€šå¸¸ 3-7 ä¸ªå·¥ä½œæ—¥
- å®¡æ ¸é€šè¿‡åä¼šåˆ†é… AppID å’Œ AppSecret

---

## äºŒã€è·å– AppID å’Œ AppSecret

### 2.1 æŸ¥çœ‹åº”ç”¨ä¿¡æ¯

**æ­¥éª¤ 1ï¼šè¿›å…¥åº”ç”¨è¯¦æƒ…é¡µ**

1. ç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°
2. è¿›å…¥"ç®¡ç†ä¸­å¿ƒ" > "ç½‘ç«™åº”ç”¨"
3. ç‚¹å‡»å·²åˆ›å»ºçš„åº”ç”¨åç§°

**æ­¥éª¤ 2ï¼šæŸ¥çœ‹ AppID å’Œ AppSecret**

åœ¨åº”ç”¨è¯¦æƒ…é¡µçš„"å¼€å‘ä¿¡æ¯"æ ‡ç­¾é¡µä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼š

```
AppIDï¼šwx1234567890abcdef
AppSecretï¼š1234567890abcdef1234567890abcdef
```

### 2.2 å®‰å…¨æç¤º

âš ï¸ **é‡è¦ï¼šAppSecret æ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œè¯·å¦¥å–„ä¿ç®¡ï¼**

- ä¸è¦å°† AppSecret æš´éœ²åœ¨å‰ç«¯ä»£ç ä¸­
- ä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚ Gitï¼‰
- å®šæœŸæ›´æ¢ AppSecret
- å¦‚æœæ³„éœ²ï¼Œç«‹å³é‡ç½®

### 2.3 å¤åˆ¶é…ç½®ä¿¡æ¯

å°†ä»¥ä¸‹ä¿¡æ¯å¤åˆ¶åˆ°è®°äº‹æœ¬ï¼Œç¨åé…ç½®æ—¶ä½¿ç”¨ï¼š

```text
AppID: wx1234567890abcdef
AppSecret: 1234567890abcdef1234567890abcdef
```

---

## ä¸‰ã€é…ç½®ç¯å¢ƒå˜é‡

### 3.1 åç«¯é…ç½®

**æ­¥éª¤ 1ï¼šç¼–è¾‘ .env æ–‡ä»¶**

åœ¨æœåŠ¡å™¨ä¸Šï¼Œç¼–è¾‘ `admin-backend/.env` æ–‡ä»¶ï¼š

```bash
cd /var/www/backend
nano .env
```

**æ­¥éª¤ 2ï¼šæ·»åŠ å¾®ä¿¡é…ç½®**

åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```env
# å¾®ä¿¡å¼€æ”¾å¹³å°é…ç½®
WECHAT_APP_ID=wx1234567890abcdef
WECHAT_APP_SECRET=1234567890abcdef1234567890abcdef
WECHAT_REDIRECT_URI=http://your-domain.com/wechat/callback
```

**é…ç½®è¯´æ˜ï¼š**

- `WECHAT_APP_ID`ï¼šä»å¾®ä¿¡å¼€æ”¾å¹³å°è·å–çš„ AppID
- `WECHAT_APP_SECRET`ï¼šä»å¾®ä¿¡å¼€æ”¾å¹³å°è·å–çš„ AppSecret
- `WECHAT_REDIRECT_URI`ï¼šå¾®ä¿¡æˆæƒåçš„å›è°ƒåœ°å€
  - æ ¼å¼ï¼š`http://your-domain.com/wechat/callback`
  - `your-domain.com` æ›¿æ¢ä¸ºä½ çš„å®é™…åŸŸå
  - å¿…é¡»ä¸å¾®ä¿¡å¼€æ”¾å¹³å°ä¸­é…ç½®çš„æˆæƒå›è°ƒåŸŸä¸€è‡´

**æ­¥éª¤ 3ï¼šä¿å­˜æ–‡ä»¶**

æŒ‰ `Ctrl + O` ä¿å­˜ï¼Œç„¶åæŒ‰ `Ctrl + X` é€€å‡º

### 3.2 å¾®ä¿¡å¼€æ”¾å¹³å°é…ç½®

**æ­¥éª¤ 1ï¼šè¿›å…¥åº”ç”¨è¯¦æƒ…é¡µ**

ç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°ï¼Œè¿›å…¥åº”ç”¨è¯¦æƒ…é¡µ

**æ­¥éª¤ 2ï¼šé…ç½®æˆæƒå›è°ƒåŸŸ**

1. åœ¨"å¼€å‘ä¿¡æ¯"æ ‡ç­¾é¡µä¸­ï¼Œæ‰¾åˆ°"æˆæƒå›è°ƒåŸŸ"
2. ç‚¹å‡»"ä¿®æ”¹"æŒ‰é’®
3. å¡«å†™å›è°ƒåŸŸåï¼ˆä¸å«åè®®å’Œè·¯å¾„ï¼‰ï¼š

```
your-domain.com
```

**æ³¨æ„ï¼š**
- ä¸è¦åŒ…å« `http://` æˆ– `https://`
- ä¸è¦åŒ…å«è·¯å¾„ï¼Œåªå¡«å†™åŸŸå
- ä¾‹å¦‚ï¼š`meiyueart.com` è€Œä¸æ˜¯ `http://meiyueart.com/wechat/callback`

**æ­¥éª¤ 3ï¼šä¿å­˜é…ç½®**

ç‚¹å‡»"ç¡®å®š"ä¿å­˜é…ç½®

### 3.3 é…ç½®éªŒè¯

**æ­¥éª¤ 1ï¼šé‡å¯åç«¯æœåŠ¡**

```bash
systemctl restart lingzhi-api
```

**æ­¥éª¤ 2ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€**

```bash
systemctl status lingzhi-api
```

ç¡®ä¿æœåŠ¡æ­£å¸¸è¿è¡Œã€‚

**æ­¥éª¤ 3ï¼šæŸ¥çœ‹æ—¥å¿—**

```bash
journalctl -u lingzhi-api -f
```

æ£€æŸ¥æ˜¯å¦æœ‰å¯åŠ¨é”™è¯¯ã€‚

---

## å››ã€æœ¬åœ°æµ‹è¯•å¾®ä¿¡ç™»å½•

### 4.1 å‡†å¤‡æµ‹è¯•ç¯å¢ƒ

ç”±äºå¾®ä¿¡å¼€æ”¾å¹³å°éœ€è¦çœŸå®çš„åŸŸåè¿›è¡Œæµ‹è¯•ï¼Œæœ¬åœ°å¼€å‘å¯ä»¥ä½¿ç”¨å†…ç½‘ç©¿é€å·¥å…·ã€‚

**æ¨èå·¥å…·ï¼š**

1. **ngrok**ï¼ˆæ¨èï¼‰
2. **frp**
3. **èŠ±ç”Ÿå£³**

### 4.2 ä½¿ç”¨ ngrok è¿›è¡Œæœ¬åœ°æµ‹è¯•

**æ­¥éª¤ 1ï¼šå®‰è£… ngrok**

è®¿é—® https://ngrok.com/ æ³¨å†Œè´¦å·å¹¶ä¸‹è½½ ngrok

**æ­¥éª¤ 2ï¼šå¯åŠ¨ ngrok**

```bash
./ngrok http 3000
```

å¯åŠ¨åä¼šæ˜¾ç¤ºï¼š

```
Forwarding   https://abc123.ngrok.io -> http://localhost:3000
```

**æ­¥éª¤ 3ï¼šå¤åˆ¶ä¸´æ—¶åŸŸå**

å¤åˆ¶ä¸´æ—¶åŸŸåï¼Œä¾‹å¦‚ï¼š`abc123.ngrok.io`

**æ­¥éª¤ 4ï¼šé…ç½®æœ¬åœ°ç¯å¢ƒ**

åœ¨ `web-app/.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```env
VITE_API_BASE_URL=http://localhost:8001
```

**æ­¥éª¤ 5ï¼šé…ç½®å¾®ä¿¡å¼€æ”¾å¹³å°æµ‹è¯•å›è°ƒ**

åœ¨å¾®ä¿¡å¼€æ”¾å¹³å°ä¸­ï¼Œå°†æˆæƒå›è°ƒåŸŸè®¾ç½®ä¸ºï¼š

```
abc123.ngrok.io
```

**æ­¥éª¤ 6ï¼šå¯åŠ¨å‰ç«¯æœåŠ¡**

```bash
cd web-app
npm run dev
```

**æ­¥éª¤ 7ï¼šå¯åŠ¨åç«¯æœåŠ¡**

```bash
cd admin-backend
python3 app.py
```

### 4.3 æµ‹è¯•å¾®ä¿¡ç™»å½•æµç¨‹

**æ­¥éª¤ 1ï¼šè®¿é—®æœ¬åœ°ç½‘ç«™**

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttp://localhost:3000

**æ­¥éª¤ 2ï¼šè¿›å…¥ç™»å½•é¡µé¢**

ç‚¹å‡»"ç™»å½•"æŒ‰é’®

**æ­¥éª¤ 3ï¼šç‚¹å‡»å¾®ä¿¡ç™»å½•**

ç‚¹å‡»"å¾®ä¿¡ç™»å½•"æŒ‰é’®

**æ­¥éª¤ 4ï¼šæ‰«ç æˆæƒ**

æ‰‹æœºæ‰«æäºŒç»´ç ï¼Œç¡®è®¤æˆæƒ

**æ­¥éª¤ 5ï¼šéªŒè¯ç™»å½•æˆåŠŸ**

æ£€æŸ¥æ˜¯å¦æˆåŠŸç™»å½•ï¼Œå¹¶è·³è½¬åˆ°é¦–é¡µæˆ–ä¿¡æ¯å®Œå–„é¡µé¢

### 4.4 æµ‹è¯•ä¿¡æ¯å®Œå–„æµç¨‹

**æ­¥éª¤ 1ï¼šæ£€æŸ¥æ˜¯å¦è·³è½¬åˆ°ä¿¡æ¯å®Œå–„é¡µé¢**

å¦‚æœæ˜¯é¦–æ¬¡å¾®ä¿¡ç™»å½•ï¼Œåº”è¯¥è‡ªåŠ¨è·³è½¬åˆ° `/complete-profile` é¡µé¢

**æ­¥éª¤ 2ï¼šå¡«å†™ä¿¡æ¯**

å¡«å†™çœŸå®å§“åå’Œæ‰‹æœºå·ï¼ˆå¿…å¡«ï¼‰ï¼Œä»¥åŠå…¶ä»–ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰

**æ­¥éª¤ 3ï¼šæäº¤ä¿¡æ¯**

ç‚¹å‡»"æäº¤ä¿¡æ¯"æŒ‰é’®

**æ­¥éª¤ 4ï¼šéªŒè¯æˆåŠŸ**

éªŒè¯æ˜¯å¦æˆåŠŸæäº¤ï¼Œå¹¶è·³è½¬åˆ°é¦–é¡µ

---

## äº”ã€éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### 5.1 åŸŸåå‡†å¤‡

**æ­¥éª¤ 1ï¼šè´­ä¹°åŸŸå**

åœ¨é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰å¹³å°è´­ä¹°åŸŸåï¼Œä¾‹å¦‚ï¼š`meiyueart.com`

**æ­¥éª¤ 2ï¼šåŸŸåå¤‡æ¡ˆ**

å¦‚æœä½ çš„æœåŠ¡å™¨åœ¨ä¸­å›½å¤§é™†ï¼Œéœ€è¦å®ŒæˆåŸŸå ICP å¤‡æ¡ˆ

**æ­¥éª¤ 3ï¼šDNS è§£æé…ç½®**

æ·»åŠ  DNS è§£æè®°å½•ï¼Œå°†åŸŸåæŒ‡å‘æœåŠ¡å™¨ IPï¼š

```
ç±»å‹ï¼šA
ä¸»æœºè®°å½•ï¼š@
è®°å½•å€¼ï¼š123.56.142.143
```

### 5.2 SSL è¯ä¹¦é…ç½®ï¼ˆæ¨èï¼‰

**æ­¥éª¤ 1ï¼šç”³è¯·å…è´¹ SSL è¯ä¹¦**

ä½¿ç”¨ Let's Encrypt ç”³è¯·å…è´¹ SSL è¯ä¹¦ï¼š

```bash
# å®‰è£… certbot
apt-get install certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦
certbot --nginx -d meiyueart.com -d www.meiyueart.com
```

**æ­¥éª¤ 2ï¼šéªŒè¯è¯ä¹¦**

è®¿é—® https://meiyueart.com éªŒè¯è¯ä¹¦æ˜¯å¦æ­£å¸¸

### 5.3 éƒ¨ç½²åç«¯ä»£ç 

**æ­¥éª¤ 1ï¼šä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨**

```bash
# ä½¿ç”¨ rsync ä¸Šä¼ ä»£ç 
rsync -avz --delete \
    -e "sshpass -e ssh -o StrictHostKeyChecking=no" \
    "admin-backend/" \
    "root@123.56.142.143:/var/www/backend/"
```

**æ­¥éª¤ 2ï¼šæ›´æ–° .env æ–‡ä»¶**

åœ¨æœåŠ¡å™¨ä¸Šç¼–è¾‘ `/var/www/backend/.env` æ–‡ä»¶ï¼š

```bash
nano /var/www/backend/.env
```

ç¡®ä¿åŒ…å«ä»¥ä¸‹é…ç½®ï¼š

```env
# å¾®ä¿¡å¼€æ”¾å¹³å°é…ç½®
WECHAT_APP_ID=wx1234567890abcdef
WECHAT_APP_SECRET=1234567890abcdef1234567890abcdef
WECHAT_REDIRECT_URI=https://meiyueart.com/wechat/callback
```

**æ³¨æ„ï¼š** ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ HTTPS

**æ­¥éª¤ 3ï¼šå®‰è£…ä¾èµ–**

```bash
cd /var/www/backend
pip3 install -r requirements.txt
```

**æ­¥éª¤ 4ï¼šé‡å¯åç«¯æœåŠ¡**

```bash
systemctl restart lingzhi-api
```

**æ­¥éª¤ 5ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€**

```bash
systemctl status lingzhi-api
journalctl -u lingzhi-api -n 50
```

### 5.4 éƒ¨ç½²å‰ç«¯ä»£ç 

**æ­¥éª¤ 1ï¼šæ„å»ºå‰ç«¯**

```bash
cd web-app
npm run build
```

**æ­¥éª¤ 2ï¼šä¸Šä¼ æ„å»ºäº§ç‰©**

```bash
# ä½¿ç”¨ rsync ä¸Šä¼ 
rsync -avz --delete \
    -e "sshpass -e ssh -o StrictHostKeyChecking=no" \
    "dist/" \
    "root@123.56.142.143:/var/www/html/"
```

**æ­¥éª¤ 3ï¼šé…ç½® Nginx**

ç¼–è¾‘ Nginx é…ç½®æ–‡ä»¶ï¼š

```bash
nano /etc/nginx/sites-available/meiyueart.com
```

æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```nginx
server {
    listen 80;
    server_name meiyueart.com www.meiyueart.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/html;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯ API ä»£ç†
    location /api/ {
        proxy_pass http://localhost:8001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# HTTPS é…ç½®ï¼ˆå¦‚æœå·²é…ç½® SSLï¼‰
server {
    listen 443 ssl http2;
    server_name meiyueart.com www.meiyueart.com;

    ssl_certificate /etc/letsencrypt/live/meiyueart.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/meiyueart.com/privkey.pem;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/html;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯ API ä»£ç†
    location /api/ {
        proxy_pass http://localhost:8001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# HTTP é‡å®šå‘åˆ° HTTPS
server {
    listen 80;
    server_name meiyueart.com www.meiyueart.com;
    return 301 https://$server_name$request_uri;
}
```

**æ­¥éª¤ 4ï¼šæµ‹è¯•å¹¶é‡å¯ Nginx**

```bash
# æµ‹è¯•é…ç½®
nginx -t

# é‡å¯ Nginx
systemctl restart nginx
```

### 5.5 é…ç½®å¾®ä¿¡å¼€æ”¾å¹³å°ç”Ÿäº§å›è°ƒ

**æ­¥éª¤ 1ï¼šæ›´æ–°æˆæƒå›è°ƒåŸŸ**

åœ¨å¾®ä¿¡å¼€æ”¾å¹³å°ä¸­ï¼Œå°†æˆæƒå›è°ƒåŸŸè®¾ç½®ä¸ºï¼š

```
meiyueart.com
```

**æ­¥éª¤ 2ï¼šæ›´æ–°ç¯å¢ƒå˜é‡**

åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–° `/var/www/backend/.env`ï¼š

```env
WECHAT_REDIRECT_URI=https://meiyueart.com/wechat/callback
```

**æ­¥éª¤ 3ï¼šé‡å¯åç«¯æœåŠ¡**

```bash
systemctl restart lingzhi-api
```

### 5.6 ç”Ÿäº§ç¯å¢ƒæµ‹è¯•

**æ­¥éª¤ 1ï¼šè®¿é—®ç”Ÿäº§ç½‘ç«™**

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttps://meiyueart.com

**æ­¥éª¤ 2ï¼šæµ‹è¯•å¾®ä¿¡ç™»å½•**

1. ç‚¹å‡»"ç™»å½•"
2. ç‚¹å‡»"å¾®ä¿¡ç™»å½•"
3. æ‰«ç æˆæƒ
4. éªŒè¯ç™»å½•æˆåŠŸ

**æ­¥éª¤ 3ï¼šæµ‹è¯•ä¿¡æ¯å®Œå–„**

1. é¦–æ¬¡å¾®ä¿¡ç™»å½•åï¼Œæ£€æŸ¥æ˜¯å¦è·³è½¬åˆ°ä¿¡æ¯å®Œå–„é¡µé¢
2. å¡«å†™ä¿¡æ¯å¹¶æäº¤
3. éªŒè¯æˆåŠŸæäº¤

**æ­¥éª¤ 4ï¼šæµ‹è¯•åŠŸèƒ½å®Œæ•´æ€§**

1. æµ‹è¯•å……å€¼åŠŸèƒ½
2. æµ‹è¯•æç°åŠŸèƒ½
3. æµ‹è¯•å…¶ä»–éœ€è¦å®Œå–„ä¿¡æ¯çš„æ“ä½œ

### 5.7 ç›‘æ§å’Œæ—¥å¿—

**æ­¥éª¤ 1ï¼šæŸ¥çœ‹åç«¯æ—¥å¿—**

```bash
journalctl -u lingzhi-api -f
```

**æ­¥éª¤ 2ï¼šæŸ¥çœ‹ Nginx æ—¥å¿—**

```bash
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

**æ­¥éª¤ 3ï¼šè®¾ç½®æ—¥å¿—è½®è½¬**

ç¼–è¾‘ `/etc/logrotate.d/lingzhi-api`ï¼š

```
/var/log/lingzhi-api/*.log {
    daily
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 root root
    sharedscripts
    postrotate
        systemctl reload lingzhi-api
    endscript
}
```

---

## å…­ã€å¸¸è§é—®é¢˜æ’æŸ¥

### 6.1 æˆæƒå¤±è´¥ï¼šredirect_uri å‚æ•°é”™è¯¯

**é—®é¢˜ï¼š**
å¾®ä¿¡æˆæƒæ—¶æç¤º "redirect_uri å‚æ•°é”™è¯¯"

**åŸå› ï¼š**
- å›è°ƒåœ°å€ä¸å¾®ä¿¡å¼€æ”¾å¹³å°é…ç½®ä¸ä¸€è‡´
- URL ç¼–ç é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `WECHAT_REDIRECT_URI` æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿ä¸å¾®ä¿¡å¼€æ”¾å¹³å°ä¸­çš„æˆæƒå›è°ƒåŸŸä¸€è‡´
3. æ£€æŸ¥æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦éœ€è¦ URL ç¼–ç 

### 6.2 æˆæƒå¤±è´¥ï¼šAppID æˆ– AppSecret é”™è¯¯

**é—®é¢˜ï¼š**
å¾®ä¿¡æˆæƒæ—¶æç¤º "AppID æˆ– AppSecret é”™è¯¯"

**åŸå› ï¼š**
- AppID æˆ– AppSecret é…ç½®é”™è¯¯
- AppSecret æ³„éœ²åè¢«é‡ç½®

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„é…ç½®æ˜¯å¦æ­£ç¡®
2. ç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°ï¼ŒæŸ¥çœ‹ AppID å’Œ AppSecret
3. å¦‚æœ AppSecret æ³„éœ²ï¼Œåœ¨å¾®ä¿¡å¼€æ”¾å¹³å°é‡ç½®
4. é‡å¯åç«¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ

### 6.3 æ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯

**é—®é¢˜ï¼š**
å¾®ä¿¡æˆæƒæˆåŠŸï¼Œä½†æ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯

**åŸå› ï¼š**
- scope é…ç½®ä¸æ­£ç¡®
- ç”¨æˆ·å–æ¶ˆäº†æˆæƒ
- access_token è¿‡æœŸ

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥åç«¯ä»£ç ä¸­çš„ scope æ˜¯å¦åŒ…å« `snsapi_userinfo`
2. å¼•å¯¼ç”¨æˆ·é‡æ–°æˆæƒ
3. æ£€æŸ¥ access_token è·å–é€»è¾‘

### 6.4 å›è°ƒåœ°å€æ— æ³•è®¿é—®

**é—®é¢˜ï¼š**
å¾®ä¿¡æˆæƒæˆåŠŸï¼Œä½†å›è°ƒåœ°å€æ— æ³•è®¿é—®

**åŸå› ï¼š**
- æœåŠ¡å™¨é˜²ç«å¢™æœªå¼€æ”¾ç«¯å£
- Nginx é…ç½®é”™è¯¯
- åŸŸåè§£ææœªç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œå¼€æ”¾ç›¸åº”ç«¯å£
2. æ£€æŸ¥ Nginx é…ç½®ï¼Œç¡®ä¿è·¯ç”±æ­£ç¡®
3. æ£€æŸ¥åŸŸå DNS è§£ææ˜¯å¦ç”Ÿæ•ˆ
4. ä½¿ç”¨ `curl` æµ‹è¯•å›è°ƒåœ°å€æ˜¯å¦å¯è®¿é—®

### 6.5 æ•°æ®åº“é”™è¯¯ï¼šå­—æ®µä¸å­˜åœ¨

**é—®é¢˜ï¼š**
è¿è¡Œæ—¶æç¤ºæ•°æ®åº“å­—æ®µä¸å­˜åœ¨

**åŸå› ï¼š**
- æ•°æ®åº“æœªæ›´æ–°
- å­—æ®µæ·»åŠ å¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥æ•°æ®åº“è¡¨ç»“æ„
2. æ‰‹åŠ¨æ·»åŠ ç¼ºå¤±å­—æ®µï¼š
```sql
ALTER TABLE users ADD COLUMN login_type TEXT DEFAULT 'phone';
ALTER TABLE users ADD COLUMN wechat_openid TEXT UNIQUE;
ALTER TABLE users ADD COLUMN wechat_unionid TEXT;
ALTER TABLE users ADD COLUMN wechat_nickname TEXT;
ALTER TABLE users ADD COLUMN wechat_avatar TEXT;
```
3. åˆ›å»º user_profiles è¡¨ï¼š
```sql
CREATE TABLE user_profiles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER UNIQUE NOT NULL,
    real_name TEXT,
    phone TEXT UNIQUE,
    email TEXT UNIQUE,
    id_card TEXT,
    bank_account TEXT,
    bank_name TEXT,
    address TEXT,
    is_completed BOOLEAN DEFAULT 0,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### 6.6 å‰ç«¯æ„å»ºé”™è¯¯

**é—®é¢˜ï¼š**
å‰ç«¯æ„å»ºæ—¶å‡ºç° TypeScript é”™è¯¯

**åŸå› ï¼š**
- ä¾èµ–æœªå®‰è£…
- ç±»å‹å®šä¹‰é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
1. å®‰è£…ä¾èµ–ï¼š
```bash
cd web-app
npm install
```
2. æ£€æŸ¥ TypeScript é…ç½®
3. ä¿®å¤ç±»å‹é”™è¯¯

---

## ä¸ƒã€é™„å½•

### 7.1 å¾®ä¿¡å¼€æ”¾å¹³å°ç›¸å…³é“¾æ¥

- å¾®ä¿¡å¼€æ”¾å¹³å°ï¼šhttps://open.weixin.qq.com/
- å¾®ä¿¡ç™»å½•æ–‡æ¡£ï¼šhttps://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html
- å¼€å‘è€…ç¤¾åŒºï¼šhttps://developers.weixin.qq.com/community

### 7.2 æœåŠ¡å™¨é…ç½®è¦æ±‚

**æœ€ä½é…ç½®ï¼š**
- CPU: 1æ ¸
- å†…å­˜: 2GB
- ç¡¬ç›˜: 40GB
- å¸¦å®½: 5Mbps

**æ¨èé…ç½®ï¼š**
- CPU: 2æ ¸
- å†…å­˜: 4GB
- ç¡¬ç›˜: 80GB
- å¸¦å®½: 10Mbps

### 7.3 ç¯å¢ƒä¾èµ–

**åç«¯ä¾èµ–ï¼š**
- Python 3.13+
- Flask 3.0.0
- å…¶ä»–ä¾èµ–è§ `requirements.txt`

**å‰ç«¯ä¾èµ–ï¼š**
- Node.js 18+
- npm 9+

### 7.4 å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] AppSecret å·²å¦¥å–„ä¿ç®¡ï¼Œæœªæš´éœ²åœ¨å‰ç«¯ä»£ç ä¸­
- [ ] .env æ–‡ä»¶æœªæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
- [ ] ä½¿ç”¨ HTTPS ä¼ è¾“æ•æ„Ÿæ•°æ®
- [ ] å®šæœŸæ›´æ¢ AppSecret
- [ ] é…ç½®é˜²ç«å¢™è§„åˆ™
- [ ] å®šæœŸå¤‡ä»½æ•°æ®åº“
- [ ] è®¾ç½®æ—¥å¿—è½®è½¬
- [ ] ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€

### 7.5 æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜ä¼˜åŒ–**
   - ä½¿ç”¨ Redis ç¼“å­˜ access_token
   - ç¼“å­˜ç”¨æˆ·ä¿¡æ¯

2. **æ•°æ®åº“ä¼˜åŒ–**
   - æ·»åŠ ç´¢å¼•
   - å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

3. **å‰ç«¯ä¼˜åŒ–**
   - å¯ç”¨ CDN
   - å‹ç¼©é™æ€èµ„æº
   - ä½¿ç”¨æ‡’åŠ è½½

4. **æœåŠ¡å™¨ä¼˜åŒ–**
   - ä½¿ç”¨ Nginx åå‘ä»£ç†
   - å¯ç”¨ gzip å‹ç¼©
   - é…ç½®ç¼“å­˜å¤´

---

## æ€»ç»“

æŒ‰ç…§æœ¬æŒ‡å—çš„æ­¥éª¤ï¼Œæ‚¨å¯ä»¥æˆåŠŸå®Œæˆï¼š

1. âœ… åœ¨å¾®ä¿¡å¼€æ”¾å¹³å°ç”³è¯·ç½‘ç«™åº”ç”¨
2. âœ… è·å– AppID å’Œ AppSecret
3. âœ… é…ç½®ç¯å¢ƒå˜é‡
4. âœ… æœ¬åœ°æµ‹è¯•å¾®ä¿¡ç™»å½•æµç¨‹
5. âœ… éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

å¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒ"å¸¸è§é—®é¢˜æ’æŸ¥"ç« èŠ‚ï¼Œæˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚

ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰
