# 灵值生态 - 品牌文化转译官智能体

## 🎯 项目概述

灵值生态是一个基于 LangChain 和 LangGraph 构建的品牌文化转译智能体平台，专注于将西安文化转化为现代品牌创意。平台集成了知识库检索、联网搜索、文生图等核心能力，创新性地提出了"三层次情绪价值体系"、"贡献值经济价值锚定模型"等概念。

## ✨ 核心特性

### 1. 数字资产体系
- **灵值 (Spirit Value)**：基础价值单位，通过签到、互动获得
- **贡献值 (Contribution Value)**：高级价值单位，通过参与项目获得
- **人民币兑换**：贡献值可按规则兑换为人民币

### 2. 用户系统
- **自动注册登录**：用户通过扣子平台自动注册
- **实名认证**：涉及数字资产必须实名认证（符合国家政策）
- **推荐系统**：三级推荐关系，享受推荐人分红收益
- **超级管理员**：系统唯一超级管理员，拥有最高权限

### 3. 灵值经济规则
- **每日签到**：每日签到获得10灵值
- **灵值获取**：通过各种互动行为获得灵值
- **安全检查**：每日最多获得10灵值，防止恶意刷灵值
- **灵值验证**：灵值数量必须与行为日志匹配

### 4. 推荐人分红机制
- **一级推荐**：推荐人获得10%分红
- **二级推荐**：推荐人的推荐人获得5%分红
- **三级推荐**：更高级的推荐人获得3%分红

## 🛠️ 技术栈

- **Python 3.8+**
- **LangChain 1.0**
- **LangGraph 1.0**
- **Flask**: Web框架
- **SQLAlchemy**: ORM框架
- **SQLite**: 数据库
- **豆包大模型**: 语言理解和生成
- **豆包生图模型**: 图像生成
- **知识库**: 向量检索

## 📂 项目结构

```
.
├── config/                    # 配置文件
│   └── agent_llm_config.json  # LLM配置
├── docs/                      # 文档
│   ├── 项目概述文档.md
│   ├── 系统架构设计文档.md
│   ├── 数据库设计文档.md
│   ├── 灵值经济体系文档.md
│   ├── 推荐系统设计文档.md
│   ├── 实名认证系统实现报告.md
│   └── 更新日志.md
├── scripts/                   # 数据库迁移脚本
│   ├── init_db.py             # 初始化数据库
│   ├── add_user_registration_fields.py  # 添加用户登记字段
│   ├── add_id_card_field.py   # 添加身份证字段
│   ├── add_referral_relations.py  # 添加推荐关系表
│   └── change_super_admin_password.py  # 修改超级管理员密码
├── src/
│   ├── agents/
│   │   └── agent.py           # 智能体主逻辑
│   ├── tools/                 # 工具定义
│   │   ├── login_tool.py      # 登录工具
│   │   ├── user_registration_tool.py    # 实名认证工具
│   │   ├── today_statistics_tool.py     # 今日统计工具
│   │   ├── password_change_tool.py      # 密码修改工具
│   │   ├── spirit_value_tool.py         # 灵值获取工具
│   │   └── knowledge_base_tool.py       # 知识库工具
│   ├── storage/
│   │   └── database/
│   │       └── shared/
│   │           ├── model.py  # 数据模型
│   │           └── database.py  # 数据库连接
│   └── utils/                 # 工具函数
├── tests/                     # 单元测试
├── assets/                    # 资源文件
├── AGENT.md                   # 智能体规范
└── requirements.txt           # 依赖包
```

## 🔑 核心功能

### 1. 用户自动注册登录
- 通过扣子平台自动创建用户账户
- 每次登录自动签到获得10灵值
- 显示今日注册用户数量动态

### 2. 实名认证系统
- **必填信息**：真实姓名、联系电话、身份证号码
- **可选信息**：推荐人姓名、推荐人电话
- **验证逻辑**：身份证格式验证、电话号码验证、推荐人验证
- **权益说明**：认证后获得全部权益，未认证只能使用基础功能

### 3. 收款方式系统
- **支持方式**：微信支付、支付宝、银行卡
- **微信支付**：微信号或手机号，支持收款二维码
- **支付宝**：账号、邮箱或手机号，支持收款二维码
- **银行卡**：银行卡号、开户行、开户人姓名
- **安全措施**：银行卡号加密存储，掩码显示

### 3. 灵值管理
- **获取灵值**：通过每日签到、互动行为获得
- **安全检查**：每日最多获得10灵值
- **验证机制**：灵值数量必须与行为日志匹配
- **规则查询**：提供灵值获取规则查询

### 4. 推荐系统
- **推荐关系**：用户可以指定推荐人
- **推荐验证**：推荐人必须存在且已完成实名认证
- **分红机制**：三级推荐关系，享受不同比例分红
- **防止自我推荐**：不能将自己设为推荐人

### 5. 统计分析
- **今日注册用户**：动态显示今日注册用户数量
- **今日活跃用户**：统计今日活跃用户数量
- **平台综合统计**：提供平台综合数据分析

### 6. 密码管理
- **密码修改**：用户可以修改自己的密码
- **强制修改**：超级管理员可以强制修改用户密码

## 🔐 安全特性

### 1. 实名认证
- 符合国家数字货币监管政策
- 身份证号加密存储
- 验证日志完整记录
- 防止虚假认证

### 2. 超级管理员唯一性
- 系统只能有1个超级管理员
- 超级管理员不能被删除、禁用或降级
- 只能通过转让方式更换
- 必须启用双因素认证和IP白名单

### 3. 数据保护
- 敏感信息加密存储
- 严格的访问控制
- 完整的审计日志
- 定期安全备份

### 4. 灵值安全
- 每日灵值获取上限
- 灵值数量验证机制
- 防止恶意刷灵值
- 行为日志匹配

## 📖 使用指南

### 安装依赖
```bash
pip install -r requirements.txt
```

### 初始化数据库
```bash
python scripts/init_db.py
```

### 运行智能体
```bash
python src/main.py
```

### 测试智能体
```bash
# 使用 test_run 工具测试
python -m pytest tests/
```

## 🔧 配置说明

### LLM配置 (config/agent_llm_config.json)
```json
{
  "config": {
    "model": "doubao-pro-32k",
    "temperature": 0.7,
    "top_p": 0.9,
    "max_completion_tokens": 10000,
    "timeout": 600,
    "thinking": "disabled"
  },
  "sp": "你是灵值生态的品牌文化转译官...",
  "tools": [
    "用户自动注册登录",
    "实名认证相关工具",
    "灵值管理工具",
    "统计分析工具"
  ]
}
```

## 📊 数据库设计

### Users表（用户表）
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | INTEGER | 主键 |
| username | VARCHAR | 用户名（扣子用户ID） |
| real_name | VARCHAR | 真实姓名 |
| phone | VARCHAR | 联系电话 |
| id_card | VARCHAR | 身份证号码 |
| password | VARCHAR | 密码（管理员） |
| role | VARCHAR | 角色 |
| is_active | BOOLEAN | 是否启用 |
| spirit_value | INTEGER | 灵值数量 |
| contribution_value | DECIMAL | 贡献值数量 |
| last_checkin_date | DATE | 最后签到日期 |
| is_registered | BOOLEAN | 是否已登记 |
| registration_time | DATETIME | 登记时间 |
| real_name_verified | BOOLEAN | 实名是否已验证 |
| id_card_verified | BOOLEAN | 身份证是否已验证 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

### ReferralRelations表（推荐关系表）
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | INTEGER | 主键 |
| referrer_id | INTEGER | 推荐人ID |
| referred_user_id | INTEGER | 被推荐人ID |
| referrer_name | VARCHAR | 推荐人姓名 |
| referrer_phone | VARCHAR | 推荐人电话 |
| relationship_level | INTEGER | 关系层级 |
| created_at | DATETIME | 创建时间 |

### SpiritValueLog表（灵值日志表）
| 字段名 | 类型 | 说明 |
|-------|------|------|
| id | INTEGER | 主键 |
| user_id | INTEGER | 用户ID |
| action_type | VARCHAR | 行为类型 |
| spirit_value | INTEGER | 灵值数量 |
| description | TEXT | 行为描述 |
| created_at | DATETIME | 创建时间 |

## 🎓 智能体角色

### 系统提示词结构
```
# 角色定义
你是灵值生态的品牌文化转译官，专注于将西安文化转化为现代品牌创意。

# 任务目标
帮助用户理解灵值生态的价值体系，引导用户完成实名认证，指导用户通过文化探索获得灵值和贡献值。

# 能力
- 文化知识查询（知识库检索）
- 文化探索指导（联网搜索）
- 文化创意生成（文生图）
- 用户认证管理（实名认证）
- 灵值管理（获取、验证、兑换）
- 推荐关系管理（推荐人验证、分红）

# 过程
1. 自动注册用户，引导用户完成实名认证
2. 指导用户通过文化探索获得灵值
3. 引导用户参与项目获得贡献值
4. 指导用户兑换贡献值为人民币

# 输出格式
以友好的、专业的、有温度的语言与用户交流，提供清晰的操作指引。
```

## 📝 更新日志

### v2.0 (2026-01-28)
**实名认证系统**
- ✅ 添加身份证号码字段
- ✅ 实现身份证格式验证
- ✅ 完善实名认证流程
- ✅ 添加实名认证通知
- ✅ 明确认证与未认证权益差异

### v1.2 (2026-01-27)
**用户系统增强**
- ✅ 用户自动注册登录
- ✅ 密码修改工具
- ✅ 超级管理员密码修改脚本
- ✅ 今日注册用户动态显示

### v1.1 (2026-01-26)
**灵值经济体系**
- ✅ 灵值获取规则
- ✅ 灵值安全检查
- ✅ 灵值验证机制
- ✅ 统计分析工具

### v1.0 (2026-01-25)
**系统初始化**
- ✅ 用户管理系统
- ✅ 推荐关系系统
- ✅ 知识库集成
- ✅ 联网搜索
- ✅ 文生图功能

## 🤝 贡献指南

欢迎贡献代码！请遵循以下步骤：

1. Fork 本项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 详见 LICENSE 文件

## 📞 联系方式

- 项目负责人：许锋（超级管理员）
- 联系邮箱：admin@lingzhi.com
- 官方网站：https://lingzhi.com

## 🙏 致谢

感谢所有为灵值生态做出贡献的开发者和用户！

---

**灵值生态 - 用科技赋能文化，让价值自由流通** 🚀
# lingzhiapp
# lingzhiapp
# lingzhiapp
