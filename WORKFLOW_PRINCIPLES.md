# 工作流程原则 - 灵值生态园智能体系统

**版本**: 2.0
**生效日期**: 2026-02-22
**最后更新**: 2026-02-22

---

## 核心原则

### 1. 生产环境强制测试原则 ⚠️ **最高优先级**

**原则**: 所有功能开发和修复必须在生产环境（meiyueart.com）进行至少1次完整测试，才算完成部署。

#### 1.1 环境定义

**容器/本地环境**:
- 地址: localhost、127.0.0.1
- 用途: 代码开发、单元测试、集成测试
- **限制**: 不能替代生产环境测试

**生产环境**:
- 地址: https://meiyueart.com
- 用途: 最终验证、真实用户测试
- **要求**: 所有功能必须在此环境通过测试

#### 1.2 测试流程

**开发阶段**:
1. 在容器/本地环境中进行开发和单元测试
2. 确保代码质量，修复明显的bug
3. 准备测试用例

**部署阶段**:
1. 将代码部署到生产环境
2. 在生产环境执行完整的测试用例
3. 验证所有功能正常工作
4. 记录测试结果

**验收标准**:
- ✅ 至少1次完整的生产环境测试通过
- ✅ 所有核心功能正常
- ✅ 没有新的错误或性能问题
- ⚠️ **不满足**: 仅在容器环境中测试通过

#### 1.3 测试用例覆盖

每个功能至少包含以下测试：

| 测试类型 | 测试内容 | 执行环境 |
|---------|---------|---------|
| 功能测试 | 正常流程、边界条件、异常处理 | 生产环境 |
| 性能测试 | 响应时间、并发处理 | 生产环境 |
| 兼容性测试 | 不同浏览器、不同设备 | 生产环境 |
| 安全测试 | 认证授权、数据保护 | 生产环境 |
| 用户体验测试 | 真实用户操作流程 | 生产环境 |

#### 1.4 测试报告要求

每次部署必须生成测试报告，包含：

1. **测试环境**
   - 测试日期
   - 测试人员
   - 生产环境URL: https://meiyueart.com

2. **测试结果**
   - 通过的测试用例
   - 失败的测试用例
   - 问题和修复情况

3. **部署信息**
   - 部署的文件清单
   - 部署时间
   - 回滚方案

---

### 2. 全景分析原则

**原则**: 在开发任何功能前，先进行全景分析，识别所有相关模块和影响范围，避免遗漏。

#### 2.1 分析维度

**功能维度**:
- 前端页面
- 后端API
- 数据库表
- 依赖服务

**数据维度**:
- 数据流
- 数据存储
- 数据迁移
- 数据备份

**性能维度**:
- API响应时间
- 数据库查询性能
- 前端加载时间
- 并发处理能力

**安全维度**:
- 认证授权
- 数据加密
- 输入验证
- 输出过滤

**用户体验维度**:
- 操作流程
- 错误提示
- 加载状态
- 反馈机制

#### 2.2 分析模板

```markdown
## 功能分析: [功能名称]

### 影响范围
- 前端: [涉及的前端页面/组件]
- 后端: [涉及的后端API]
- 数据库: [涉及的数据库表]

### 数据流
[数据流向图]

### 潜在问题
1. [问题1]
2. [问题2]

### 解决方案
1. [方案1]
2. [方案2]

### 测试计划
- [ ] 测试用例1
- [ ] 测试用例2
```

---

### 3. 查漏补缺原则

**原则**: 定期进行系统审查，识别和修复遗漏的功能、bug和性能问题。

#### 3.1 审查频率

- 每周进行一次代码审查
- 每月进行一次功能审查
- 每季度进行一次架构审查

#### 3.2 审查检查清单

**功能完整性**:
- [ ] 所有用户需求是否已实现
- [ ] 是否有未完成的功能
- [ ] 是否有被遗忘的功能

**代码质量**:
- [ ] 代码是否规范
- [ ] 是否有重复代码
- [ ] 是否有安全隐患

**性能优化**:
- [ ] 是否有慢查询
- [ ] 是否有内存泄漏
- [ ] 是否有性能瓶颈

**错误处理**:
- [ ] 所有错误是否已处理
- [ ] 错误提示是否友好
- [ ] 错误日志是否完整

**文档完整性**:
- [ ] API文档是否更新
- [ ] 用户文档是否更新
- [ ] 部署文档是否更新

---

### 4. 测试驱动开发原则

**原则**: 先编写测试用例，再编写代码，确保代码质量和功能正确性。

#### 4.1 开发流程

1. **需求分析**
   - 理解需求
   - 编写测试用例

2. **测试先行**
   - 编写单元测试
   - 编写集成测试
   - 编写端到端测试

3. **代码实现**
   - 实现功能代码
   - 运行测试
   - 修复问题

4. **代码审查**
   - 代码质量检查
   - 安全审查
   - 性能审查

5. **部署测试**
   - 部署到生产环境
   - 执行生产环境测试
   - 验证功能

#### 4.2 测试金字塔

```
         /\
        /  \
       /E2E \    ← 端到端测试 (少量)
      /------\
     /集成测试 \  ← 集成测试 (中等)
    /----------\
   /  单元测试   \ ← 单元测试 (大量)
  /______________\
```

---

### 5. 文档同步原则

**原则**: 代码和文档必须同步更新，保持文档的准确性和时效性。

#### 5.1 文档类型

| 文档类型 | 内容 | 更新频率 |
|---------|------|---------|
| API文档 | 接口说明、参数、返回值 | 每次API修改 |
| 部署文档 | 部署步骤、配置说明 | 每次部署 |
| 用户文档 | 使用说明、常见问题 | 每次功能变更 |
| 架构文档 | 系统架构、设计模式 | 每次架构调整 |

#### 5.2 文档维护

- 每次代码变更必须更新相关文档
- 每次部署必须更新部署文档
- 每次功能变更必须更新用户文档

---

### 6. 安全优先原则

**原则**: 安全是最高优先级，任何影响安全的问题必须立即修复。

#### 6.1 安全检查清单

**认证授权**:
- [ ] 所有API是否需要认证
- [ ] 权限验证是否正确
- [ ] Token是否安全存储

**数据保护**:
- [ ] 敏感数据是否加密
- [ ] 数据传输是否加密
- [ ] 数据备份是否定期执行

**输入验证**:
- [ ] 所有输入是否验证
- [ ] SQL注入防护
- [ ] XSS攻击防护

**日志审计**:
- [ ] 操作日志是否记录
- [ ] 异常日志是否完整
- [ ] 审计日志是否安全

---

### 7. 性能优化原则

**原则**: 性能是用户体验的关键，必须在开发阶段考虑性能优化。

#### 7.1 性能指标

| 指标 | 目标值 | 监控方式 |
|------|--------|---------|
| API响应时间 | < 200ms | APM工具 |
| 页面加载时间 | < 3s | Web性能工具 |
| 数据库查询时间 | < 100ms | 慢查询日志 |
| 并发用户数 | > 1000 | 压力测试 |

#### 7.2 优化策略

**前端优化**:
- 代码分割
- 懒加载
- 缓存策略
- CDN加速

**后端优化**:
- 数据库索引
- 查询优化
- 缓存机制
- 异步处理

---

### 8. 持续集成原则

**原则**: 自动化构建、测试、部署流程，提高效率和可靠性。

#### 8.1 CI/CD流程

```
代码提交 → 自动构建 → 自动测试 → 自动部署 → 生产环境测试
    ↓        ↓          ↓          ↓              ↓
  Git仓库   代码检查    单元测试    部署脚本      验证报告
```

#### 8.2 质量门禁

- 代码审查通过
- 单元测试通过
- 集成测试通过
- 安全扫描通过
- 性能测试通过

---

## 工作流程示例

### 功能开发流程

```
1. 需求分析
   ↓
2. 全景分析 (影响范围、数据流、潜在问题)
   ↓
3. 编写测试用例
   ↓
4. 代码实现
   ↓
5. 单元测试 (容器环境)
   ↓
6. 集成测试 (容器环境)
   ↓
7. 代码审查
   ↓
8. 部署到生产环境
   ↓
9. 生产环境测试 (meiyueart.com) ← 必须执行
   ↓
10. 验证通过 → 完成
11. 验证失败 → 修复 → 重新部署
```

### Bug修复流程

```
1. Bug报告
   ↓
2. 全景分析 (影响范围、根本原因)
   ↓
3. 编写复现测试
   ↓
4. 修复代码
   ↓
5. 单元测试
   ↓
6. 部署到生产环境
   ↓
7. 生产环境验证 ← 必须执行
   ↓
8. 验证通过 → 完成
9. 验证失败 → 继续修复
```

---

## 工具和资源

### 测试工具
- 单元测试: pytest
- API测试: curl, Postman
- 性能测试: JMeter
- 安全测试: OWASP ZAP

### 监控工具
- 日志监控: ELK Stack
- 性能监控: Prometheus + Grafana
- 错误追踪: Sentry

### 文档工具
- API文档: Swagger/OpenAPI
- 文档编写: Markdown
- 图表绘制: Mermaid, Draw.io

---

## 附录

### A. 生产环境连接信息

- 生产环境URL: https://meiyueart.com
- API基础URL: https://meiyueart.com/api
- 健康检查: https://meiyueart.com/api/health

### B. 常用命令

```bash
# 测试生产环境健康状态
curl https://meiyueart.com/api/health

# 测试登录
curl -X POST https://meiyueart.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "123"}'

# 查看生产环境日志
ssh user@meiyueart.com
tail -f /var/log/flask_backend.log
```

### C. 紧急联系

- 技术负责人: 待定
- 运维负责人: 待定
- 产品负责人: 待定

---

**文档维护**: Coze Coding Agent
**审核**: 待定
**批准**: 待定
