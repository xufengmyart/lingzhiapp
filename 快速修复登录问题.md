# 快速修复用户登录问题

## 问题根源

前端代码中有多处硬编码了 `localhost:8001`，导致通过IP地址访问时请求发送失败。

## 已修复的问题

1. ✅ `Login.tsx` - 微信登录地址
2. ✅ `AuthContext.tsx` - 检查用户信息完成状态
3. ✅ `api.ts` - API基础地址配置

## 修复方案

### 方案1：最快解决（推荐）- 配置Nginx代理

在服务器上执行以下命令：

```bash
ssh root@123.56.142.143
```

```bash
cat > /etc/nginx/sites-available/meiyueart.com << 'EOF'
server {
    listen 80;
    server_name 123.56.142.143;

    location / {
        root /var/www/html;
        try_files $uri $uri/ /index.html;
    }

    location /api/ {
        proxy_pass http://localhost:8001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
EOF
```

```bash
nginx -t
systemctl restart nginx
```

然后访问 http://123.56.142.143，用 `许锋` / `123456` 登录。

### 方案2：更新前端文件（需要上传）

#### 步骤1：在本地构建前端

```bash
cd /workspace/projects/web-app
npx vite build
```

#### 步骤2：上传到服务器

**使用FileZilla：**
1. 下载 FileZilla：https://filezilla-project.org/
2. 连接信息：
   - 主机：123.56.142.143
   - 用户名：root
   - 密码：Meiyue@root123
   - 端口：22
3. 将 `/workspace/projects/public/` 下的所有文件上传到 `/var/www/html/`

**使用命令行（如果可用）：**
```bash
# 在本地执行
cd /workspace/projects
tar -czf frontend.tar.gz public/
# 使用FTP工具上传 frontend.tar.gz 到服务器

# 在服务器上执行
cd /tmp
tar -xzf frontend.tar.gz
rm -rf /var/www/html/*
cp -r public/* /var/www/html/
chown -R www-data:www-data /var/www/html
chmod -R 755 /var/www/html
systemctl restart nginx
```

#### 步骤3：配置API地址

在服务器上创建环境变量配置：

```bash
# 编辑 index.html
nano /var/www/html/index.html
```

在 `<head>` 标签内添加：

```html
<script>
  // 设置API地址
  window.API_BASE_URL = 'http://123.56.142.143/api';
</script>
```

## 验证是否成功

### 方法1：浏览器控制台

1. 打开 http://123.56.142.143
2. 按F12打开开发者工具
3. 点击 Console 标签
4. 输入：`window.location.origin`
5. 应该显示：`http://123.56.142.143`

### 方法2：Network标签

1. 按F12打开开发者工具
2. 点击 Network 标签
3. 尝试登录
4. 查看是否有 `/api/login` 的请求
5. 点击该请求，查看 Response：
   - ✅ 成功：返回 `{"success": true, ...}`
   - ❌ 失败：返回错误信息

### 方法3：直接测试API

在浏览器中访问：
```
http://123.56.142.143/api/login
```

应该返回：
```json
{"success": false, "message": "用户名和密码不能为空"}
```

## 如果还是不行

### 检查后端服务

```bash
ssh root@123.56.142.143
systemctl status lingzhi-api
```

如果不是 `active (running)`：
```bash
systemctl start lingzhi-api
```

### 检查Nginx配置

```bash
nginx -t
systemctl restart nginx
```

### 查看错误日志

```bash
# Nginx错误日志
tail -50 /var/log/nginx/error.log

# 后端API日志
tail -50 /app/work/logs/bypass/app.log
```

## 登录测试

### 测试账号

| 用户名 | 密码 | 邮箱 |
|-------|------|------|
| 许锋 | 123456 | xufeng@meiyueart.cn |
| CTO（待定） | 123456 | cto@meiyue.com |
| CMO（待定） | 123456 | cmo@meiyue.com |
| COO（待定） | 123456 | coo@meiyue.com |
| CFO（待定） | 123456 | cfo@meiyue.com |

### 测试步骤

1. 访问：http://123.56.142.143
2. 点击"登录"
3. 输入用户名：`许锋`
4. 输入密码：`123456`
5. 点击"登录"按钮
6. 应该跳转到首页

## 常见问题

### Q: 点击登录按钮没有反应

**A:** 打开浏览器控制台（F12），查看Console是否有红色错误。

### Q: 提示"用户名或密码错误"

**A:** 确认使用的是 `许锋` 和 `123456`，密码已重置。

### Q: Network标签没有任何请求

**A:** 检查是否有JavaScript错误，可能阻止了请求发送。

### Q: 请求返回404

**A:** Nginx配置问题，确保 `/api/` 代理配置正确。

## 总结

**最快解决方案：** 配置Nginx代理（方案1），无需修改前端代码，1分钟完成。

**完整解决方案：** 更新前端文件（方案2），彻底解决硬编码问题。

选择方案1立即测试！
