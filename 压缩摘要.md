```markdown
# 压缩摘要

## 用户需求与目标
- 原始目标: 创建一个基于LangChain的灵值生态智能体，融合用户旅程管理、合伙人管理及经济模型计算。
- 当前目标: 
  1. 完善后台用户管理系统（用户列表、搜索、详情、状态管理、灵值调整、导出）。
  2. ✅ 实现用户统计功能（注册趋势、活跃度等）。
  3. ✅ 实现前台用户增加动态显示。

## 项目概览
- 概述: 灵值生态园智能体应用（v2.0），React Web APP。集成用户认证、智能对话、经济模型、用户旅程、合伙人管理、充值购买体系（含公司公户转账）、中视频项目、西安美学侦探等功能，支持PWA安装和自动化部署。
- 技术栈:
  - 前端: React 18.3.1, TypeScript 5.4.5, Vite 5.4.21, Tailwind CSS 3.4.3, React Quill
  - 后端: Python Flask (端口8001), coze-coding-dev-sdk, langchain-core
  - 数据库: SQLite (支持bcrypt和SHA256密码加密)
  - 部署: Nginx (自建服务器), Shell脚本自动化
  - 智能体模型: deepseek-v3-2-251201
- 编码规范: 遵循项目内部规范，使用 `src/` 目录结构。

## 关键决策
- 采用React + TypeScript + Vite技术栈构建Web APP。
- 集成大模型（deepseek-v3-2）实现真实智能对话。
- 集成自动化部署系统，实现代码修改后的自动同步与备份。
- 添加后台管理系统（AdminDashboard），集成自动化部署功能。
- 实现双密码加密兼容（bcrypt和SHA256）以支持旧用户数据迁移。
- 智能体人格需明确公司主体（陕西媄月商业艺术有限责任公司）。
- 智能体对话需集成知识库检索，增强回答准确性。
- 引入购买灵值体系，作为生态加速器和文化投资渠道，包含7个充值档位和多种消费场景。
- 支持公司公户转账充值，提供企业用户和大额充值渠道。

## 核心文件修改
- 文件操作:
  - edit: `admin-backend/app.py` (扩展用户表字段，新增用户管理接口)
  - edit: `config/agent_llm_config.json` (更新智能体配置，添加公户收款说明)
  - edit: `admin-backend/app.py` (新增用户统计接口：`/api/admin/stats/user`)
  - edit: `admin-backend/app.py` (新增最近用户接口：`/api/admin/users/recent`)
  - edit: `admin-backend/app.py` (新增前台用户动态接口：`/api/public/users/recent`)
  - edit: `web-app/src/pages/AdminDashboard.tsx` (更新仪表盘，添加用户统计卡片和注册趋势图表)
  - edit: `web-app/src/pages/Dashboard.tsx` (添加用户动态显示组件)
- 关键修改:
  - **数据库扩展**: 
    - `users`表新增字段：`status`, `last_login_at`, `avatar_url`, `real_name`, `is_verified`。
    - 新增 `company_accounts` 表（公司收款账户）。
    - 新增 `transfer_vouchers` 表（转账凭证）。
    - `recharge_records` 表新增字段：`payment_method`, `voucher_id`, `audit_status`, `bank_info`。
  - **后台用户管理接口新增**: 
    - `GET /api/admin/users/<user_id>`: 获取用户详情（含签到、充值、消费统计）。
    - `PUT /api/admin/users/<user_id>/status`: 更新用户状态。
    - `POST /api/admin/users/<user_id>/lingzhi`: 调整用户灵值。
    - `GET /api/admin/users/search`: 搜索用户。
    - `GET /api/admin/users/export`: 导出用户列表（CSV）。
  - **用户统计接口新增**:
    - `GET /api/admin/stats/user`: 获取用户统计详情（每日新增用户、每日活跃用户、用户状态分布、灵值分布、注册趋势等）。
    - `GET /api/admin/users/recent`: 获取最近注册用户（管理员专用）。
    - `GET /api/public/users/recent`: 获取最近注册用户（前台公开，用户动态显示）。
  - **公司公户收款功能**:
    - `GET /api/company/accounts`: 获取公司收款账户。
    - `POST /api/recharge/upload-voucher`: 上传转账凭证。
    - `GET /api/admin/vouchers/pending`: 获取待审核凭证。
    - `POST /api/admin/vouchers/<id>/audit`: 审核凭证。
  - **智能体配置更新**: 在"获得灵值的途径"中新增"充值购买"选项，并添加详细的"公司公户转账说明"。
  - **前端用户统计功能**:
    - 管理后台仪表盘新增用户统计卡片：活跃用户、今日活跃、非活跃用户、已封禁用户。
    - 管理后台仪表盘新增注册趋势图表（可视化显示最近30天注册趋势）。
    - 前台用户仪表盘新增"用户动态"组件，实时显示最新注册的用户。

## 问题或错误及解决方案
- 无新增问题。

## TODO
- ✅ 实现用户统计功能（注册趋势、活跃度等）。
- ✅ 实现前台用户增加动态显示。
- 测试用户管理功能。
```
