# 云服务商配置指南 - 开放 8080 端口

## 概述

当前云服务商的 Nginx 拦截了所有 API 请求，导致前端无法正常调用后端接口。

为了快速解决问题，需要：
1. 开放 8080 端口，允许外部直接访问 Flask 后端
2. 或者配置反向代理，将 `/api` 路径转发到后端

---

## 方案 A: 开放 8080 端口（快速方案）

### 通用步骤

#### 1. 登录云服务商控制台

根据您的云服务商类型：
- **阿里云**: https://ecs.console.aliyun.com/
- **腾讯云**: https://console.cloud.tencent.com/cvm/
- **华为云**: https://console.huaweicloud.com/ecm/
- **AWS**: https://console.aws.amazon.com/ec2/
- **其他**: 登录对应的控制台

#### 2. 找到实例管理

- 找到您的 ECS/虚拟机实例
- 点击实例 ID 进入详情页

#### 3. 配置安全组规则

**阿里云：**

1. 进入实例详情页
2. 点击"安全组"标签
3. 点击"配置规则"
4. 添加入方向规则：
   - 规则方向：入方向
   - 授权策略：允许
   - 协议类型：自定义 TCP
   - 端口范围：8080/8080
   - 授权对象：0.0.0.0/0
   - 描述：Flask 后端 API

**腾讯云：**

1. 进入实例详情页
2. 点击"安全组"标签
3. 点击"配置规则"
4. 添加入站规则：
   - 类型：自定义
   - 协议：TCP
   - 端口：8080
   - 来源：0.0.0.0/0
   - 策略：允许

**华为云：**

1. 进入实例详情页
2. 点击"安全组"标签
3. 点击"配置规则"
4. 添加入方向规则：
   - 协议：TCP
   - 端口：8080
   - 源地址：0.0.0.0/0
   - 策略：允许

**AWS：**

1. 进入实例详情页
2. 点击"Security"标签
3. 找到关联的安全组
4. 点击"Edit inbound rules"
5. 添加规则：
   - Type: Custom TCP
   - Port range: 8080
   - Source: 0.0.0.0/0
   - Description: Flask Backend API

#### 4. 保存配置

点击"确定"或"保存"按钮。

#### 5. 验证配置

在浏览器中访问：
```
http://123.56.142.143:8080/api/login
```

或者在终端中测试：
```bash
curl -X POST http://123.56.142.143:8080/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

如果返回登录成功的 JSON 数据，说明配置成功。

---

## 方案 B: 配置反向代理（推荐方案）

### 为什么推荐反向代理？

- ✅ 可以使用 HTTPS（更安全）
- ✅ 不需要修改前端配置
- ✅ 符合最佳实践
- ✅ 隐藏后端端口（更安全）

### 配置步骤

#### 步骤 1: 找到负载均衡或反向代理配置

在云服务商控制台中查找：
- **负载均衡 (SLB/ELB)**
- **反向代理**
- **API 网关**
- **CDN 配置**

#### 步骤 2: 添加路径转发规则

**通用配置格式：**

```
源路径：/api/*
目标地址：http://127.0.0.1:8080/api/*
协议：HTTP 或 HTTPS（根据实际情况）
```

**阿里云 SLB 配置：**

1. 进入负载均衡控制台
2. 创建或编辑监听规则
3. 添加转发规则：
   - 域名：meiyueart.com
   - 路径：/api/*
   - 后端服务器组：选择您的 ECS 实例
   - 端口：8080
   - 健康检查：HTTP /api/health

**腾讯云 负载均衡：**

1. 进入负载均衡控制台
2. 创建或编辑监听器
3. 添加转发规则：
   - 域名：meiyueart.com
   - 路径：/api/*
   - 目标端口：8080
   - 转发方式：轮询

**华为云 ELB：**

1. 进入弹性负载均衡控制台
2. 创建或编辑监听器
3. 添加转发策略：
   - 域名：meiyueart.com
   - URL：/api/*
   - 后端服务器组：选择您的 ECS
   - 端口：8080

#### 步骤 3: 保存并测试

保存配置后，测试：
```bash
curl -X POST https://meiyueart.com/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

---

## 方案 C: 使用 API 网关（高级方案）

如果您的云服务商提供 API 网关服务，可以考虑使用：

### 优点
- ✅ 更强大的功能（限流、鉴权、监控）
- ✅ 更好的性能
- ✅ 自动 HTTPS 支持

### 配置步骤

1. 创建 API 网关实例
2. 创建 API 分组
3. 创建 API：
   - 请求路径：/api/login
   - 请求方法：POST
   - 后端服务：HTTP
   - 后端地址：http://127.0.0.1:8080/api/login
4. 发布 API
5. 测试 API

---

## 常见问题

### Q1: 我不知道我的云服务商类型怎么办？

**解决方案：**
1. 查看您的服务器登录信息
2. 查看域名解析记录（whois meiyueart.com）
3. 联系提供服务器的服务商

### Q2: 控制台找不到"安全组"选项？

**可能的原因：**
- 使用的是轻量应用服务器
- 使用的是容器服务
- 安全组配置在其他位置

**解决方案：**
1. 查找"防火墙"选项
2. 查找"网络设置"
3. 联系云服务商客服

### Q3: 配置了安全组但还是无法访问？

**排查步骤：**

1. **检查实例内部防火墙：**
```bash
# 检查防火墙状态
systemctl status firewalld
systemctl status ufw

# 开放端口
firewall-cmd --add-port=8080/tcp --permanent
firewall-cmd --reload

# 或者
ufw allow 8080/tcp
```

2. **检查应用是否监听：**
```bash
netstat -tlnp | grep 8080
```

3. **检查 Nginx 配置：**
```bash
nginx -t
```

4. **测试本地访问：**
```bash
curl http://127.0.0.1:8080/api/login
```

### Q4: 开放 8080 端口安全吗？

**风险评估：**
- ⚠️ HTTP 协议，数据未加密
- ⚠️ 端口暴露在公网
- ⚠️ 可能被攻击者扫描

**安全建议：**
1. 只在需要时临时开放
2. 使用 IP 白名单（如果客户端 IP 固定）
3. 配置应用层鉴权
4. 配置 8080 端口的 SSL 证书
5. 长期方案：使用反向代理 + HTTPS

### Q5: 如何限制 8080 端口的访问？

**使用 IP 白名单：**

在安全组规则中：
- 源地址：`<您的客户端 IP>/32`
- 而不是 `0.0.0.0/0`

或者：
- 源地址：`<公司 IP 段>/24`

---

## 联系云服务商支持

如果以上步骤都无法解决，建议：

### 提供的信息

1. **实例信息：**
   - 实例 ID：`<您的实例 ID>`
   - 公网 IP：`123.56.142.143`
   - 地域：`<您的地域>`

2. **问题描述：**
   - 无法从外部访问 8080 端口
   - 云服务商的 Nginx 拦截了 /api 请求
   - 需要配置反向代理或开放端口

3. **期望的解决方案：**
   - 方案 1：开放 8080 端口
   - 方案 2：配置 /api 路径的反向代理

### 联系方式

- **工单系统**：优先使用，有记录
- **在线客服**：紧急问题使用
- **技术支持**：复杂问题使用

---

## 快速命令参考

### 测试端口是否开放
```bash
# 从外部测试
telnet 123.56.142.143 8080

# 或使用 nc
nc -zv 123.56.142.143 8080
```

### 测试 API 是否可访问
```bash
curl -X POST http://123.56.142.143:8080/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

### 查看防火墙规则
```bash
# Ubuntu/Debian
sudo ufw status

# CentOS/RHEL
sudo firewall-cmd --list-all

# 通用
sudo iptables -L -n
```

---

## 预期结果

配置完成后，应该能够：

### 测试 1: 直接访问 8080 端口
```bash
curl http://123.56.142.143:8080/api/login
# 返回：{"success": true, ...}
```

### 测试 2: 通过域名访问（如果配置了反向代理）
```bash
curl https://meiyueart.com/api/login
# 返回：{"success": true, ...}
```

### 测试 3: 浏览器访问
在浏览器中打开：
```
http://123.56.142.143:8080/api/login
```
应该能看到 JSON 响应。

---

**提示**: 建议优先尝试方案 B（配置反向代理），这是更安全、更长期的解决方案。如果急需上线，可以先使用方案 A（开放 8080 端口）。
