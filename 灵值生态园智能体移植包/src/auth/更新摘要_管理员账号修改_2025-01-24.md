# 更新摘要 - 管理员账号修改

## 更新日期
2025-01-24

## 更新内容

### 管理员账号信息变更

#### 原账号信息
- 邮箱：xufeng@meiyue.com
- 密码：Meiyue@2026

#### 新账号信息
- 邮箱：xufeng@meiyueart.cn
- 密码：Xf@071214
- 姓名：许锋
- 角色：超级管理员
- 部门：董事会
- 职位：董事长/CEO

## 更新步骤

### 1. 创建更新脚本
创建了两个脚本文件：
- `update_admin.py` - 用于更新邮箱和密码
- `update_password.py` - 用于仅更新密码

### 2. 执行更新
```bash
cd 灵值生态园智能体移植包/src/auth
python update_password.py
```

### 3. 数据库变更
- 更新 `users` 表中的 `email` 字段
- 更新 `users` 表中的 `password_hash` 字段
- 更新 `updated_at` 时间戳

## 验证结果

### ✅ 新账号登录测试
```bash
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=xufeng@meiyueart.cn&password=Xf@071214"
```

**结果**：登录成功，返回 access_token

### ✅ API 调用测试
使用新账号的 token 调用 API：
```bash
curl -H "Authorization: Bearer <token>" \
  http://localhost:8000/api/database/stats
```

**结果**：成功获取数据库统计信息

### ✅ 旧账号禁用测试
```bash
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=xufeng@meiyue.com&password=Meiyue@2026"
```

**结果**：登录失败，提示"邮箱或密码错误"

## 技术细节

### 密码加密
使用 bcrypt 算法加密密码：
```python
password_hash = bcrypt.hashpw(
    password.encode('utf-8'),
    bcrypt.gensalt()
).decode('utf-8')
```

### 数据库查询
```python
UPDATE users
SET email='xufeng@meiyueart.cn',
    password_hash='<new_hash>',
    updated_at=datetime.now()
WHERE email='xufeng@meiyue.com'
```

## 安全建议

1. ⚠️ **立即修改密码**：建议在首次登录后再次修改密码
2. ⚠️ **启用双因素认证**：确保双因素认证功能已启用
3. ⚠️ **定期更换密码**：建议每3个月更换一次密码
4. ⚠️ **记录访问日志**：监控管理员账号的登录活动
5. ⚠️ **限制IP访问**：在生产环境中考虑限制管理员账号的IP访问

## 备份建议

建议备份以下内容：
1. 数据库文件（auth.db）
2. 新账号信息
3. 更新脚本（update_admin.py, update_password.py）

## 回滚方案

如果需要回滚到旧账号，可以执行：
```bash
cd 灵值生态园智能体移植包/src/auth
python -c "
from sqlalchemy import create_engine, text
import bcrypt

engine = create_engine('sqlite:///./auth.db', connect_args={'check_same_thread': False})
old_password = bcrypt.hashpw(b'Meiyue@2026', bcrypt.gensalt()).decode('utf-8')

with engine.connect() as conn:
    conn.execute(
        text('UPDATE users SET email=:email, password_hash=:pwd WHERE id=1'),
        {'email': 'xufeng@meiyue.com', 'pwd': old_password}
    )
    conn.commit()
"
```

## 联系信息
- 更新时间：2025-01-24
- 执行人：系统管理员
- 影响范围：管理员登录功能
