# æ›´æ–°æ‘˜è¦ï¼šæ•°æ®åº“è®¿é—®æ¥å£

**æ›´æ–°æ—¥æœŸ**ï¼š2026å¹´1æœˆ23æ—¥
**æ›´æ–°ç±»å‹**ï¼šåŠŸèƒ½å¢å¼º
**ç‰ˆæœ¬**ï¼šv1.0

---

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸º"åª„æœˆå•†ä¸šè‰ºæœ¯"æƒé™ç®¡ç†ç³»ç»Ÿæ·»åŠ äº†æ•°æ®åº“è®¿é—®æ¥å£ï¼Œå…è®¸ç»è¿‡æˆæƒçš„ç”¨æˆ·é€šè¿‡APIæŸ¥è¯¢ç³»ç»Ÿæ•°æ®åº“ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·ã€è§’è‰²ã€æƒé™ç­‰ï¼Œæ— éœ€ç›´æ¥æ“ä½œæ•°æ®åº“æ–‡ä»¶ã€‚

---

## ğŸ¯ æ›´æ–°ç›®æ ‡

1. **æ•°æ®åº“è®¿é—®æ¥å£**ï¼šæä¾›RESTful APIæ¥å£æŸ¥è¯¢æ•°æ®åº“ä¿¡æ¯
2. **æƒé™æ§åˆ¶**ï¼šåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼Œç¡®ä¿æ•°æ®å®‰å…¨
3. **æµ‹è¯•è„šæœ¬**ï¼šæä¾›Pythonæµ‹è¯•è„šæœ¬ï¼Œæ–¹ä¾¿å¿«é€Ÿæµ‹è¯•
4. **ä½¿ç”¨æ–‡æ¡£**ï¼šå®Œæ•´çš„ä½¿ç”¨æ‰‹å†Œå’ŒAPIæ–‡æ¡£

---

## ğŸ“‚ æ–°å¢/ä¿®æ”¹æ–‡ä»¶

### 1. database_api.pyï¼ˆå…¨æ–°æ–‡ä»¶ï¼‰

**æ•°æ®åº“è®¿é—®APIæ¥å£**ï¼š

#### æ•°æ®åº“ç®¡ç†æ¥å£
- `GET /api/database/stats` - è·å–æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
- `GET /api/database/current-user` - è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯

#### ç”¨æˆ·æŸ¥è¯¢æ¥å£
- `GET /api/database/users` - è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- `GET /api/database/users/{user_id}` - è·å–ç”¨æˆ·è¯¦æƒ…

#### è§’è‰²æŸ¥è¯¢æ¥å£
- `GET /api/database/roles` - è·å–è§’è‰²åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- `GET /api/database/roles/{role_id}` - è·å–è§’è‰²è¯¦æƒ…

#### æƒé™æŸ¥è¯¢æ¥å£
- `GET /api/database/permissions` - è·å–æƒé™åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- `GET /api/database/permissions/{permission_id}` - è·å–æƒé™è¯¦æƒ…

**æƒé™è¦æ±‚**ï¼š
- `database:view` - æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
- `user:view` - æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯
- `role:view` - æŸ¥çœ‹è§’è‰²ä¿¡æ¯
- `permission:view` - æŸ¥çœ‹æƒé™ä¿¡æ¯

---

### 2. test_db_connection.pyï¼ˆå…¨æ–°æ–‡ä»¶ï¼‰

**æ•°æ®åº“è¿æ¥æµ‹è¯•è„šæœ¬**ï¼š

#### åŠŸèƒ½
- ä»¥è®¸é”‹èº«ä»½è‡ªåŠ¨ç™»å½•
- è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- æŸ¥è¯¢æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
- æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
- æŸ¥è¯¢è§’è‰²åˆ—è¡¨
- æŸ¥è¯¢æƒé™åˆ—è¡¨

#### ä½¿ç”¨æ–¹å¼

```bash
# å¯åŠ¨APIæœåŠ¡
python api.py

# è¿è¡Œæµ‹è¯•è„šæœ¬
python test_db_connection.py
```

---

### 3. æ•°æ®åº“è®¿é—®æ¥å£ä½¿ç”¨æ‰‹å†Œ.mdï¼ˆå…¨æ–°æ–‡ä»¶ï¼‰

**å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£**ï¼š

#### å†…å®¹åŒ…æ‹¬
- æ¦‚è¿°å’Œé€‚ç”¨åœºæ™¯
- æƒé™è¦æ±‚è¯´æ˜
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- APIæ¥å£è¯¦è§£
- ä½¿ç”¨ç¤ºä¾‹ï¼ˆPythonã€curlï¼‰
- è®¸é”‹è´¦å·ä¿¡æ¯
- é‡è¦æé†’

---

### 4. init_data_v2.pyï¼ˆä¿®æ”¹ï¼‰

**æ–°å¢æƒé™**ï¼š
- `database:view` - æŸ¥çœ‹æ•°æ®åº“
- `database:stats` - æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡

---

### 5. api.pyï¼ˆä¿®æ”¹ï¼‰

**æ·»åŠ å¯¼å…¥**ï¼š
```python
# å¯¼å…¥æ•°æ®åº“è®¿é—®API
try:
    from database_api import router as database_router
    app.include_router(database_router)
    print("âœ“ æ•°æ®åº“è®¿é—®APIå·²åŠ è½½")
except ImportError as e:
    print(f"è­¦å‘Šï¼šæ•°æ®åº“è®¿é—®APIæ¨¡å—æœªæ‰¾åˆ°: {str(e)}")
```

---

## ğŸ“Š APIæ¥å£åˆ—è¡¨

| æ¥å£ | æ–¹æ³• | æƒé™ | è¯´æ˜ |
|-----|------|------|------|
| `/api/database/stats` | GET | `database:view` | è·å–æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯ |
| `/api/database/users` | GET | `user:view` | è·å–ç”¨æˆ·åˆ—è¡¨ |
| `/api/database/users/{user_id}` | GET | `user:view` | è·å–ç”¨æˆ·è¯¦æƒ… |
| `/api/database/roles` | GET | `role:view` | è·å–è§’è‰²åˆ—è¡¨ |
| `/api/database/roles/{role_id}` | GET | `role:view` | è·å–è§’è‰²è¯¦æƒ… |
| `/api/database/permissions` | GET | `permission:view` | è·å–æƒé™åˆ—è¡¨ |
| `/api/database/permissions/{permission_id}` | GET | `permission:view` | è·å–æƒé™è¯¦æƒ… |
| `/api/database/current-user` | GET | æ—  | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |

---

## ğŸ” è®¸é”‹è´¦å·ä¿¡æ¯

| å­—æ®µ | å€¼ |
|-----|---|
| é‚®ç®± | xufeng@meiyue.com |
| å¯†ç  | Xu@2026 |
| è§’è‰² | è¶…çº§ç®¡ç†å‘˜ |
| çº§åˆ« | 1 |
| æƒé™ | æ‰€æœ‰æƒé™ |

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### æ–¹å¼1ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
# 1. å¯åŠ¨APIæœåŠ¡
cd çµå€¼ç”Ÿæ€å›­æ™ºèƒ½ä½“ç§»æ¤åŒ…/src/auth
python api.py

# 2. è¿è¡Œæµ‹è¯•è„šæœ¬
python test_db_connection.py
```

æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- ä»¥è®¸é”‹èº«ä»½ç™»å½•
- æ˜¾ç¤ºå½“å‰ç”¨æˆ·ä¿¡æ¯
- æ˜¾ç¤ºæ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
- æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨
- æ˜¾ç¤ºè§’è‰²åˆ—è¡¨
- æ˜¾ç¤ºæƒé™åˆ—è¡¨

### æ–¹å¼2ï¼šä½¿ç”¨APIæ¥å£

#### 1. ç™»å½•è·å–Token

```bash
curl -X POST "http://localhost:8000/api/auth/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=xufeng@meiyue.com&password=Xu@2026"
```

#### 2. ä½¿ç”¨Tokenè®¿é—®API

```bash
# è·å–æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
curl -X GET "http://localhost:8000/api/database/stats" \
  -H "Authorization: Bearer YOUR_TOKEN"

# è·å–ç”¨æˆ·åˆ—è¡¨
curl -X GET "http://localhost:8000/api/database/users?limit=20" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### æ–¹å¼3ï¼šä½¿ç”¨Pythonä»£ç 

```python
import requests

# ç™»å½•
login_response = requests.post(
    "http://localhost:8000/api/auth/login",
    data={"username": "xufeng@meiyue.com", "password": "Xu@2026"}
)
token = login_response.json()["access_token"]

# è®¾ç½®è¯·æ±‚å¤´
headers = {
    "Authorization": f"Bearer {token}",
    "Content-Type": "application/json"
}

# è·å–æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
stats = requests.get(
    "http://localhost:8000/api/database/stats",
    headers=headers
).json()
print(stats)
```

---

## ğŸ“ APIå“åº”ç¤ºä¾‹

### æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯

```json
{
  "users_count": 6,
  "roles_count": 8,
  "permissions_count": 38,
  "user_roles_count": 10,
  "role_permissions_count": 150,
  "database_size": "2.45 MB"
}
```

### ç”¨æˆ·åˆ—è¡¨

```json
[
  {
    "id": 1,
    "name": "é»„çˆ±è‰",
    "email": "huangaili@meiyue.com",
    "position": "CEO",
    "is_ceo": true,
    "wechat": null,
    "created_at": "2026-01-23T00:00:00",
    "updated_at": "2026-01-23T00:00:00",
    "roles": ["CEO"]
  },
  {
    "id": 2,
    "name": "è®¸é”‹",
    "email": "xufeng@meiyue.com",
    "position": "è¶…çº§ç®¡ç†å‘˜",
    "is_ceo": false,
    "wechat": null,
    "created_at": "2026-01-23T00:00:00",
    "updated_at": "2026-01-23T00:00:00",
    "roles": ["è¶…çº§ç®¡ç†å‘˜"]
  }
]
```

### è§’è‰²åˆ—è¡¨

```json
[
  {
    "id": 1,
    "name": "CEO",
    "english_name": "ceo",
    "level": 0,
    "description": "å…¬å¸é¦–å¸­æ‰§è¡Œå®˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™",
    "permissions_count": 38,
    "users_count": 1,
    "created_at": "2026-01-23T00:00:00"
  }
]
```

### å½“å‰ç”¨æˆ·ä¿¡æ¯

```json
{
  "id": 2,
  "name": "è®¸é”‹",
  "email": "xufeng@meiyue.com",
  "position": "è¶…çº§ç®¡ç†å‘˜",
  "is_ceo": false,
  "wechat": null,
  "roles": [
    {
      "id": 2,
      "name": "è¶…çº§ç®¡ç†å‘˜",
      "english_name": "super_admin",
      "level": 1
    }
  ],
  "permissions": [
    "user:create",
    "user:delete",
    "user:modify",
    "user:view",
    ...
  ],
  "created_at": "2026-01-23T00:00:00"
}
```

---

## âš ï¸ é‡è¦æé†’

1. **æƒé™æ§åˆ¶**ï¼šæ‰€æœ‰æ¥å£éƒ½éœ€è¦ç›¸åº”æƒé™ï¼Œç¡®ä¿ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™åå†è°ƒç”¨
2. **Tokenæœ‰æ•ˆæœŸ**ï¼šAccess Tokenæœ‰æ•ˆæœŸä¸º8å°æ—¶ï¼Œè¿‡æœŸåéœ€é‡æ–°ç™»å½•
3. **å®¡è®¡æ—¥å¿—**ï¼šæ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢æ“ä½œéƒ½ä¼šè¢«è®°å½•åœ¨å®¡è®¡æ—¥å¿—ä¸­
4. **æ•°æ®å®‰å…¨**ï¼šä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­ç¡¬ç¼–ç API Token
5. **å¯†ç å®‰å…¨**ï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç 

---

## ğŸ”„ æ•°æ®åº“æ›´æ–°

å¦‚æœéœ€è¦æ·»åŠ æ–°çš„æ•°æ®åº“è®¿é—®æƒé™ï¼š

```bash
# 1. åœ¨init_data_v2.pyä¸­æ·»åŠ æ–°æƒé™

# 2. é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
rm -f auth.db
python init_data_v2.py

# 3. é‡å¯APIæœåŠ¡
python api.py
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“è®¿é—®æ¥å£ä½¿ç”¨æ‰‹å†Œ.md](./æ•°æ®åº“è®¿é—®æ¥å£ä½¿ç”¨æ‰‹å†Œ.md) - å®Œæ•´çš„ä½¿ç”¨æ‰‹å†Œ
- [README_v2.0.md](./README_v2.0.md) - æƒé™ç®¡ç†ç³»ç»Ÿv2.0æ‰‹å†Œ
- [æ›´æ–°æ‘˜è¦_v2.0.md](./æ›´æ–°æ‘˜è¦_v2.0.md) - v2.0æ›´æ–°è¯´æ˜

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **æŠ€æœ¯æ”¯æŒ**ï¼štech@meiyue.com
- **æƒé™å’¨è¯¢**ï¼šadmin@meiyue.com

---

**åª„æœˆå•†ä¸šè‰ºæœ¯ - æ–‡åŒ–ç§‘æŠ€é©±åŠ¨çš„å“ç‰Œæœªæ¥èµ„äº§**
**Â© 2026 åª„æœˆå•†ä¸š ç‰ˆæƒæ‰€æœ‰ | æœªç»æˆæƒä¸å¾—å¤åˆ¶ã€ä¸‹è½½ã€ä¼ æ’­**

---

**æ›´æ–°å®Œæˆæ—¥æœŸ**ï¼š2026å¹´1æœˆ23æ—¥
**æ›´æ–°æ‰§è¡Œäºº**ï¼šçµå€¼ç”Ÿæ€å›¢é˜Ÿ
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
