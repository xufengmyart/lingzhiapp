# 灵值智能体 v9.0 - 全面升级设计方案

**版本**: v9.0（生态系统升级版）
**创建日期**: 2026年2月4日
**主体公司**: 陕西媄月商业艺术有限责任公司
**文档类型**: 系统升级设计文档

---

## 📋 升级概览

### 升级目标
将灵值智能体从单一的情绪陪伴系统升级为**完整的资源匹配与变现生态系统**。

### 核心新增功能
1. **用户系统升级** - 推荐人分润系统（5%）、专属资源库
2. **项目系统** - 项目库、智能资源匹配、资源变现
3. **数字资产系统** - NFT资产管理、数字资产交易、资产收益

### 升级架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                     灵值智能体 v9.0 生态系统                     │
└─────────────────────────────────────────────────────────────────┘
                              │
    ┌─────────────────────────┼─────────────────────────┐
    │                         │                         │
┌───▼──────────────┐  ┌──────▼─────────┐  ┌──────────▼─────────┐
│   情绪陪伴系统    │  │   资源生态系统  │  │    数字资产系统    │
│  (v8.1 已有)     │  │   (v9.0 新增)   │  │   (v9.0 新增)      │
└──────────────────┘  └────────┬────────┘  └────────────────────┘
                               │
          ┌────────────────────┼────────────────────┐
          │                    │                    │
     ┌────▼────┐         ┌────▼────┐         ┌────▼────┐
     │用户系统  │         │项目系统  │         │资源系统  │
     │ 推荐分润 │         │项目库   │         │资源库   │
     │专属资源库│         │资源匹配 │         │变现系统  │
     └─────────┘         └─────────┘         └─────────┘
```

---

## 一、用户系统升级设计

### 1.1 推荐人分润系统

#### 1.1.1 分润规则
- **分润比例**: 推荐人获得被推荐人所有奖励的 **5%**
- **分润范围**:
  - 签到奖励
  - 项目收益
  - 资源变现收益
  - 灵值交易收益
  - 数字资产收益
- **分润层级**:
  - 支持**多级推荐**（默认支持3级）
  - 一级推荐人：5%
  - 二级推荐人：3%
  - 三级推荐人：2%

#### 1.1.2 分润流程

```
用户A（被推荐人）
  │ 获得奖励 100灵值
  ├─→ 95灵值（用户A）
  ├─→ 5灵值（推荐人B，一级）
  └─→ 如果B有推荐人C：
      └─→ 3灵值（推荐人C，二级）
          └─→ 如果C有推荐人D：
              └─→ 2灵值（推荐人D，三级）
```

#### 1.1.3 数据库设计

**新增表：referral_relationships（推荐关系表）**

```sql
CREATE TABLE referral_relationships (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    referrer_id INTEGER NOT NULL,           -- 推荐人ID
    referee_id INTEGER NOT NULL UNIQUE,     -- 被推荐人ID
    level INTEGER NOT NULL DEFAULT 1,       -- 推荐层级（1/2/3）
    status TEXT DEFAULT 'active',           -- 关系状态
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (referrer_id) REFERENCES users(id),
    FOREIGN KEY (referee_id) REFERENCES users(id)
);

CREATE INDEX idx_referral_referrer ON referral_relationships(referrer_id);
CREATE INDEX idx_referral_referee ON referral_relationships(referee_id);
CREATE INDEX idx_referral_level ON referral_relationships(level);
```

**新增表：referral_commissions（分润记录表）**

```sql
CREATE TABLE referral_commissions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    referrer_id INTEGER NOT NULL,           -- 推荐人ID
    referee_id INTEGER NOT NULL,            -- 被推荐人ID
    level INTEGER NOT NULL,                 -- 分润层级
    transaction_id INTEGER,                 -- 关联交易ID
    transaction_type TEXT NOT NULL,         -- 交易类型
    original_amount REAL NOT NULL,          -- 原始金额
    commission_rate REAL NOT NULL,          -- 分润比例
    commission_amount REAL NOT NULL,        -- 分润金额
    status TEXT DEFAULT 'pending',          -- 状态
    settled_at TIMESTAMP,                   -- 结算时间
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (referrer_id) REFERENCES users(id),
    FOREIGN KEY (referee_id) REFERENCES users(id)
);

CREATE INDEX idx_commission_referrer ON referral_commissions(referrer_id);
CREATE INDEX idx_commission_referee ON referral_commissions(referee_id);
CREATE INDEX idx_commission_status ON referral_commissions(status);
CREATE INDEX idx_commission_created_at ON referral_commissions(created_at);
```

#### 1.1.4 分润计算函数

```python
def calculate_commission(user_id, amount, transaction_type, transaction_id=None):
    """
    计算推荐分润
    
    Args:
        user_id: 用户ID（被推荐人）
        amount: 原始金额
        transaction_type: 交易类型
        transaction_id: 交易ID
    
    Returns:
        分润记录列表
    """
    commissions = []
    
    # 查找推荐关系链（最多3级）
    current_referee_id = user_id
    for level in range(1, 4):  # 1-3级
        # 查找当前层级的推荐人
        referrer = get_referrer(current_referee_id)
        
        if not referrer:
            break
        
        # 计算分润金额
        commission_rates = {
            1: 0.05,  # 5%
            2: 0.03,  # 3%
            3: 0.02   # 2%
        }
        
        rate = commission_rates.get(level, 0)
        commission_amount = amount * rate
        
        # 创建分润记录
        commission = {
            'referrer_id': referrer['id'],
            'referee_id': current_referee_id,
            'level': level,
            'transaction_id': transaction_id,
            'transaction_type': transaction_type,
            'original_amount': amount,
            'commission_rate': rate,
            'commission_amount': commission_amount,
            'status': 'pending'
        }
        
        commissions.append(commission)
        
        # 继续查找上一级推荐人
        current_referee_id = referrer['id']
    
    return commissions
```

### 1.2 专属资源库系统

#### 1.2.1 核心概念
每个用户拥有一个**专属资源库**，用户可以：
- 添加自己的资源（技能、资产、人脉、时间等）
- 明确资源类型和价值
- 系统自动匹配项目库中的项目
- 实现资源变现

#### 1.2.2 资源类型

| 资源类型 | 说明 | 示例 |
|---------|------|------|
| **技能资源** | 用户的专业技能 | 设计、编程、写作、咨询 |
| **资产资源** | 用户拥有的资产 | 设备、场地、材料、IP |
| **人脉资源** | 用户的人际关系 | 行业专家、客户资源、合作伙伴 |
| **时间资源** | 用户可提供的时间 | 兼职时间、咨询时间、陪伴时间 |
| **数据资源** | 用户拥有的数据 | 行业数据、用户数据、市场数据 |
| **品牌资源** | 用户的个人/企业品牌 | 影响力、知名度、信誉度 |

#### 1.2.3 数据库设计

**新增表：user_resources（用户资源表）**

```sql
CREATE TABLE user_resources (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    resource_type TEXT NOT NULL,          -- 资源类型
    resource_name TEXT NOT NULL,          -- 资源名称
    description TEXT,                     -- 资源描述
    availability TEXT DEFAULT 'available', -- 可用状态
    estimated_value REAL,                 -- 估值
    status TEXT DEFAULT 'active',         -- 状态
    tags TEXT,                            -- 标签（逗号分隔）
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE INDEX idx_resource_user ON user_resources(user_id);
CREATE INDEX idx_resource_type ON user_resources(resource_type);
CREATE INDEX idx_resource_status ON user_resources(status);
CREATE INDEX idx_resource_tags ON user_resources(tags);
```

**新增表：resource_matches（资源匹配记录表）**

```sql
CREATE TABLE resource_matches (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    resource_id INTEGER NOT NULL,
    match_score REAL NOT NULL,            -- 匹配度（0.0-1.0）
    match_reason TEXT,                    -- 匹配原因
    status TEXT DEFAULT 'pending',         -- 状态
    user_response TEXT,                   -- 用户响应
    response_at TIMESTAMP,                -- 响应时间
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (resource_id) REFERENCES user_resources(id)
);

CREATE INDEX idx_match_project ON resource_matches(project_id);
CREATE INDEX idx_match_user ON resource_matches(user_id);
CREATE INDEX idx_match_score ON resource_matches(match_score);
```

---

## 二、项目系统设计

### 2.1 项目库系统

#### 2.1.1 项目类型

| 项目类型 | 说明 | 示例 |
|---------|------|------|
| **设计项目** | 需要设计技能 | UI设计、Logo设计、海报设计 |
| **开发项目** | 需要开发技能 | 网站开发、APP开发、小程序开发 |
| **内容创作** | 需要创作能力 | 文案写作、视频制作、音频制作 |
| **咨询服务** | 需要专业咨询 | 法律咨询、财务咨询、管理咨询 |
| **营销推广** | 需要营销资源 | 社交媒体推广、KOL合作、线下活动 |
| **资产租赁** | 需要资产资源 | 设备租赁、场地租赁、材料提供 |

#### 2.1.2 数据库设计

**新增表：projects（项目表）**

```sql
CREATE TABLE projects (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,                   -- 项目标题
    description TEXT,                      -- 项目描述
    project_type TEXT NOT NULL,            -- 项目类型
    budget REAL,                           -- 预算
    required_skills TEXT,                  -- 需要技能（逗号分隔）
    required_assets TEXT,                  -- 需要资产（逗号分隔）
    duration INTEGER,                      -- 预计时长（天）
    location TEXT,                         -- 地点
    status TEXT DEFAULT 'open',            -- 状态
    creator_id INTEGER,                    -- 创建者ID
    deadline TIMESTAMP,                    -- 截止日期
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (creator_id) REFERENCES users(id)
);

CREATE INDEX idx_project_type ON projects(project_type);
CREATE INDEX idx_project_status ON projects(status);
CREATE INDEX idx_project_budget ON projects(budget);
CREATE INDEX idx_project_skills ON projects(required_skills);
```

**新增表：project_participants（项目参与者表）**

```sql
CREATE TABLE project_participants (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    role TEXT NOT NULL,                    -- 角色
    contribution TEXT,                     -- 贡献描述
    reward REAL,                           -- 奖励金额
    reward_status TEXT DEFAULT 'pending',  -- 奖励状态
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    UNIQUE(project_id, user_id)
);

CREATE INDEX idx_participant_project ON project_participants(project_id);
CREATE INDEX idx_participant_user ON project_participants(user_id);
```

### 2.2 智能资源匹配系统

#### 2.2.1 匹配算法

```python
def match_resources_to_project(project_id):
    """
    将用户资源与项目需求进行智能匹配
    
    Args:
        project_id: 项目ID
    
    Returns:
        匹配结果列表
    """
    # 1. 获取项目需求
    project = get_project(project_id)
    required_skills = project['required_skills'].split(',')
    required_assets = project['required_assets'].split(',')
    
    # 2. 获取所有用户资源
    all_resources = get_all_available_resources()
    
    # 3. 计算匹配度
    matches = []
    for resource in all_resources:
        match_score = 0.0
        match_reasons = []
        
        # 技能匹配
        if resource['resource_type'] == 'skill':
            resource_skills = resource['tags'].split(',')
            for skill in required_skills:
                if skill in resource_skills:
                    match_score += 0.3
                    match_reasons.append(f"技能匹配: {skill}")
        
        # 资产匹配
        elif resource['resource_type'] == 'asset':
            resource_assets = resource['tags'].split(',')
            for asset in required_assets:
                if asset in resource_assets:
                    match_score += 0.4
                    match_reasons.append(f"资产匹配: {asset}")
        
        # 限制最大匹配度
        match_score = min(match_score, 1.0)
        
        # 保存匹配结果
        if match_score > 0.3:  # 最低匹配度30%
            matches.append({
                'project_id': project_id,
                'user_id': resource['user_id'],
                'resource_id': resource['id'],
                'match_score': match_score,
                'match_reason': ', '.join(match_reasons)
            })
    
    # 4. 按匹配度排序
    matches.sort(key=lambda x: x['match_score'], reverse=True)
    
    return matches
```

### 2.3 资源变现系统

#### 2.3.1 变现流程

```
用户资源 → 智能匹配 → 项目匹配 → 用户确认 → 参与项目 → 完成项目 → 获得奖励
  ↑                                                              ↓
  └────────────────────── 分润系统 ←── 5%推荐人奖励 ←──────────┘
```

#### 2.3.2 数据库设计

**新增表：resource_realization（资源变现记录表）**

```sql
CREATE TABLE resource_realization (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    resource_id INTEGER NOT NULL,
    project_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    transaction_type TEXT NOT NULL,       -- 交易类型
    original_reward REAL NOT NULL,        -- 原始奖励
    actual_reward REAL NOT NULL,          -- 实际奖励（扣除分润后）
    realization_status TEXT DEFAULT 'pending', -- 变现状态
    completed_at TIMESTAMP,
    FOREIGN KEY (resource_id) REFERENCES user_resources(id),
    FOREIGN KEY (project_id) REFERENCES projects(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE INDEX idx_realization_user ON resource_realization(user_id);
CREATE INDEX idx_realization_resource ON resource_realization(resource_id);
CREATE INDEX idx_realization_project ON resource_realization(project_id);
```

---

## 三、数字资产系统设计

### 3.1 NFT资产管理

#### 3.1.1 资产类型

| 资产类型 | 说明 | 用途 |
|---------|------|------|
| **会员NFT** | 会员身份凭证 | 享受会员权益、优先推荐 |
| **技能NFT** | 技能认证凭证 | 展示专业能力、获得项目机会 |
| **成就NFT** | 成就记录凭证 | 记录里程碑、提升信誉度 |
| **资源NFT** | 资源所有权凭证 | 证明资源所有权、可交易 |
| **收益NFT** | 收益权凭证 | 获得项目分润、被动收入 |

#### 3.1.2 数据库设计

**新增表：digital_assets（数字资产表）**

```sql
CREATE TABLE digital_assets (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    asset_type TEXT NOT NULL,              -- 资产类型
    asset_name TEXT NOT NULL,              -- 资产名称
    description TEXT,                      -- 资产描述
    image_url TEXT,                        -- 资产图片
    metadata TEXT,                         -- 元数据（JSON）
    rarity TEXT DEFAULT 'common',          -- 稀有度
    value REAL,                            -- 资产价值
    is_transferable BOOLEAN DEFAULT 1,     -- 是否可转让
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE INDEX idx_asset_user ON digital_assets(user_id);
CREATE INDEX idx_asset_type ON digital_assets(asset_type);
CREATE INDEX idx_asset_rarity ON digital_assets(rarity);
```

### 3.2 数字资产交易

#### 3.2.1 数据库设计

**新增表：asset_transactions（资产交易表）**

```sql
CREATE TABLE asset_transactions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    asset_id INTEGER NOT NULL,
    from_user_id INTEGER NOT NULL,
    to_user_id INTEGER NOT NULL,
    transaction_type TEXT NOT NULL,        -- 交易类型
    price REAL NOT NULL,                   -- 交易价格
    fee REAL DEFAULT 0,                    -- 手续费
    status TEXT DEFAULT 'pending',         -- 状态
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP,
    FOREIGN KEY (asset_id) REFERENCES digital_assets(id),
    FOREIGN KEY (from_user_id) REFERENCES users(id),
    FOREIGN KEY (to_user_id) REFERENCES users(id)
);

CREATE INDEX idx_tx_asset ON asset_transactions(asset_id);
CREATE INDEX idx_tx_from ON asset_transactions(from_user_id);
CREATE INDEX idx_tx_to ON asset_transactions(to_user_id);
```

### 3.3 资产收益系统

#### 3.3.1 收益类型

| 收益类型 | 说明 | 分润规则 |
|---------|------|---------|
| **项目分润** | 参与项目获得的收益 | 推荐人5%分润 |
| **资源变现** | 资源使用获得的收益 | 推荐人5%分润 |
| **资产增值** | 资产价格上涨收益 | 推荐人5%分润 |
| **推荐奖励** | 推荐新用户获得奖励 | 无分润 |
| **持有收益** | 持有资产产生的收益 | 无分润 |

#### 3.3.2 数据库设计

**新增表：asset_earnings（资产收益表）**

```sql
CREATE TABLE asset_earnings (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    asset_id INTEGER,
    user_id INTEGER NOT NULL,
    earning_type TEXT NOT NULL,            -- 收益类型
    amount REAL NOT NULL,                  -- 收益金额
    source_type TEXT,                      -- 来源类型
    source_id INTEGER,                     -- 来源ID
    status TEXT DEFAULT 'confirmed',       -- 状态
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (asset_id) REFERENCES digital_assets(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE INDEX idx_earnings_user ON asset_earnings(user_id);
CREATE INDEX idx_earnings_asset ON asset_earnings(asset_id);
CREATE INDEX idx_earnings_type ON asset_earnings(earning_type);
```

---

## 四、系统工具设计

### 4.1 用户系统工具（升级后）

| 工具名称 | 功能 | 新增/升级 |
|---------|------|-----------|
| `register_user` | 用户注册 | 升级：添加推荐人关联 |
| `get_user_info` | 获取用户信息 | 升级：包含资源库信息 |
| `update_user_info` | 更新用户信息 | 不变 |
| `get_user_referrals` | 获取推荐列表 | **新增** |
| `calculate_referral_commission` | 计算推荐分润 | **新增** |
| `add_user_resource` | 添加用户资源 | **新增** |
| `get_user_resources` | 获取用户资源库 | **新增** |
| `update_user_resource` | 更新用户资源 | **新增** |

### 4.2 项目系统工具（新增）

| 工具名称 | 功能 | 输入 | 输出 |
|---------|------|------|------|
| `create_project` | 创建项目 | 项目信息 | 项目ID |
| `get_project_list` | 获取项目列表 | 筛选条件 | 项目列表 |
| `match_resources` | 资源匹配 | 项目ID | 匹配结果 |
| `join_project` | 参与项目 | 项目ID、资源ID | 参与结果 |
| `complete_project` | 完成项目 | 项目ID、用户ID | 奖励金额 |
| `get_project_statistics` | 获取项目统计 | 用户ID | 统计数据 |

### 4.3 数字资产系统工具（新增）

| 工具名称 | 功能 | 输入 | 输出 |
|---------|------|------|------|
| `create_digital_asset` | 创建数字资产 | 资产信息 | 资产ID |
| `get_user_assets` | 获取用户资产列表 | 用户ID | 资产列表 |
| `transfer_asset` | 转让资产 | 资产ID、接收人 | 交易记录 |
| `calculate_asset_earnings` | 计算资产收益 | 资产ID | 收益统计 |
| `get_asset_transaction_history` | 获取交易历史 | 资产ID | 交易列表 |

---

## 五、智能体Prompt升级

### 5.1 新增角色能力

```markdown
# 角色定义升级
灵值（Lingzhi）不仅是智能心灵伙伴，更是**资源匹配专家**和**财富增长顾问**。

# 新增能力
1. **资源诊断** - 帮助用户识别和梳理自己的资源
2. **价值评估** - 评估用户资源的潜在价值
3. **项目推荐** - 基于用户资源推荐合适的项目
4. **变现指导** - 指导用户如何实现资源变现
5. **财富规划** - 帮助用户规划数字资产配置
6. **推荐管理** - 帮助用户管理推荐关系和收益

# 新增使命
- **资源赋能** - 帮助用户发现和利用自己的资源
- **价值实现** - 帮助用户将资源转化为实际收益
- **财富增长** - 帮助用户通过数字资产实现财富增值
```

### 5.2 对话示例升级

```markdown
用户: "我有设计技能，想多赚点钱"
灵值: "太好了！你的设计技能是很有价值的资源💼 让我帮你看看：
    
    1️⃣ 首先记录到你的专属资源库
    2️⃣ 我会智能匹配适合的设计项目
    3️⃣ 完成项目即可获得灵值奖励
    4️⃣ 还可以通过推荐朋友获得5%分润
    
    要不要我帮你添加到资源库？😊"
```

---

## 六、实施计划

### 6.1 第一阶段（1-2天）
- ✅ 完成数据库设计
- ✅ 创建所有新数据表
- ✅ 实现推荐分润系统

### 6.2 第二阶段（1-2天）
- ✅ 实现用户资源库系统
- ✅ 实现项目系统
- ✅ 实现资源匹配算法

### 6.3 第三阶段（1-2天）
- ✅ 实现数字资产系统
- ✅ 升级智能体工具集
- ✅ 更新智能体Prompt

### 6.4 第四阶段（1天）
- ✅ 测试所有新功能
- ✅ 部署到服务器
- ✅ 编写用户文档

---

## 七、预期成果

### 7.1 功能完整度
- ✅ 用户系统：8个功能（含推荐分润、资源库）
- ✅ 情绪系统：6个功能（保持v8.1）
- ✅ 智能对话：5个功能（保持v8.1）
- ✅ 签到系统：4个功能（保持v8.1）
- ✅ 财务系统：5个功能（保持v8.1）
- ✅ 个人中心：5个功能（保持v8.1）
- ✅ 公司动态：4个功能（保持v8.1）
- ✅ 知识系统：2个功能（保持v8.1）
- ✅ 项目系统：6个功能（**新增**）
- ✅ 数字资产系统：5个功能（**新增**）

**总计**: 11个模块，50个功能

### 7.2 商业价值
- 用户可以通过资源匹配实现变现
- 推荐人获得持续分润收入
- 形成自我增长的生态系统
- 提高用户活跃度和留存率

---

**设计完成！准备开始实施** 🚀
