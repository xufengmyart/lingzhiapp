# meiyueart.com å¤–ç½‘è®¿é—®é—®é¢˜ - å®Œæ•´è§£å†³æ–¹æ¡ˆ

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

**ç”¨æˆ·åé¦ˆ**ï¼šmeiyueart.com åŸŸåæ— æ³•å¤–ç½‘è®¿é—®ï¼Œæ˜¨å¤©å¯è®¿é—®ï¼Œä»Šå¤©ä¸è¡Œã€‚

**è¯Šæ–­ç»“è®º**ï¼šé˜¿é‡Œäº‘æœåŠ¡å™¨ï¼ˆ123.56.142.143ï¼‰ä¸Šçš„ Flask åç«¯æœåŠ¡å·²åœæ­¢è¿è¡Œã€‚

---

## ğŸ” é—®é¢˜æ ¹æºåˆ†æ

### ç½‘ç»œæ¶æ„

```
ç”¨æˆ·æµè§ˆå™¨
    â†“ (https://meiyueart.com)
åŸŸåè§£æ
    â†“ (DNS: meiyueart.com â†’ 123.56.142.143)
é˜¿é‡Œäº‘æœåŠ¡å™¨ (123.56.142.143)
    â”œâ”€ Nginx (80/443) âœ… è¿è¡Œæ­£å¸¸
    â””â”€ Flask (8080)  âŒ æœªè¿è¡Œ â†’ 502 é”™è¯¯
```

### ç¯å¢ƒå¯¹æ¯”

| é¡¹ç›® | Coze å¼€å‘ç¯å¢ƒ | é˜¿é‡Œäº‘ç”Ÿäº§æœåŠ¡å™¨ |
|------|-------------|----------------|
| å…¬ç½‘ IP | 115.190.218.237 | 123.56.142.143 |
| Nginx | âœ… è¿è¡Œæ­£å¸¸ | âœ… è¿è¡Œæ­£å¸¸ |
| Flask (8080) | âœ… è¿è¡Œæ­£å¸¸ | âŒ **æœªè¿è¡Œ** |
| SSL è¯ä¹¦ | âœ… å·²é…ç½® | âœ… å·²é…ç½® |
| å¤–ç½‘è®¿é—® | - | **502 Bad Gateway** |

### å…³é”®å‘ç°

1. âœ… **åŸŸåè§£ææ­£ç¡®**ï¼šmeiyueart.com æ­£ç¡®è§£æåˆ° 123.56.142.143
2. âœ… **Nginx æœåŠ¡æ­£å¸¸**ï¼šé˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šçš„ Nginx åœ¨è¿è¡Œ
3. âŒ **Flask æœåŠ¡åœæ­¢**ï¼šåç«¯ Flask æœåŠ¡æœªè¿è¡Œï¼Œå¯¼è‡´ 502 é”™è¯¯
4. âš ï¸ **ç¯å¢ƒéš”ç¦»**ï¼šå½“å‰ Coze ç¯å¢ƒä¸é˜¿é‡Œäº‘ç”Ÿäº§æœåŠ¡å™¨æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨

---

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šé‡å¯é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šçš„ Flask æœåŠ¡ï¼ˆæ¨èï¼‰

**é€‚ç”¨äº**ï¼šFlask ä»£ç å·²éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œåªæ˜¯æœåŠ¡åœæ­¢äº†

**æ­¥éª¤**ï¼š

```bash
# 1. SSH ç™»å½•åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
ssh root@123.56.142.143

# 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 list
# æˆ–
systemctl status flask-app

# 3. é‡å¯ Flask æœåŠ¡
pm2 restart flask-app
# æˆ–
systemctl restart flask-app

# 4. éªŒè¯æœåŠ¡å¯åŠ¨
curl http://localhost:8080/api/health
curl -k https://localhost/api/health

# 5. éªŒè¯å¤–ç½‘è®¿é—®
curl https://meiyueart.com/api/health
```

---

### æ–¹æ¡ˆäºŒï¼šé‡æ–°éƒ¨ç½² Flask æœåŠ¡åˆ°é˜¿é‡Œäº‘

**é€‚ç”¨äº**ï¼šä»£ç æœªéƒ¨ç½²æˆ–éœ€è¦é‡æ–°éƒ¨ç½²

**æ­¥éª¤**ï¼š

```bash
# 1. åœ¨æœ¬åœ°å‡†å¤‡ä»£ç 
cd /workspace/projects

# 2. ä¸Šä¼ ä»£ç åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
scp -r backend root@123.56.142.143:/var/www/meiyueart/

# 3. SSH ç™»å½•åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
ssh root@123.56.142.143

# 4. è¿è¡Œéƒ¨ç½²è„šæœ¬
cd /var/www/meiyueart
bash scripts/deploy-to-aliyun.sh

# 5. éªŒè¯éƒ¨ç½²
bash scripts/diagnose-and-fix.sh
```

---

### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ PM2 ç®¡ç†æœåŠ¡ï¼ˆå¤‡é€‰ï¼‰

**é€‚ç”¨äº**ï¼šä½¿ç”¨ PM2 ç®¡ç† Flask è¿›ç¨‹

```bash
# SSH ç™»å½•åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
ssh root@123.56.142.143

# è¿›å…¥åº”ç”¨ç›®å½•
cd /path/to/your/app

# æ£€æŸ¥ PM2 è¿›ç¨‹
pm2 list

# é‡å¯åº”ç”¨
pm2 restart flask-app

# å¦‚æœåº”ç”¨ä¸å­˜åœ¨ï¼Œå¯åŠ¨å®ƒ
pm2 start backend/app.py --name flask-app

# è®¾ç½®å¼€æœºè‡ªå¯åŠ¨
pm2 startup
pm2 save

# æŸ¥çœ‹æ—¥å¿—
pm2 logs flask-app
```

---

## âœ… éªŒè¯æ¸…å•

å®Œæˆä¿®å¤åï¼Œè¯·éªŒè¯ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] Flask æœåŠ¡åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šè¿è¡Œï¼ˆç«¯å£ 8080ï¼‰
- [ ] æœ¬åœ°è®¿é—® `http://localhost:8080/api/health` è¿”å›æ­£å¸¸
- [ ] æœ¬åœ°è®¿é—® `https://localhost/api/health` è¿”å›æ­£å¸¸
- [ ] å¤–ç½‘è®¿é—® `https://meiyueart.com/api/health` è¿”å›æ­£å¸¸
- [ ] å¤–ç½‘è®¿é—® `https://meiyueart.com` å¯ä»¥æ­£å¸¸æ‰“å¼€å‰ç«¯é¡µé¢
- [ ] ç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•å’Œä½¿ç”¨åº”ç”¨

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| `docs/SERVER-DIAGNOSIS-REPORT.md` | è¯¦ç»†çš„æœåŠ¡å™¨è¯Šæ–­æŠ¥å‘Š |
| `docs/QUICK-FIX-GUIDE.md` | å¿«é€Ÿä¿®å¤æŒ‡å— |
| `scripts/diagnose-and-fix.sh` | è‡ªåŠ¨è¯Šæ–­å’Œä¿®å¤è„šæœ¬ |
| `scripts/deploy-to-aliyun.sh` | é˜¿é‡Œäº‘æœåŠ¡å™¨éƒ¨ç½²è„šæœ¬ |

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# Nginx
systemctl status nginx
systemctl restart nginx

# Flask (systemd)
systemctl status flask-app
systemctl restart flask-app

# Flask (PM2)
pm2 list
pm2 restart flask-app
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# Nginx æ—¥å¿—
tail -f /var/log/nginx/error.log
tail -f /var/log/nginx/access.log

# Flask æ—¥å¿— (systemd)
journalctl -u flask-app -f

# Flask æ—¥å¿— (PM2)
pm2 logs flask-app
```

### ç«¯å£æ£€æŸ¥

```bash
# æŸ¥çœ‹ç«¯å£ç›‘å¬
netstat -tlnp | grep -E '80|443|8080'
# æˆ–
lsof -i :8080
```

---

## ğŸš¨ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼š502 Bad Gateway

**å¯èƒ½åŸå› **ï¼š
1. Flask æœåŠ¡æœªå¯åŠ¨
2. Flask æœåŠ¡å´©æºƒ
3. ç«¯å£ 8080 è¢«å ç”¨
4. Nginx é…ç½®é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. æ£€æŸ¥ Flask æœåŠ¡
systemctl status flask-app

# 2. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8080

# 3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
journalctl -u flask-app -n 50

# 4. é‡å¯æœåŠ¡
systemctl restart flask-app
```

---

### é—®é¢˜ï¼šæ— æ³• SSH è¿æ¥

**å¯èƒ½åŸå› **ï¼š
1. æœåŠ¡å™¨å®•æœº
2. ç½‘ç»œé—®é¢˜
3. SSH æœåŠ¡æœªè¿è¡Œ
4. é˜²ç«å¢™é˜»æ­¢

**è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨çº¿
ping 123.56.142.143

# 2. å°è¯•ä½¿ç”¨å¯†é’¥è¿æ¥
ssh -i /path/to/key.pem root@123.56.142.143

# 3. æ£€æŸ¥é˜¿é‡Œäº‘æ§åˆ¶å°
   - ç¡®è®¤æœåŠ¡å™¨çŠ¶æ€
   - æ£€æŸ¥å®‰å…¨ç»„è§„åˆ™ï¼ˆç«¯å£ 22 æ˜¯å¦å¼€æ”¾ï¼‰
```

---

### é—®é¢˜ï¼šSSL è¯ä¹¦é”™è¯¯

**å¯èƒ½åŸå› **ï¼š
1. è¯ä¹¦è¿‡æœŸ
2. è¯ä¹¦è·¯å¾„é”™è¯¯
3. è¯ä¹¦æƒé™é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. æ£€æŸ¥è¯ä¹¦
ls -la /etc/nginx/ssl/

# 2. é‡æ–°ç”Ÿæˆè¯ä¹¦
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout /etc/nginx/ssl/meiyueart.com.key \
    -out /etc/nginx/ssl/meiyueart.com.crt \
    -subj "/C=CN/ST=Beijing/L=Beijing/O=MeiyueArt/CN=meiyueart.com"

# 3. è®¾ç½®æƒé™
chmod 600 /etc/nginx/ssl/meiyueart.com.key

# 4. é‡å¯ Nginx
systemctl restart nginx
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ç³»ç»Ÿä¿¡æ¯**
   ```bash
   uname -a
   cat /etc/os-release
   ```

2. **æœåŠ¡çŠ¶æ€**
   ```bash
   systemctl status nginx
   systemctl status flask-app
   ```

3. **é”™è¯¯æ—¥å¿—**
   ```bash
   tail -20 /var/log/nginx/error.log
   journalctl -u flask-app -n 20
   ```

4. **ç«¯å£ç›‘å¬**
   ```bash
   netstat -tlnp | grep -E '80|443|8080'
   ```

5. **ç½‘ç»œæµ‹è¯•**
   ```bash
   curl -v https://meiyueart.com/api/health
   ```

---

## ğŸ“… ä¿®å¤æ—¶é—´çº¿

| æ—¶é—´ | æ“ä½œ | çŠ¶æ€ |
|------|------|------|
| 2026-02-11 08:30 | ç”¨æˆ·æŠ¥å‘Šé—®é¢˜ | - |
| 2026-02-11 08:35 | å¼€å§‹è¯Šæ–­ | è¿›è¡Œä¸­ |
| 2026-02-11 08:38 | ç¡®è®¤é—®é¢˜æ ¹æºï¼ˆFlask æœåŠ¡åœæ­¢ï¼‰ | âœ… å·²ç¡®è®¤ |
| 2026-02-11 08:40 | æä¾›è§£å†³æ–¹æ¡ˆ | âœ… å·²å®Œæˆ |
| 2026-02-11 08:45 | ç­‰å¾…ç”¨æˆ·æ‰§è¡Œä¿®å¤ | â³ å¾…å¤„ç† |

---

## ğŸ¯ é¢„é˜²æªæ–½

ä¸ºé¿å…ç±»ä¼¼é—®é¢˜å†æ¬¡å‘ç”Ÿï¼Œå»ºè®®ï¼š

1. **æœåŠ¡ç›‘æ§**ï¼šé…ç½® Uptime Robot æˆ–ç±»ä¼¼å·¥å…·ç›‘æ§æœåŠ¡å¯ç”¨æ€§
2. **è‡ªåŠ¨é‡å¯**ï¼šä½¿ç”¨ systemd çš„ `Restart=always` æˆ– PM2 çš„è‡ªåŠ¨é‡å¯åŠŸèƒ½
3. **æ—¥å¿—å‘Šè­¦**ï¼šé…ç½®æ—¥å¿—ç›‘æ§ï¼Œå¼‚å¸¸æ—¶å‘é€å‘Šè­¦
4. **å®šæœŸå¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½åº”ç”¨ä»£ç å’Œæ•°æ®åº“
5. **å¥åº·æ£€æŸ¥**ï¼šé…ç½®å¥åº·æ£€æŸ¥æ¥å£ï¼Œå®šæœŸéªŒè¯æœåŠ¡çŠ¶æ€

---

**ç”Ÿæˆæ—¶é—´**ï¼š2026-02-11 08:40
**ç‰ˆæœ¬**ï¼šv1.0
**çŠ¶æ€**ï¼šå¾…ç”¨æˆ·æ‰§è¡Œä¿®å¤
