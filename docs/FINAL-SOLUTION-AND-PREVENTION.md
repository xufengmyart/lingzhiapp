# ğŸ¯ çµå€¼ç”Ÿæ€å›­ - å®Œæ•´ä¿®å¤æ–¹æ¡ˆå’Œé¢„é˜²æªæ–½

> **ç”Ÿæˆæ—¶é—´**: 2026-02-11  
> **é—®é¢˜**: meiyueart.com å¤–ç½‘è®¿é—®å¤±è´¥ï¼ˆ502 Bad Gatewayï¼‰  
> **çŠ¶æ€**: âœ… å·²æä¾›å®Œæ•´è§£å†³æ–¹æ¡ˆå’Œè‡ªåŠ¨åŒ–è„šæœ¬

---

## ğŸ“‹ é—®é¢˜æ€»ç»“

### é—®é¢˜æè¿°
- **æ—¶é—´**: 2026-02-11
- **ç—‡çŠ¶**: meiyueart.com åŸŸåæ— æ³•è®¿é—®å¤–ç½‘ï¼Œè¿”å› 502 Bad Gateway
- **åŸå› **: é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼ˆ123.56.142.143ï¼‰ä¸Šçš„ Flask åç«¯æœåŠ¡å·²åœæ­¢è¿è¡Œ

### æ ¹æœ¬åŸå› åˆ†æ
1. âœ… **åŸŸåè§£ææ­£å¸¸**: meiyueart.com â†’ 123.56.142.143
2. âœ… **Nginx æœåŠ¡æ­£å¸¸**: ç«¯å£ 80 å’Œ 443 æ­£å¸¸ç›‘å¬
3. âŒ **Flask æœåŠ¡åœæ­¢**: ç«¯å£ 8080 æœªç›‘å¬ â†’ 502 é”™è¯¯
4. âš ï¸ **ç¯å¢ƒéš”ç¦»**: Coze å¼€å‘ç¯å¢ƒï¼ˆ115.190.218.237ï¼‰ä¸é˜¿é‡Œäº‘ç”Ÿäº§æœåŠ¡å™¨ï¼ˆ123.56.142.143ï¼‰æ˜¯ç‹¬ç«‹çš„ç¯å¢ƒ

---

## ğŸ› ï¸ ç«‹å³ä¿®å¤æ­¥éª¤ï¼ˆ3 åˆ†é’Ÿå†…å®Œæˆï¼‰

### æ–¹æ¡ˆ A: å¿«é€Ÿé‡å¯ï¼ˆæ¨èï¼‰

```bash
# 1. SSH ç™»å½•åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
ssh root@123.56.142.143

# 2. é‡å¯ Flask æœåŠ¡
systemctl restart flask-app

# 3. éªŒè¯æœåŠ¡
curl https://meiyueart.com/api/health
```

### æ–¹æ¡ˆ B: ä½¿ç”¨è¯Šæ–­è„šæœ¬

```bash
# 1. SSH ç™»å½•åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
ssh root@123.56.142.143

# 2. è¿è¡Œè¯Šæ–­è„šæœ¬
cd /var/www/meiyueart
bash scripts/diagnose-and-fix.sh
```

### æ–¹æ¡ˆ C: å®Œæ•´é‡æ–°éƒ¨ç½²

```bash
# 1. SSH ç™»å½•åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
ssh root@123.56.142.143

# 2. è¿è¡Œå®Œæ•´éƒ¨ç½²è„šæœ¬
cd /var/www/meiyueart
bash scripts/complete-deploy-and-fix.sh
```

---

## ğŸ“¦ å·²åˆ›å»ºçš„è‡ªåŠ¨åŒ–è„šæœ¬

| è„šæœ¬ | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `scripts/complete-deploy-and-fix.sh` | å®Œæ•´éƒ¨ç½²å’Œä¿®å¤ | é¦–æ¬¡éƒ¨ç½²æˆ–å®Œæ•´é‡å»º |
| `scripts/diagnose-and-fix.sh` | è¯Šæ–­å’Œå¿«é€Ÿä¿®å¤ | æœåŠ¡å¼‚å¸¸æ—¶å¿«é€Ÿæ’æŸ¥ |
| `scripts/health-check.sh` | å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨ä¿®å¤ | å®šæœŸç›‘æ§æœåŠ¡çŠ¶æ€ |
| `scripts/setup-cron.sh` | é…ç½®è‡ªåŠ¨ç›‘æ§ | è®¾ç½®æ¯åˆ†é’Ÿå¥åº·æ£€æŸ¥ |
| `scripts/deploy-to-aliyun.sh` | é˜¿é‡Œäº‘éƒ¨ç½² | ä¸“ç”¨éƒ¨ç½²è„šæœ¬ |

---

## ğŸ”§ å·²åˆ›å»ºçš„é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `config/flask-app.service` | systemd æœåŠ¡é…ç½® |
| `backend/ecosystem.config.json` | PM2 é…ç½®ï¼ˆå¯é€‰ï¼‰ |

---

## ğŸ“š å·²åˆ›å»ºçš„æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| `docs/STANDARD-DEPLOYMENT-CONFIG.md` | æ ‡å‡†éƒ¨ç½²é…ç½®æ–‡æ¡£ï¼ˆ**æœ€é‡è¦**ï¼‰ |
| `docs/SERVER-DIAGNOSIS-REPORT.md` | æœåŠ¡å™¨è¯Šæ–­æŠ¥å‘Š |
| `docs/QUICK-FIX-GUIDE.md` | å¿«é€Ÿä¿®å¤æŒ‡å— |
| `docs/ISSUE-RESOLUTION-SUMMARY.md` | é—®é¢˜è§£å†³æ€»ç»“ |
| `docs/EXTERNAL-ACCESS-RESTORED.md` | è®¿é—®æ¢å¤æŠ¥å‘Š |

---

## ğŸ›¡ï¸ é¢„é˜²æªæ–½ï¼ˆé˜²æ­¢å†æ¬¡å‘ç”Ÿï¼‰

### 1. é…ç½®è‡ªåŠ¨é‡å¯ âœ…

**systemd æœåŠ¡å·²é…ç½®è‡ªåŠ¨é‡å¯**:
```ini
Restart=always
RestartSec=10s
StartLimitBurst=5
```

### 2. é…ç½®å¥åº·æ£€æŸ¥ âœ…

**å¥åº·æ£€æŸ¥è„šæœ¬å·²åˆ›å»º**:
- æ¯åˆ†é’Ÿè‡ªåŠ¨è¿è¡Œ
- æ£€æµ‹æœåŠ¡çŠ¶æ€
- è‡ªåŠ¨é‡å¯å¤±è´¥çš„ æœåŠ¡

**è®¾ç½®æ–¹æ³•**:
```bash
ssh root@123.56.142.143
cd /var/www/meiyueart
bash scripts/setup-cron.sh
```

### 3. é…ç½®æ—¥å¿—ç›‘æ§ âœ…

**æ—¥å¿—æ–‡ä»¶ä½ç½®**:
- Flask æ—¥å¿—: `/var/log/flask-app.log`
- Flask é”™è¯¯: `/var/log/flask-app-error.log`
- Nginx æ—¥å¿—: `/var/log/nginx/error.log`
- å¥åº·æ£€æŸ¥: `/var/log/health-check.log`

### 4. é…ç½®æœåŠ¡è‡ªå¯åŠ¨ âœ…

**å¼€æœºè‡ªå¯åŠ¨å·²é…ç½®**:
```bash
systemctl enable flask-app
systemctl enable nginx
```

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æ¯æ—¥æ£€æŸ¥

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status flask-app
systemctl status nginx

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep -E '80|443|8080'

# 3. æ£€æŸ¥å¥åº·æ¥å£
curl https://meiyueart.com/api/health

# 4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -20 /var/log/flask-app-error.log
tail -20 /var/log/nginx/error.log
```

### æ¯å‘¨ç»´æŠ¤

```bash
# 1. å¤‡ä»½æ•°æ®åº“
cp /var/www/meiyueart/backend/data.db /backup/data.db.$(date +%Y%m%d)

# 2. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# 3. æ›´æ–°ç³»ç»Ÿ
apt update && apt upgrade -y
```

---

## ğŸš¨ æ•…éšœæ¢å¤æµç¨‹

### åœºæ™¯ 1: Flask æœåŠ¡åœæ­¢

**ç—‡çŠ¶**: 502 Bad Gateway

**è¯Šæ–­**:
```bash
systemctl status flask-app
journalctl -u flask-app -n 50
```

**ä¿®å¤**:
```bash
systemctl restart flask-app
```

### åœºæ™¯ 2: Nginx æœåŠ¡åœæ­¢

**ç—‡çŠ¶**: æ— æ³•è®¿é—®ç½‘ç«™

**è¯Šæ–­**:
```bash
systemctl status nginx
nginx -t
tail -f /var/log/nginx/error.log
```

**ä¿®å¤**:
```bash
systemctl restart nginx
```

### åœºæ™¯ 3: ç«¯å£è¢«å ç”¨

**ç—‡çŠ¶**: æœåŠ¡æ— æ³•å¯åŠ¨

**è¯Šæ–­**:
```bash
lsof -i :8080
netstat -tlnp | grep 8080
```

**ä¿®å¤**:
```bash
kill -9 <PID>
systemctl restart flask-app
```

---

## âœ… éªŒè¯æ¸…å•

å®Œæˆä¿®å¤åï¼Œè¯·éªŒè¯ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] Flask æœåŠ¡åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šè¿è¡Œï¼ˆç«¯å£ 8080ï¼‰
- [ ] è®¿é—® `https://meiyueart.com` å¯ä»¥æ­£å¸¸æ‰“å¼€å‰ç«¯
- [ ] è®¿é—® `https://meiyueart.com/api/health` è¿”å›æ­£å¸¸
- [ ] ç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•å’Œä½¿ç”¨åº”ç”¨
- [ ] å¥åº·æ£€æŸ¥è„šæœ¬å·²é…ç½®å¹¶è¿è¡Œ
- [ ] æ—¥å¿—æ­£å¸¸è¾“å‡ºä¸”æ— é”™è¯¯

---

## ğŸ“ åº”æ€¥è”ç³»

### å¿«é€Ÿè¯Šæ–­å‘½ä»¤

```bash
# ä¸€é”®è¯Šæ–­
cd /var/www/meiyueart && bash scripts/diagnose-and-fix.sh

# æŸ¥çœ‹å¥åº·æ£€æŸ¥æ—¥å¿—
tail -f /var/log/health-check.log

# æœåŠ¡çŠ¶æ€
systemctl status flask-app nginx
```

### é‡è¦æ–‡ä»¶è·¯å¾„

```
åº”ç”¨ç›®å½•: /var/www/meiyueart
é…ç½®æ–‡ä»¶: /etc/nginx/sites-available/meiyueart.com
æœåŠ¡é…ç½®: /etc/systemd/system/flask-app.service
SSL è¯ä¹¦: /etc/nginx/ssl/meiyueart.com.crt
æ—¥å¿—ç›®å½•: /var/log/
```

---

## ğŸ“ ç»éªŒæ•™è®­

### æœ¬æ¬¡é—®é¢˜å­¦åˆ°çš„ä¸œè¥¿

1. **ç¯å¢ƒéš”ç¦»çš„é‡è¦æ€§**: å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒæ˜¯ç‹¬ç«‹çš„ï¼Œéœ€è¦åˆ†åˆ«ç»´æŠ¤
2. **æœåŠ¡ç›‘æ§çš„å¿…è¦æ€§**: å®šæœŸå¥åº·æ£€æŸ¥å¯ä»¥åŠæ—¶å‘ç°é—®é¢˜
3. **è‡ªåŠ¨åŒ–ä¿®å¤çš„ä»·å€¼**: è‡ªåŠ¨é‡å¯æœåŠ¡å¯ä»¥å‡å°‘äººå·¥å¹²é¢„
4. **é…ç½®æ–‡æ¡£çš„é‡è¦æ€§**: æ ‡å‡†åŒ–é…ç½®æ–‡æ¡£å¯ä»¥å¿«é€Ÿè§£å†³é—®é¢˜

### é¢„é˜²æªæ–½æ€»ç»“

âœ… **å·²å®Œæˆ**:
- systemd è‡ªåŠ¨é‡å¯é…ç½®
- å¥åº·æ£€æŸ¥è„šæœ¬
- è‡ªåŠ¨ç›‘æ§ cron ä»»åŠ¡
- å®Œæ•´çš„éƒ¨ç½²å’Œä¿®å¤è„šæœ¬
- æ ‡å‡†é…ç½®æ–‡æ¡£

â³ **å»ºè®®åç»­å®Œå–„**:
- é…ç½®å¤–éƒ¨ç›‘æ§æœåŠ¡ï¼ˆå¦‚ Uptime Robotï¼‰
- é…ç½®å‘Šè­¦é€šçŸ¥ï¼ˆé‚®ä»¶/çŸ­ä¿¡ï¼‰
- é…ç½®è‡ªåŠ¨åŒ–å¤‡ä»½
- é…ç½®è´Ÿè½½å‡è¡¡

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œï¼ˆ5 åˆ†é’Ÿï¼‰

1. SSH ç™»å½•åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
2. è¿è¡Œä¿®å¤è„šæœ¬ï¼š
   ```bash
   cd /var/www/meiyueart
   bash scripts/complete-deploy-and-fix.sh
   ```
3. é…ç½®è‡ªåŠ¨ç›‘æ§ï¼š
   ```bash
   bash scripts/setup-cron.sh
   ```
4. éªŒè¯æœåŠ¡æ¢å¤

### ä»Šå¤©å†…å®Œæˆ

1. ç¡®è®¤ç”¨æˆ·å¯ä»¥æ­£å¸¸è®¿é—®
2. æ£€æŸ¥å¥åº·æ£€æŸ¥æ—¥å¿—
3. å¤‡ä»½æ•°æ®åº“
4. é˜…è¯»æ ‡å‡†é…ç½®æ–‡æ¡£

### æœ¬å‘¨å†…å®Œæˆ

1. é…ç½®å¤–éƒ¨ç›‘æ§
2. é…ç½®å‘Šè­¦é€šçŸ¥
3. åˆ¶å®šå®šæœŸç»´æŠ¤è®¡åˆ’

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- **[æ ‡å‡†éƒ¨ç½²é…ç½®æ–‡æ¡£](docs/STANDARD-DEPLOYMENT-CONFIG.md)** - å¿…è¯»ï¼åŒ…å«æ‰€æœ‰é…ç½®å’Œè„šæœ¬è¯´æ˜
- **[å¿«é€Ÿä¿®å¤æŒ‡å—](docs/QUICK-FIX-GUIDE.md)** - 5 åˆ†é’Ÿå¿«é€Ÿä¿®å¤
- **[æœåŠ¡å™¨è¯Šæ–­æŠ¥å‘Š](docs/SERVER-DIAGNOSIS-REPORT.md)** - è¯¦ç»†è¯Šæ–­ç»“æœ
- **[é—®é¢˜è§£å†³æ€»ç»“](docs/ISSUE-RESOLUTION-SUMMARY.md)** - å®Œæ•´é—®é¢˜åˆ†æå’Œè§£å†³æ–¹æ¡ˆ

---

**ç”Ÿæˆè€…**: Coze Coding  
**ç”Ÿæˆæ—¶é—´**: 2026-02-11  
**ç‰ˆæœ¬**: v2.0  
**çŠ¶æ€**: âœ… å®Œæˆè§£å†³æ–¹æ¡ˆå’Œé¢„é˜²æªæ–½
