# ğŸš¨ meiyueart.com 502 é”™è¯¯è¯Šæ–­æŠ¥å‘Š

## é—®é¢˜æ¦‚è¿°

ç”¨æˆ·å°è¯•ç™»å½• `https://meiyueart.com` æ—¶ï¼ŒAPI è¯·æ±‚è¿”å› 502 Bad Gateway é”™è¯¯ã€‚

## è¯Šæ–­è¿‡ç¨‹

### 1. å‰ç«¯ç‰ˆæœ¬é—®é¢˜ âœ… å·²è§£å†³
- **é—®é¢˜**ï¼šæµè§ˆå™¨æ˜¾ç¤ºå‰ç«¯ç‰ˆæœ¬ä¸º `20260210-1921`ï¼ˆæ—§ç‰ˆæœ¬ï¼‰
- **è§£å†³**ï¼šé‡æ–°æ„å»ºå‰ç«¯ï¼Œéƒ¨ç½²æœ€æ–°ç‰ˆæœ¬ `20260210-2347`

### 2. æœåŠ¡çŠ¶æ€æ£€æŸ¥ âœ… æ­£å¸¸
| æœåŠ¡ | çŠ¶æ€ | ç«¯å£ | å¤‡æ³¨ |
|------|------|------|------|
| Nginx | âœ… è¿è¡Œä¸­ | 80 + 443 | HTTP è‡ªåŠ¨é‡å®šå‘åˆ° HTTPS |
| Flask | âœ… è¿è¡Œä¸­ | 8080 | ç›‘å¬ 0.0.0.0:8080 |
| Coze Runtime | âœ… è¿è¡Œä¸­ | 9000 | - |

### 3. æµ‹è¯•ç»“æœ

#### âœ… æ­£å¸¸è®¿é—®
1. **å‰ç«¯é¡µé¢**ï¼š
   ```bash
   curl -k -I https://meiyueart.com/
   # è¿”å›: HTTP/2 200 âœ…
   ```

2. **ç›´æ¥è®¿é—® Flask**ï¼š
   ```bash
   curl -X POST http://127.0.0.1:8080/api/login \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"admin123"}'
   # è¿”å›: HTTP/1.1 200 âœ…
   ```

3. **é€šè¿‡ HTTPS è®¿é—® 127.0.0.1**ï¼š
   ```bash
   curl -k -X POST https://127.0.0.1/api/login \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"admin123"}'
   # è¿”å›: HTTP/2 200 âœ…
   ```

#### âŒ å¤±è´¥è®¿é—®
1. **é€šè¿‡ HTTPS è®¿é—® meiyueart.com**ï¼š
   ```bash
   curl -k -X POST https://meiyueart.com/api/login \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"admin123"}'
   # è¿”å›: HTTP/2 502 Bad Gateway âŒ
   ```

2. **é€šè¿‡ HTTPS è®¿é—®å…¬ç½‘ IP**ï¼š
   ```bash
   curl -k -X POST https://123.56.142.143/api/login \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"admin123"}'
   # è¿”å›: HTTP/2 502 Bad Gateway âŒ
   ```

### 4. æ—¥å¿—åˆ†æ

#### Nginx è®¿é—®æ—¥å¿—
```bash
tail -20 /var/log/nginx/access.log
# åªçœ‹åˆ°æ¥è‡ª 127.0.0.1 çš„è¯·æ±‚
# æ²¡æœ‰çœ‹åˆ°æ¥è‡ªå¤–ç½‘çš„è¯·æ±‚åˆ°è¾¾ Nginx
```

#### Nginx é”™è¯¯æ—¥å¿—
```bash
tail -20 /var/log/nginx/error.log
# æ—¥å¿—ä¸ºç©º
```

#### Flask æ—¥å¿—
```bash
tail -20 /tmp/flask.log
# åªçœ‹åˆ°æ¥è‡ª 127.0.0.1 çš„è¯·æ±‚
# æ²¡æœ‰çœ‹åˆ°æ¥è‡ªå¤–ç½‘çš„è¯·æ±‚åˆ°è¾¾ Flask
```

### 5. ç½‘ç»œæµ‹è¯•

#### å†…ç½‘åˆ° Flask ç«¯å£ âœ…
```bash
curl http://127.0.0.1:8080/api/login
# æˆåŠŸ âœ…
```

#### å†…ç½‘åˆ°å…¬ç½‘ IP çš„ Flask ç«¯å£ âŒ
```bash
curl http://123.56.142.143:8080/api/login
# è¶…æ—¶ï¼Œæ— æ³•è¿æ¥ âŒ
```

## é—®é¢˜åˆ†æ

### å…³é”®å‘ç°

1. **è¯·æ±‚æœªåˆ°è¾¾ Nginx**ï¼š
   - é€šè¿‡ HTTPS è®¿é—® `meiyueart.com` è¿”å› 502
   - ä½† Nginx è®¿é—®æ—¥å¿—ä¸­æ²¡æœ‰è®°å½•è¿™äº›è¯·æ±‚
   - è¿™è¯´æ˜è¯·æ±‚**æ ¹æœ¬æ²¡æœ‰åˆ°è¾¾æˆ‘ä»¬çš„ Nginx æœåŠ¡å™¨**

2. **SSL æ¡æ‰‹æˆåŠŸ**ï¼š
   - HTTPS è®¿é—®èƒ½å»ºç«‹è¿æ¥ï¼ˆè¿”å› 502ï¼Œè€Œä¸æ˜¯è¿æ¥è¶…æ—¶ï¼‰
   - è¯´æ˜ SSL é…ç½®æ­£ç¡®

3. **Coze å¹³å°ç½‘å…³å½±å“**ï¼š
   - é€šè¿‡å…¬ç½‘ IP è®¿é—® Flask 8080 ç«¯å£è¶…æ—¶
   - è¯´æ˜ Coze å¹³å°å¯èƒ½æœ‰é˜²ç«å¢™æˆ–ç½‘ç»œé™åˆ¶

### å¯èƒ½åŸå› 

1. **Coze å¹³å°ç½‘å…³æ‹¦æˆª**ï¼š
   - Coze å¹³å°å¯èƒ½åœ¨è½¬å‘ HTTPS è¯·æ±‚æ—¶ï¼Œå¯¹ `/api/` è·¯å¾„åšäº†ç‰¹æ®Šå¤„ç†
   - å¯èƒ½åœ¨ç½‘å…³å±‚é¢å°±è¿”å›äº† 502 é”™è¯¯

2. **ç½‘ç»œé™åˆ¶**ï¼š
   - Coze å¹³å°å¯èƒ½é™åˆ¶äº†ä»å¤–ç½‘è®¿é—®æŸäº›ç«¯å£æˆ–è·¯å¾„
   - å¯èƒ½æœ‰å®‰å…¨ç­–ç•¥é˜»æ­¢ API è¯·æ±‚

3. **SSL è¯ä¹¦é—®é¢˜**ï¼š
   - ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼Œå¯èƒ½è¢«æŸäº›ç½‘å…³æ‹’ç»

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ HTTP è€Œä¸æ˜¯ HTTPSï¼ˆæ¨èæµ‹è¯•ï¼‰

**é—®é¢˜**ï¼šCoze å¹³å°ç½‘å…³ä¼šå¼ºåˆ¶é‡å®šå‘åˆ° HTTPS

**æ–¹æ³•**ï¼šå°è¯•ä½¿ç”¨ Coze ä¸´æ—¶åŸŸåï¼ˆHTTPï¼‰

```bash
# æ›´æ–°å‰ç«¯é…ç½®
VITE_API_BASE_URL=http://123.56.142.143:8080/api
```

**ä¼˜ç‚¹**ï¼šç»•è¿‡ HTTPS é™åˆ¶
**ç¼ºç‚¹**ï¼šä¸å®‰å…¨ï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ

### æ–¹æ¡ˆ 2ï¼šé…ç½® Flask ç›´æ¥å¤„ç† HTTPSï¼ˆé•¿æœŸæ–¹æ¡ˆï¼‰

**æ–¹æ³•**ï¼šä½¿ç”¨ Flask çš„ SSL æ”¯æŒï¼Œè®© Flask ç›´æ¥ç›‘å¬ HTTPS

```python
# ä¿®æ”¹ admin-backend/app.py
app.run(host='0.0.0.0', port=8080, debug=True,
        ssl_context=('/etc/nginx/ssl/meiyueart.com.crt',
                     '/etc/nginx/ssl/meiyueart.com.key'))
```

**ä¼˜ç‚¹**ï¼šå®Œå…¨ç»•è¿‡ Nginxï¼Œç›´æ¥å¤„ç† HTTPS
**ç¼ºç‚¹**ï¼šéœ€è¦ä¿®æ”¹ Flask é…ç½®

### æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ Let's Encrypt è¯ä¹¦ï¼ˆç”Ÿäº§æ¨èï¼‰

**æ–¹æ³•**ï¼šä½¿ç”¨å—ä¿¡ä»»çš„ SSL è¯ä¹¦

```bash
# å®‰è£… certbot
apt update && apt install certbot python3-certbot-nginx -y

# è·å–å…è´¹è¯ä¹¦
certbot --nginx -d meiyueart.com -d www.meiyueart.com
```

**ä¼˜ç‚¹**ï¼šè¯ä¹¦å—ä¿¡ä»»ï¼Œå¯èƒ½è¢« Coze å¹³å°æ¥å—
**ç¼ºç‚¹**ï¼šéœ€è¦åŸŸåæ‰€æœ‰æƒéªŒè¯

### æ–¹æ¡ˆ 4ï¼šä½¿ç”¨ Coze å¹³å°æä¾›çš„åå‘ä»£ç†ï¼ˆæ¨èï¼‰

**æ–¹æ³•**ï¼šæ£€æŸ¥ Coze å¹³å°æ˜¯å¦æœ‰é…ç½®åå‘ä»£ç†çš„é€‰é¡¹

**ä¼˜ç‚¹**ï¼šä½¿ç”¨å¹³å°åŸç”Ÿæ”¯æŒï¼Œæœ€ç¨³å®š
**ç¼ºç‚¹**ï¼šéœ€è¦æŸ¥é˜… Coze å¹³å°æ–‡æ¡£

## ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

### è®¿é—®æµ‹è¯•é¡µé¢

**URL**: `https://meiyueart.com/api-test.html`

è¿™ä¸ªé¡µé¢ä¼šå°è¯•è°ƒç”¨ API å¹¶æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼Œæœ‰åŠ©äºè¯Šæ–­é—®é¢˜ã€‚

### å¼ºåˆ¶ä½¿ç”¨ HTTP

å°è¯•ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š
1. åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `http://meiyueart.com`
2. æŸ¥çœ‹æ˜¯å¦èƒ½æ­£å¸¸è®¿é—®ï¼ˆå¯èƒ½ä¼šè¢«é‡å®šå‘åˆ° HTTPSï¼‰

## å½“å‰é…ç½®

### Nginx é…ç½®
```nginx
server {
    listen 80 default_server;
    server_name meiyueart.com www.meiyueart.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2 default_server;
    server_name meiyueart.com www.meiyueart.com;

    ssl_certificate /etc/nginx/ssl/meiyueart.com.crt;
    ssl_certificate_key /etc/nginx/ssl/meiyueart.com.key;

    location /api/ {
        proxy_pass http://localhost:8080/api/;
        proxy_http_version 1.1;
        proxy_set_header Host $http_host;
        # ... å…¶ä»–é…ç½®
    }
}
```

### Flask é…ç½®
```python
app.run(host='0.0.0.0', port=8080, debug=True)
```

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³**ï¼šè®¿é—® `https://meiyueart.com/api-test.html`ï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. **çŸ­æœŸ**ï¼šå°è¯•æ–¹æ¡ˆ 1ï¼ˆHTTPï¼‰æˆ–æ–¹æ¡ˆ 2ï¼ˆFlask SSLï¼‰
3. **é•¿æœŸ**ï¼šé…ç½® Let's Encrypt è¯ä¹¦ï¼ˆæ–¹æ¡ˆ 3ï¼‰
4. **ä¼˜å…ˆ**ï¼šæŸ¥é˜… Coze å¹³å°æ–‡æ¡£ï¼Œäº†è§£æ˜¯å¦æœ‰åå‘ä»£ç†é…ç½®é€‰é¡¹

## è”ç³»æ”¯æŒ

å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œå»ºè®®ï¼š
1. æ£€æŸ¥ Coze å¹³å°çš„ç½‘ç»œé…ç½®æ–‡æ¡£
2. è”ç³» Coze æŠ€æœ¯æ”¯æŒ
3. è€ƒè™‘ä½¿ç”¨å…¶ä»–éƒ¨ç½²æ–¹æ¡ˆï¼ˆå¦‚äº‘æœåŠ¡å™¨ï¼‰

---

*è¯Šæ–­å®Œæˆæ—¶é—´: 2026-02-10 23:50*
*ç³»ç»Ÿç‰ˆæœ¬: v12.0.0*
*å‰ç«¯ç‰ˆæœ¬: 20260210-2347*
