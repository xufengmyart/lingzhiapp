# å¾®ä¿¡ç™»å½•åŠŸèƒ½è¶…è¯¦ç»†æ“ä½œæ‰‹å†Œ

æœ¬æ‰‹å†Œæä¾›å¾®ä¿¡ç™»å½•åŠŸèƒ½ä»é›¶åˆ°éƒ¨ç½²çš„æ¯ä¸€ä¸ªè¯¦ç»†æ“ä½œæ­¥éª¤ï¼ŒåŒ…å«å‘½ä»¤è¡Œç¤ºä¾‹ã€é…ç½®è¯´æ˜ã€æµ‹è¯•ç”¨ä¾‹ç­‰ã€‚

---

## ç›®å½•

1. [å‰ç½®å‡†å¤‡](#ä¸€å‰ç½®å‡†å¤‡)
2. [å¾®ä¿¡å¼€æ”¾å¹³å°ç”³è¯·è¯¦ç»†æ­¥éª¤](#äºŒå¾®ä¿¡å¼€æ”¾å¹³å°ç”³è¯·è¯¦ç»†æ­¥éª¤)
3. [è·å–é…ç½®ä¿¡æ¯è¯¦ç»†æ­¥éª¤](#ä¸‰è·å–é…ç½®ä¿¡æ¯è¯¦ç»†æ­¥éª¤)
4. [åç«¯é…ç½®è¯¦ç»†æ­¥éª¤](#å››åç«¯é…ç½®è¯¦ç»†æ­¥éª¤)
5. [å‰ç«¯é…ç½®è¯¦ç»†æ­¥éª¤](#äº”å‰ç«¯é…ç½®è¯¦ç»†æ­¥éª¤)
6. [æ•°æ®åº“é…ç½®è¯¦ç»†æ­¥éª¤](#å…­æ•°æ®åº“é…ç½®è¯¦ç»†æ­¥éª¤)
7. [æœ¬åœ°æµ‹è¯•è¯¦ç»†æ­¥éª¤](#ä¸ƒæœ¬åœ°æµ‹è¯•è¯¦ç»†æ­¥éª¤)
8. [éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒè¯¦ç»†æ­¥éª¤](#å…«éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒè¯¦ç»†æ­¥éª¤)
9. [æµ‹è¯•éªŒè¯è¯¦ç»†æ­¥éª¤](#ä¹æµ‹è¯•éªŒè¯è¯¦ç»†æ­¥éª¤)
10. [é—®é¢˜æ’æŸ¥è¯¦ç»†æ­¥éª¤](#åé—®é¢˜æ’æŸ¥è¯¦ç»†æ­¥éª¤)

---

## ä¸€ã€å‰ç½®å‡†å¤‡

### 1.1 æ£€æŸ¥æœ¬åœ°å¼€å‘ç¯å¢ƒ

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ Node.js ç‰ˆæœ¬**

æ‰“å¼€ç»ˆç«¯ï¼ˆWindows ä½¿ç”¨ PowerShell æˆ– CMDï¼ŒMac/Linux ä½¿ç”¨ Terminalï¼‰ï¼Œæ‰§è¡Œï¼š

```bash
node --version
```

**é¢„æœŸè¾“å‡ºï¼š**
```
v18.17.0 æˆ–æ›´é«˜ç‰ˆæœ¬
```

å¦‚æœç‰ˆæœ¬ä½äº 18ï¼Œéœ€è¦å‡çº§ Node.jsã€‚è®¿é—® https://nodejs.org/ ä¸‹è½½æœ€æ–° LTS ç‰ˆæœ¬ã€‚

**æ­¥éª¤ 2ï¼šæ£€æŸ¥ npm ç‰ˆæœ¬**

```bash
npm --version
```

**é¢„æœŸè¾“å‡ºï¼š**
```
9.x.x æˆ–æ›´é«˜ç‰ˆæœ¬
```

**æ­¥éª¤ 3ï¼šæ£€æŸ¥ Python ç‰ˆæœ¬**

```bash
python3 --version
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Python 3.13.0 æˆ–æ›´é«˜ç‰ˆæœ¬
```

**æ­¥éª¤ 4ï¼šæ£€æŸ¥ pip ç‰ˆæœ¬**

```bash
pip3 --version
```

**é¢„æœŸè¾“å‡ºï¼š**
```
pip 24.x.x from /usr/local/lib/python3.13/site-packages/pip (python 3.13)
```

### 1.2 æ£€æŸ¥æœåŠ¡å™¨ç¯å¢ƒ

**æ­¥éª¤ 1ï¼šç™»å½•æœåŠ¡å™¨**

```bash
ssh root@123.56.142.143
```

è¾“å…¥å¯†ç ï¼š`Meiyue@root123`

**æ­¥éª¤ 2ï¼šæ£€æŸ¥ Python ç‰ˆæœ¬**

```bash
python3 --version
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Python 3.13.0
```

**æ­¥éª¤ 3ï¼šæ£€æŸ¥ Node.js ç‰ˆæœ¬**

```bash
node --version
```

**é¢„æœŸè¾“å‡ºï¼š**
```
v18.17.0
```

**æ­¥éª¤ 4ï¼šæ£€æŸ¥ Nginx ç‰ˆæœ¬**

```bash
nginx -v
```

**é¢„æœŸè¾“å‡ºï¼š**
```
nginx version: nginx/1.24.0
```

**æ­¥éª¤ 5ï¼šæ£€æŸ¥é˜²ç«å¢™çŠ¶æ€**

```bash
ufw status
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Status: active

To                         Action      From
--                         ------      ----
80/tcp                     ALLOW       Anywhere
443/tcp                    ALLOW       Anywhere
8001/tcp                   ALLOW       Anywhere
```

å¦‚æœç«¯å£æœªå¼€æ”¾ï¼Œæ‰§è¡Œï¼š

```bash
ufw allow 8001/tcp
ufw allow 80/tcp
ufw allow 443/tcp
```

### 1.3 å‡†å¤‡ç”³è¯·ææ–™

åœ¨å¼€å§‹ç”³è¯·å¾®ä¿¡å¼€æ”¾å¹³å°ä¹‹å‰ï¼Œå‡†å¤‡ä»¥ä¸‹ææ–™ï¼š

1. **è¥ä¸šæ‰§ç…§**
   - æ ¼å¼ï¼šJPG æˆ– PNG
   - å¤§å°ï¼šä¸è¶…è¿‡ 5MB
   - è¦æ±‚ï¼šæ¸…æ™°ã€å®Œæ•´ã€å½©è‰²æ‰«æ

2. **ç»„ç»‡æœºæ„ä»£ç è¯**ï¼ˆå¦‚æœè¥ä¸šæ‰§ç…§æ²¡æœ‰ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼‰
   - æ ¼å¼ï¼šJPG æˆ– PNG
   - å¤§å°ï¼šä¸è¶…è¿‡ 5MB

3. **å¯¹å…¬é“¶è¡Œè´¦æˆ·ä¿¡æ¯**
   - é“¶è¡Œåç§°
   - å¼€æˆ·è¡Œ
   - è´¦å·
   - è´¦æˆ·åç§°ï¼ˆå¿…é¡»ä¸è¥ä¸šæ‰§ç…§ä¸€è‡´ï¼‰

4. **è¿è¥è€…èº«ä»½è¯**
   - æ­£åé¢ç…§ç‰‡
   - æ ¼å¼ï¼šJPG æˆ– PNG
   - å¤§å°ï¼šæ¯å¼ ä¸è¶…è¿‡ 5MB

5. **åº”ç”¨å›¾æ ‡**
   - å°ºå¯¸ï¼š108x108 åƒç´ 
   - æ ¼å¼ï¼šPNG
   - å¤§å°ï¼šä¸è¶…è¿‡ 2MB
   - è¦æ±‚ï¼šåœ†è§’ã€æ­£æ–¹å½¢ã€æ¸…æ™°

6. **åº”ç”¨å®˜ç½‘åœ°å€**
   - æ ¼å¼ï¼šhttps://your-domain.com
   - è¦æ±‚ï¼šå¯æ­£å¸¸è®¿é—®

---

## äºŒã€å¾®ä¿¡å¼€æ”¾å¹³å°ç”³è¯·è¯¦ç»†æ­¥éª¤

### 2.1 æ³¨å†Œå¼€å‘è€…è´¦å·

**æ­¥éª¤ 1ï¼šè®¿é—®å¾®ä¿¡å¼€æ”¾å¹³å°**

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼šhttps://open.weixin.qq.com/

ä½ ä¼šçœ‹åˆ°å¾®ä¿¡å¼€æ”¾å¹³å°çš„é¦–é¡µï¼Œé¡¶éƒ¨æœ‰"ç™»å½•"å’Œ"æ³¨å†Œ"æŒ‰é’®ã€‚

**æ­¥éª¤ 2ï¼šç‚¹å‡»æ³¨å†Œ**

ç‚¹å‡»å³ä¸Šè§’çš„"æ³¨å†Œ"æŒ‰é’®ã€‚

**æ­¥éª¤ 3ï¼šé€‰æ‹©è´¦å·ç±»å‹**

ä¼šå‡ºç°è´¦å·ç±»å‹é€‰æ‹©é¡µé¢ï¼š
- â–¡ ä¸ªäºº
- â—‹ ä¼ä¸šï¼ˆé€‰æ‹©æ­¤é¡¹ï¼‰
- â–¡ æ”¿åºœ
- â–¡ åª’ä½“
- â–¡ å…¶ä»–ç»„ç»‡

**ç‚¹å‡»"ä¼ä¸š"é€‰é¡¹ã€‚**

**æ­¥éª¤ 4ï¼šå¡«å†™ä¼ä¸šä¿¡æ¯**

å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š

```
ä¼ä¸šåç§°ï¼šé™•è¥¿åª„æœˆå•†ä¸šè‰ºæœ¯æœ‰é™è´£ä»»å…¬å¸
ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼š91610100MA6TXL4X1X
æ³¨å†Œåœ°å€ï¼šé™•è¥¿çœè¥¿å®‰å¸‚é›å¡”åŒºXXè·¯XXå·
è”ç³»äººå§“åï¼šå¼ ä¸‰
è”ç³»äººæ‰‹æœºï¼š13800138000
è”ç³»äººé‚®ç®±ï¼šzhangsan@example.com
```

**æ­¥éª¤ 5ï¼šä¸Šä¼ è¥ä¸šæ‰§ç…§**

ç‚¹å‡»"ä¸Šä¼ è¥ä¸šæ‰§ç…§"æŒ‰é’®ï¼Œé€‰æ‹©è¥ä¸šæ‰§ç…§å›¾ç‰‡æ–‡ä»¶ã€‚

ç¡®ä¿ï¼š
- å›¾ç‰‡æ¸…æ™°
- æ‰€æœ‰ä¿¡æ¯å¯è§
- æ²¡æœ‰é®æŒ¡

**æ­¥éª¤ 6ï¼šå¡«å†™å¯¹å…¬é“¶è¡Œè´¦æˆ·**

```
å¼€æˆ·é“¶è¡Œï¼šå·¥å•†é“¶è¡Œè¥¿å®‰åˆ†è¡Œ
é“¶è¡Œè´¦å·ï¼š6222021234567890123
è´¦æˆ·åç§°ï¼šé™•è¥¿åª„æœˆå•†ä¸šè‰ºæœ¯æœ‰é™è´£ä»»å…¬å¸
```

**æ­¥éª¤ 7ï¼šå‹¾é€‰åŒæ„æ¡æ¬¾**

å‹¾é€‰"æˆ‘å·²é˜…è¯»å¹¶åŒæ„ã€Šå¾®ä¿¡å¼€æ”¾å¹³å°æœåŠ¡åè®®ã€‹"

**æ­¥éª¤ 8ï¼šæäº¤æ³¨å†Œ**

ç‚¹å‡»"æäº¤"æŒ‰é’®ã€‚

**æ­¥éª¤ 9ï¼šç­‰å¾…å®¡æ ¸**

æäº¤åä¼šæ˜¾ç¤ºï¼š

```
æ‚¨çš„æ³¨å†Œä¿¡æ¯å·²æäº¤ï¼Œæˆ‘ä»¬å°†åœ¨1-3ä¸ªå·¥ä½œæ—¥å†…å®Œæˆå®¡æ ¸ã€‚
å®¡æ ¸ç»“æœå°†é€šè¿‡çŸ­ä¿¡å’Œé‚®ä»¶é€šçŸ¥æ‚¨ã€‚
```

### 2.2 åˆ›å»ºç½‘ç«™åº”ç”¨

**æ­¥éª¤ 1ï¼šç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°**

ä½¿ç”¨æ³¨å†ŒæˆåŠŸçš„è´¦å·ç™»å½•ï¼šhttps://open.weixin.qq.com/

**æ­¥éª¤ 2ï¼šè¿›å…¥ç®¡ç†ä¸­å¿ƒ**

ç™»å½•åï¼Œç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„"ç®¡ç†ä¸­å¿ƒ"

ä½ ä¼šçœ‹åˆ°ï¼š
- å·¦ä¾§èœå•æ 
- ä¸­é—´å†…å®¹åŒºåŸŸ

**æ­¥éª¤ 3ï¼šé€‰æ‹©"ç½‘ç«™åº”ç”¨"**

åœ¨å·¦ä¾§èœå•ä¸­ï¼Œç‚¹å‡»"ç½‘ç«™åº”ç”¨"

**æ­¥éª¤ 4ï¼šç‚¹å‡»"åˆ›å»ºç½‘ç«™åº”ç”¨"**

åœ¨é¡µé¢å³ä¾§ï¼Œç‚¹å‡»"åˆ›å»ºç½‘ç«™åº”ç”¨"æŒ‰é’®

**æ­¥éª¤ 5ï¼šå¡«å†™åº”ç”¨åŸºæœ¬ä¿¡æ¯**

å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š

```
åº”ç”¨åç§°ï¼šçµå€¼ç”Ÿæ€å›­
åº”ç”¨ç®€ä»‹ï¼šåŸºäºAIçš„æ–‡åŒ–ä»·å€¼åˆ›é€ å¹³å°ï¼Œæä¾›æ™ºèƒ½å¯¹è¯ã€ç”¨æˆ·æ—…ç¨‹ç®¡ç†ã€çµå€¼ç»æµæ¨¡å‹ç­‰åŠŸèƒ½ï¼Œè®©ç”¨æˆ·é€šè¿‡ä»·å€¼åˆ›é€ è·å¾—æ”¶ç›Šã€‚
åº”ç”¨å®˜ç½‘ï¼šhttps://meiyueart.com
```

**æ­¥éª¤ 6ï¼šä¸Šä¼ åº”ç”¨å›¾æ ‡**

ç‚¹å‡»"ä¸Šä¼ å›¾æ ‡"æŒ‰é’®ï¼Œé€‰æ‹©å‡†å¤‡å¥½çš„ 108x108 PNG å›¾æ ‡ã€‚

ç¡®ä¿ï¼š
- å›¾æ ‡æ¸…æ™°
- æ— è¾¹è·
- åœ†è§’
- èƒŒæ™¯é€æ˜æˆ–çº¯è‰²

**æ­¥éª¤ 7ï¼šé€‰æ‹©æœåŠ¡ç±»ç›®**

åœ¨"æœåŠ¡ç±»ç›®"ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ï¼š
- å·¥å…· æˆ–
- ç”Ÿæ´»æœåŠ¡

**æ­¥éª¤ 8ï¼šå¡«å†™å¼€å‘è€…ä¿¡æ¯**

```
å¼€å‘è€…åç§°ï¼šé™•è¥¿åª„æœˆå•†ä¸šè‰ºæœ¯æœ‰é™è´£ä»»å…¬å¸
è”ç³»äººå§“åï¼šå¼ ä¸‰
è”ç³»äººæ‰‹æœºï¼š13800138000
è”ç³»äººé‚®ç®±ï¼šzhangsan@example.com
```

**æ­¥éª¤ 9ï¼šå‹¾é€‰åŒæ„æ¡æ¬¾**

å‹¾é€‰"æˆ‘å·²é˜…è¯»å¹¶åŒæ„ã€Šå¾®ä¿¡å¼€æ”¾å¹³å°æœåŠ¡åè®®ã€‹"

**æ­¥éª¤ 10ï¼šæäº¤å®¡æ ¸**

ç‚¹å‡»"æäº¤å®¡æ ¸"æŒ‰é’®ã€‚

**æ­¥éª¤ 11ï¼šç­‰å¾…å®¡æ ¸**

æäº¤åä¼šæ˜¾ç¤ºï¼š

```
æ‚¨çš„åº”ç”¨å·²æäº¤å®¡æ ¸ï¼Œæˆ‘ä»¬å°†åœ¨3-7ä¸ªå·¥ä½œæ—¥å†…å®Œæˆå®¡æ ¸ã€‚
å®¡æ ¸é€šè¿‡åï¼Œç³»ç»Ÿå°†åˆ†é…AppIDå’ŒAppSecretã€‚
```

### 2.3 å®¡æ ¸é€šè¿‡åçš„æ“ä½œ

**æ­¥éª¤ 1ï¼šæŸ¥çœ‹å®¡æ ¸ç»“æœ**

å®¡æ ¸é€šè¿‡åï¼Œä½ ä¼šæ”¶åˆ°çŸ­ä¿¡å’Œé‚®ä»¶é€šçŸ¥ã€‚

**æ­¥éª¤ 2ï¼šè¿›å…¥åº”ç”¨è¯¦æƒ…é¡µ**

ç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°ï¼Œè¿›å…¥"ç®¡ç†ä¸­å¿ƒ" > "ç½‘ç«™åº”ç”¨"ï¼Œç‚¹å‡»åº”ç”¨åç§°"çµå€¼ç”Ÿæ€å›­"

**æ­¥éª¤ 3ï¼šæŸ¥çœ‹å¼€å‘ä¿¡æ¯**

åœ¨åº”ç”¨è¯¦æƒ…é¡µä¸­ï¼Œç‚¹å‡»"å¼€å‘ä¿¡æ¯"æ ‡ç­¾é¡µ

ä½ ä¼šçœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š

```
AppIDï¼šwx1234567890abcdef
AppSecretï¼š1234567890abcdef1234567890abcdef
```

**æ­¥éª¤ 4ï¼šä¿å­˜é…ç½®ä¿¡æ¯**

å°†ä»¥ä¸‹ä¿¡æ¯å¤åˆ¶åˆ°è®°äº‹æœ¬ï¼Œä¿å­˜ä¸º `å¾®ä¿¡é…ç½®.txt`ï¼š

```
AppID: wx1234567890abcdef
AppSecret: 1234567890abcdef1234567890abcdef
åº”ç”¨åç§°: çµå€¼ç”Ÿæ€å›­
```

âš ï¸ **é‡è¦æç¤ºï¼š**
- AppSecret æ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦æ³„éœ²
- ä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
- å®šæœŸæ›´æ¢ AppSecret

---

## ä¸‰ã€è·å–é…ç½®ä¿¡æ¯è¯¦ç»†æ­¥éª¤

### 3.1 æŸ¥çœ‹åº”ç”¨ä¿¡æ¯

**æ­¥éª¤ 1ï¼šç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°**

è®¿é—®ï¼šhttps://open.weixin.qq.com/

**æ­¥éª¤ 2ï¼šè¿›å…¥åº”ç”¨è¯¦æƒ…é¡µ**

1. ç‚¹å‡»"ç®¡ç†ä¸­å¿ƒ"
2. ç‚¹å‡»"ç½‘ç«™åº”ç”¨"
3. ç‚¹å‡»"çµå€¼ç”Ÿæ€å›­"

**æ­¥éª¤ 3ï¼šæŸ¥çœ‹ AppID å’Œ AppSecret**

åœ¨"å¼€å‘ä¿¡æ¯"æ ‡ç­¾é¡µä¸­ï¼Œæ‰¾åˆ°ï¼š

```
AppIDï¼šwx1234567890abcdef
AppSecretï¼š1234567890abcdef1234567890abcdef
```

**æ­¥éª¤ 4ï¼šéªŒè¯ AppID æ ¼å¼**

AppID åº”è¯¥æ˜¯ï¼š
- ä»¥ `wx` å¼€å¤´
- æ€»å…± 18 ä½å­—ç¬¦

ç¤ºä¾‹ï¼š`wx1234567890abcdef`ï¼ˆæ­£ç¡®ï¼‰
ç¤ºä¾‹ï¼š`1234567890abcdef`ï¼ˆé”™è¯¯ï¼Œç¼ºå°‘ wxï¼‰
ç¤ºä¾‹ï¼š`wx1234567890abcdefghij`ï¼ˆé”™è¯¯ï¼Œè¶…è¿‡ 18 ä½ï¼‰

**æ­¥éª¤ 5ï¼šéªŒè¯ AppSecret æ ¼å¼**

AppSecret åº”è¯¥æ˜¯ï¼š
- 32 ä½å­—ç¬¦
- åŒ…å«å­—æ¯å’Œæ•°å­—

ç¤ºä¾‹ï¼š`1234567890abcdef1234567890abcdef`ï¼ˆæ­£ç¡®ï¼‰

### 3.2 é…ç½®æˆæƒå›è°ƒåŸŸ

**æ­¥éª¤ 1ï¼šæ‰¾åˆ°"æˆæƒå›è°ƒåŸŸ"**

åœ¨"å¼€å‘ä¿¡æ¯"æ ‡ç­¾é¡µä¸­ï¼Œæ‰¾åˆ°"æˆæƒå›è°ƒåŸŸ"è®¾ç½®é¡¹ã€‚

**æ­¥éª¤ 2ï¼šç‚¹å‡»"ä¿®æ”¹"**

ç‚¹å‡»"æˆæƒå›è°ƒåŸŸ"å³ä¾§çš„"ä¿®æ”¹"æŒ‰é’®ã€‚

**æ­¥éª¤ 3ï¼šå¡«å†™å›è°ƒåŸŸå**

è¾“å…¥åŸŸåï¼ˆåªå¡«åŸŸåï¼Œä¸å«åè®®å’Œè·¯å¾„ï¼‰ï¼š

```
meiyueart.com
```

**âš ï¸ é‡è¦æç¤ºï¼š**
- âŒ é”™è¯¯ï¼š`http://meiyueart.com`ï¼ˆåŒ…å«åè®®ï¼‰
- âŒ é”™è¯¯ï¼š`https://meiyueart.com`ï¼ˆåŒ…å«åè®®ï¼‰
- âŒ é”™è¯¯ï¼š`meiyueart.com/wechat/callback`ï¼ˆåŒ…å«è·¯å¾„ï¼‰
- âœ… æ­£ç¡®ï¼š`meiyueart.com`

**æ­¥éª¤ 4ï¼šç‚¹å‡»"ç¡®å®š"**

ç‚¹å‡»"ç¡®å®š"æŒ‰é’®ä¿å­˜é…ç½®ã€‚

### 3.3 å¤åˆ¶é…ç½®ä¿¡æ¯

åˆ›å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå‘½åä¸º `å¾®ä¿¡é…ç½®.txt`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
===================================
å¾®ä¿¡å¼€æ”¾å¹³å°é…ç½®ä¿¡æ¯
===================================

AppID: wx1234567890abcdef
AppSecret: 1234567890abcdef1234567890abcdef
æˆæƒå›è°ƒåŸŸ: meiyueart.com

å®Œæ•´å›è°ƒåœ°å€: https://meiyueart.com/wechat/callback

æ³¨æ„äº‹é¡¹:
1. AppSecret æ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦æ³„éœ²
2. ä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
3. å®šæœŸæ›´æ¢ AppSecret

===================================
é…ç½®æ—¶é—´: 2026-02-01
===================================
```

ä¿å­˜æ­¤æ–‡ä»¶åˆ°å®‰å…¨ä½ç½®ã€‚

---

## å››ã€åç«¯é…ç½®è¯¦ç»†æ­¥éª¤

### 4.1 åˆ›å»º .env æ–‡ä»¶

**æ­¥éª¤ 1ï¼šè¿›å…¥é¡¹ç›®ç›®å½•**

```bash
cd /workspace/projects/admin-backend
```

**æ­¥éª¤ 2ï¼šæ£€æŸ¥ .env æ–‡ä»¶æ˜¯å¦å­˜åœ¨**

```bash
ls -la .env
```

å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒï¼š

```bash
touch .env
```

**æ­¥éª¤ 3ï¼šç¼–è¾‘ .env æ–‡ä»¶**

```bash
nano .env
```

**æ­¥éª¤ 4ï¼šæ·»åŠ å¾®ä¿¡é…ç½®**

åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```env
# ====================================
# å¾®ä¿¡å¼€æ”¾å¹³å°é…ç½®
# ====================================
WECHAT_APP_ID=wx1234567890abcdef
WECHAT_APP_SECRET=1234567890abcdef1234567890abcdef
WECHAT_REDIRECT_URI=https://meiyueart.com/wechat/callback
```

**é…ç½®è¯´æ˜ï¼š**

1. `WECHAT_APP_ID`
   - ä»å¾®ä¿¡å¼€æ”¾å¹³å°è·å–
   - æ ¼å¼ï¼šwx å¼€å¤´ï¼Œ18ä½
   - ç¤ºä¾‹ï¼š`wx1234567890abcdef`

2. `WECHAT_APP_SECRET`
   - ä»å¾®ä¿¡å¼€æ”¾å¹³å°è·å–
   - æ ¼å¼ï¼š32ä½å­—ç¬¦
   - ç¤ºä¾‹ï¼š`1234567890abcdef1234567890abcdef`

3. `WECHAT_REDIRECT_URI`
   - å¾®ä¿¡æˆæƒåçš„å›è°ƒåœ°å€
   - æ ¼å¼ï¼šå®Œæ•´çš„ URL
   - ç¤ºä¾‹ï¼š`https://meiyueart.com/wechat/callback`
   - æ³¨æ„ï¼šå¿…é¡»ä¸å¾®ä¿¡å¼€æ”¾å¹³å°ä¸­çš„æˆæƒå›è°ƒåŸŸçš„åŸŸåéƒ¨åˆ†ä¸€è‡´

**æ­¥éª¤ 5ï¼šä¿å­˜æ–‡ä»¶**

æŒ‰ `Ctrl + O` ä¿å­˜ï¼Œç„¶åæŒ‰ `Ctrl + X` é€€å‡ºã€‚

**æ­¥éª¤ 6ï¼šéªŒè¯æ–‡ä»¶å†…å®¹**

```bash
cat .env
```

**é¢„æœŸè¾“å‡ºï¼š**
```
WECHAT_APP_ID=wx1234567890abcdef
WECHAT_APP_SECRET=1234567890abcdef1234567890abcdef
WECHAT_REDIRECT_URI=https://meiyueart.com/wechat/callback
```

### 4.2 éªŒè¯é…ç½®

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ app.py æ˜¯å¦è¯»å–ç¯å¢ƒå˜é‡**

```bash
grep -n "WECHAT_APP_ID" app.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
35:WECHAT_APP_ID = os.getenv('WECHAT_APP_ID', '')
```

**æ­¥éª¤ 2ï¼šæµ‹è¯• Python è¯»å–ç¯å¢ƒå˜é‡**

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test_env.py`ï¼š

```bash
cat > test_env.py << 'EOF'
import os
from dotenv import load_dotenv

load_dotenv()

print("å¾®ä¿¡é…ç½®ä¿¡æ¯ï¼š")
print(f"AppID: {os.getenv('WECHAT_APP_ID')}")
print(f"AppSecret: {os.getenv('WECHAT_APP_SECRET')}")
print(f"å›è°ƒåœ°å€: {os.getenv('WECHAT_REDIRECT_URI')}")
EOF
```

**æ­¥éª¤ 3ï¼šè¿è¡Œæµ‹è¯•è„šæœ¬**

```bash
python3 test_env.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
å¾®ä¿¡é…ç½®ä¿¡æ¯ï¼š
AppID: wx1234567890abcdef
AppSecret: 1234567890abcdef1234567890abcdef
å›è°ƒåœ°å€: https://meiyueart.com/wechat/callback
```

**æ­¥éª¤ 4ï¼šåˆ é™¤æµ‹è¯•è„šæœ¬**

```bash
rm test_env.py
```

### 4.3 æ£€æŸ¥ä¾èµ–

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ requirements.txt**

```bash
grep -E "(requests|urllib)" requirements.txt
```

å¦‚æœæ²¡æœ‰ requestsï¼Œéœ€è¦æ·»åŠ ï¼š

```bash
echo "requests>=2.31.0" >> requirements.txt
```

**æ­¥éª¤ 2ï¼šå®‰è£…ä¾èµ–**

```bash
pip3 install -r requirements.txt
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Collecting requests>=2.31.0
  Using cached requests-2.31.0-py3-none-any.whl
Installing collected packages: requests
Successfully installed requests-2.31.0
```

### 4.4 æµ‹è¯•åç«¯æœåŠ¡

**æ­¥éª¤ 1ï¼šå¯åŠ¨åç«¯æœåŠ¡**

```bash
python3 app.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
==================================================
çµå€¼ç”Ÿæ€å›­ API æœåŠ¡å¯åŠ¨ä¸­...
==================================================
æœåŠ¡åœ°å€: http://0.0.0.0:8001
é»˜è®¤ç®¡ç†å‘˜è´¦å·: admin / admin123
==================================================
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8001
 * Running on http://172.16.107.129:8001
```

**æ­¥éª¤ 2ï¼šæµ‹è¯•å¾®ä¿¡ç™»å½• API**

æ‰“å¼€æ–°çš„ç»ˆç«¯çª—å£ï¼Œæ‰§è¡Œï¼š

```bash
curl -s http://localhost:8001/api/wechat/login | python3 -m json.tool
```

**é¢„æœŸè¾“å‡ºï¼š**
```json
{
    "success": true,
    "data": {
        "auth_url": "https://open.weixin.qq.com/connect/qrconnect?appid=wx1234567890abcdef&redirect_uri=https%3A%2F%2Fmeiyueart.com%2Fwechat%2Fcallback&response_type=code&scope=snsapi_userinfo&state=abc123def456",
        "state": "abc123def456"
    }
}
```

**æ­¥éª¤ 3ï¼šåœæ­¢æœåŠ¡**

å›åˆ°ç¬¬ä¸€ä¸ªç»ˆç«¯ï¼ŒæŒ‰ `Ctrl + C` åœæ­¢æœåŠ¡ã€‚

---

## äº”ã€å‰ç«¯é…ç½®è¯¦ç»†æ­¥éª¤

### 5.1 æ£€æŸ¥å‰ç«¯é¡¹ç›®ç»“æ„

**æ­¥éª¤ 1ï¼šè¿›å…¥å‰ç«¯ç›®å½•**

```bash
cd /workspace/projects/web-app
```

**æ­¥éª¤ 2ï¼šæŸ¥çœ‹ç›®å½•ç»“æ„**

```bash
ls -la src/pages/
```

**é¢„æœŸè¾“å‡ºï¼š**
```
total XXX
-rw-r--r-- 1 root root XXXXX Feb 1 16:00 Chat.tsx
-rw-r--r-- 1 root root XXXXX Feb 1 16:00 CompleteProfile.tsx
-rw-r--r-- 1 root root XXXXX Feb 1 16:00 Dashboard.tsx
-rw-r--r-- 1 root root XXXXX Feb 1 16:00 Login.tsx
-rw-r--r-- 1 root root XXXXX Feb 1 16:00 WeChatCallback.tsx
```

### 5.2 æ£€æŸ¥ API é…ç½®

**æ­¥éª¤ 1ï¼šæŸ¥çœ‹ services/api.ts**

```bash
head -30 src/services/api.ts
```

**é¢„æœŸè¾“å‡ºï¼š**
```typescript
import axios from 'axios'

// API åŸºç¡€é…ç½®
export const api = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8001',
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json'
  }
})
```

**æ­¥éª¤ 2ï¼šæ£€æŸ¥ .env æ–‡ä»¶**

```bash
cat .env 2>/dev/null || echo ".env æ–‡ä»¶ä¸å­˜åœ¨"
```

å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒï¼š

```bash
cat > .env << 'EOF'
VITE_API_BASE_URL=http://localhost:8001
EOF
```

### 5.3 æ£€æŸ¥è·¯ç”±é…ç½®

**æ­¥éª¤ 1ï¼šæŸ¥çœ‹ App.tsx**

```bash
grep -A 5 "WeChatCallback" src/App.tsx
```

**é¢„æœŸè¾“å‡ºï¼š**
```typescript
import WeChatCallback from './pages/WeChatCallback'
...
<Route path="/wechat/callback" element={<WeChatCallback />} />
```

### 5.4 æ„å»ºå‰ç«¯é¡¹ç›®

**æ­¥éª¤ 1ï¼šå®‰è£…ä¾èµ–**

```bash
npm install
```

**é¢„æœŸè¾“å‡ºï¼š**
```
added 1234 packages in 30s
```

**æ­¥éª¤ 2ï¼šæ„å»ºé¡¹ç›®**

```bash
npm run build
```

**é¢„æœŸè¾“å‡ºï¼š**
```
vite v5.4.21 building for production...
transforming...
âœ“ 1746 modules transformed.
rendering chunks...
dist/index.html                   1.01 kB
dist/assets/index-DWiXBgf8.css   66.62 kB
dist/assets/index-VtmmBusm.js   616.26 kB
built in 6.16s
```

**æ­¥éª¤ 3ï¼šæ£€æŸ¥æ„å»ºäº§ç‰©**

```bash
ls -lh dist/
```

**é¢„æœŸè¾“å‡ºï¼š**
```
total 664K
-rw-r--r-- 1 root root 1.0K Feb 1 16:00 index.html
drwxr-xr-x 2 root root 4.0K Feb 1 16:00 assets
```

### 5.5 æœ¬åœ°æµ‹è¯•å‰ç«¯

**æ­¥éª¤ 1ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨**

```bash
npm run dev
```

**é¢„æœŸè¾“å‡ºï¼š**
```
VITE v5.4.21  ready in 234 ms

âœ  Local:   http://localhost:5173/
âœ  Network: use --host to expose
```

**æ­¥éª¤ 2ï¼šè®¿é—®æœ¬åœ°ç½‘ç«™**

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼šhttp://localhost:5173

**æ­¥éª¤ 3ï¼šæµ‹è¯•ç™»å½•é¡µé¢**

1. ç‚¹å‡»"ç™»å½•"æŒ‰é’®
2. æŸ¥çœ‹æ˜¯å¦æœ‰"å¾®ä¿¡ç™»å½•"æŒ‰é’®
3. æŸ¥çœ‹æŒ‰é’®æ ·å¼æ˜¯å¦æ­£ç¡®

**æ­¥éª¤ 4ï¼šåœæ­¢æœåŠ¡**

æŒ‰ `Ctrl + C` åœæ­¢æœåŠ¡ã€‚

---

## å…­ã€æ•°æ®åº“é…ç½®è¯¦ç»†æ­¥éª¤

### 6.1 æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶

**æ­¥éª¤ 1ï¼šæŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶**

```bash
cd /workspace/projects/admin-backend
ls -lh *.db
```

**é¢„æœŸè¾“å‡ºï¼š**
```
-rw-r--r-- 1 root root 288K Feb 1 16:00 lingzhi_ecosystem.db
```

### 6.2 æ£€æŸ¥è¡¨ç»“æ„

**æ­¥éª¤ 1ï¼šä½¿ç”¨ SQLite æŸ¥çœ‹è¡¨ç»“æ„**

```bash
sqlite3 lingzhi_ecosystem.db ".schema users"
```

**é¢„æœŸè¾“å‡ºï¼š**
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE NOT NULL,
    email TEXT,
    phone TEXT,
    password_hash TEXT NOT NULL,
    total_lingzhi INTEGER DEFAULT 0,
    status TEXT DEFAULT 'active',
    last_login_at TIMESTAMP,
    avatar_url TEXT,
    real_name TEXT,
    is_verified BOOLEAN DEFAULT 0,
    login_type TEXT DEFAULT 'phone',
    wechat_openid TEXT UNIQUE,
    wechat_unionid TEXT,
    wechat_nickname TEXT,
    wechat_avatar TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**æ­¥éª¤ 2ï¼šæ£€æŸ¥å­—æ®µæ˜¯å¦å®Œæ•´**

```bash
sqlite3 lingzhi_ecosystem.db "PRAGMA table_info(users);"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
0|id|INTEGER|0||1
1|username|TEXT|1||0
2|email|TEXT|0||0
3|phone|TEXT|0||0
4|password_hash|TEXT|1||0
5|total_lingzhi|INTEGER|0||0
6|status|TEXT|0||0
7|last_login_at|TIMESTAMP|0||0
8|avatar_url|TEXT|0||0
9|real_name|TEXT|0||0
10|is_verified|BOOLEAN|0||0
11|login_type|TEXT|0||0
12|wechat_openid|TEXT|0||0
13|wechat_unionid|TEXT|0||0
14|wechat_nickname|TEXT|0||0
15|wechat_avatar|TEXT|0||0
16|created_at|TIMESTAMP|0||0
17|updated_at|TIMESTAMP|0||0
```

**æ­¥éª¤ 3ï¼šæ£€æŸ¥ user_profiles è¡¨**

```bash
sqlite3 lingzhi_ecosystem.db ".schema user_profiles"
```

**é¢„æœŸè¾“å‡ºï¼š**
```sql
CREATE TABLE user_profiles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER UNIQUE NOT NULL,
    real_name TEXT,
    phone TEXT UNIQUE,
    email TEXT UNIQUE,
    id_card TEXT,
    bank_account TEXT,
    bank_name TEXT,
    address TEXT,
    is_completed BOOLEAN DEFAULT 0,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### 6.3 æ‰‹åŠ¨æ·»åŠ å­—æ®µï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœæŸäº›å­—æ®µä¸å­˜åœ¨ï¼Œæ‰‹åŠ¨æ·»åŠ ï¼š

```bash
sqlite3 lingzhi_ecosystem.db << 'EOF'
ALTER TABLE users ADD COLUMN login_type TEXT DEFAULT 'phone';
ALTER TABLE users ADD COLUMN wechat_openid TEXT UNIQUE;
ALTER TABLE users ADD COLUMN wechat_unionid TEXT;
ALTER TABLE users ADD COLUMN wechat_nickname TEXT;
ALTER TABLE users ADD COLUMN wechat_avatar TEXT;
EOF
```

**æ­¥éª¤ 4ï¼šéªŒè¯å­—æ®µæ·»åŠ **

```bash
sqlite3 lingzhi_ecosystem.db "SELECT login_type, wechat_openid FROM users LIMIT 1;"
```

### 6.4 åˆ›å»º user_profiles è¡¨ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
sqlite3 lingzhi_ecosystem.db << 'EOF'
CREATE TABLE IF NOT EXISTS user_profiles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER UNIQUE NOT NULL,
    real_name TEXT,
    phone TEXT UNIQUE,
    email TEXT UNIQUE,
    id_card TEXT,
    bank_account TEXT,
    bank_name TEXT,
    address TEXT,
    is_completed BOOLEAN DEFAULT 0,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
EOF
```

**æ­¥éª¤ 5ï¼šéªŒè¯è¡¨åˆ›å»º**

```bash
sqlite3 lingzhi_ecosystem.db "SELECT name FROM sqlite_master WHERE type='table' AND name='user_profiles';"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
user_profiles
```

---

## ä¸ƒã€æœ¬åœ°æµ‹è¯•è¯¦ç»†æ­¥éª¤

### 7.1 å®‰è£…å†…ç½‘ç©¿é€å·¥å…·

**æ­¥éª¤ 1ï¼šä¸‹è½½ ngrok**

è®¿é—® https://ngrok.com/download ä¸‹è½½é€‚åˆä½ æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬ã€‚

**æ­¥éª¤ 2ï¼šè§£å‹å¹¶å®‰è£…**

```bash
# macOS/Linux
unzip ngrok-stable-darwin-amd64.zip
sudo mv ngrok /usr/local/bin/

# Windows
# è§£å‹åˆ° C:\ngrok
# æ·»åŠ åˆ°ç³»ç»Ÿ PATH
```

**æ­¥éª¤ 3ï¼šéªŒè¯å®‰è£…**

```bash
ngrok version
```

**é¢„æœŸè¾“å‡ºï¼š**
```
ngrok version 3.x.x
```

### 7.2 é…ç½®ä¸´æ—¶åŸŸå

**æ­¥éª¤ 1ï¼šå¯åŠ¨ ngrok**

```bash
ngrok http 5173
```

**é¢„æœŸè¾“å‡ºï¼š**
```
ngrok by @inconshreveable                                                                                                            

Session Status                online
Account                       your-account (Plan: Free)
Version                       3.x.x
Region                        Asia Pacific (ap)
Forwarding                    https://abc123.ngrok.io -> http://localhost:5173
Forwarding                    http://abc123.ngrok.io -> http://localhost:5173

Web Interface                 http://127.0.0.1:4040

Connections                   ttl     opn     rt1     rt5     p50     p90
                             0       0       0.00    0.00    0.00    0.00

Forwarding                    https://abc123.ngrok.io -> http://localhost:5173
```

**æ­¥éª¤ 2ï¼šå¤åˆ¶ä¸´æ—¶åŸŸå**

å¤åˆ¶ä¸´æ—¶åŸŸåï¼Œä¾‹å¦‚ï¼š`abc123.ngrok.io`

### 7.3 é…ç½®æµ‹è¯•ç¯å¢ƒ

**æ­¥éª¤ 1ï¼šæ›´æ–° .env é…ç½®**

ç¼–è¾‘ `admin-backend/.env` æ–‡ä»¶ï¼š

```bash
nano admin-backend/.env
```

ä¿®æ”¹å›è°ƒåœ°å€ï¼š

```env
WECHAT_REDIRECT_URI=https://abc123.ngrok.io/wechat/callback
```

**æ­¥éª¤ 2ï¼šæ›´æ–°å¾®ä¿¡å¼€æ”¾å¹³å°é…ç½®**

1. ç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°
2. è¿›å…¥åº”ç”¨è¯¦æƒ…é¡µ
3. æ‰¾åˆ°"æˆæƒå›è°ƒåŸŸ"
4. ç‚¹å‡»"ä¿®æ”¹"
5. è¾“å…¥ä¸´æ—¶åŸŸåï¼š`abc123.ngrok.io`
6. ç‚¹å‡»"ç¡®å®š"ä¿å­˜

### 7.4 å¯åŠ¨æµ‹è¯•æœåŠ¡

**æ­¥éª¤ 1ï¼šå¯åŠ¨åç«¯æœåŠ¡**

æ‰“å¼€ç¬¬ä¸€ä¸ªç»ˆç«¯çª—å£ï¼š

```bash
cd /workspace/projects/admin-backend
python3 app.py
```

**æ­¥éª¤ 2ï¼šå¯åŠ¨å‰ç«¯æœåŠ¡**

æ‰“å¼€ç¬¬äºŒä¸ªç»ˆç«¯çª—å£ï¼š

```bash
cd /workspace/projects/web-app
npm run dev
```

**é¢„æœŸè¾“å‡ºï¼š**
```
VITE v5.4.21  ready in 234 ms

âœ  Local:   http://localhost:5173/
âœ  Network: use --host to expose
```

**æ­¥éª¤ 3ï¼šå¯åŠ¨ ngrok**

æ‰“å¼€ç¬¬ä¸‰ä¸ªç»ˆç«¯çª—å£ï¼š

```bash
ngrok http 5173
```

### 7.5 æµ‹è¯•å¾®ä¿¡ç™»å½•æµç¨‹

**æ­¥éª¤ 1ï¼šè®¿é—®æµ‹è¯•ç½‘ç«™**

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttps://abc123.ngrok.io

**æ­¥éª¤ 2ï¼šè¿›å…¥ç™»å½•é¡µé¢**

1. ç‚¹å‡»å³ä¸Šè§’çš„"ç™»å½•"æŒ‰é’®
2. è¿›å…¥ç™»å½•é¡µé¢

**æ­¥éª¤ 3ï¼šæŸ¥çœ‹å¾®ä¿¡ç™»å½•æŒ‰é’®**

æ£€æŸ¥æ˜¯å¦æœ‰"å¾®ä¿¡ç™»å½•"æŒ‰é’®ï¼ŒæŒ‰é’®åº”è¯¥ï¼š
- æ˜¾ç¤ºå¾®ä¿¡å›¾æ ‡
- ç»¿è‰²èƒŒæ™¯
- æ–‡å­—æ˜¾ç¤º"å¾®ä¿¡ç™»å½•"

**æ­¥éª¤ 4ï¼šç‚¹å‡»å¾®ä¿¡ç™»å½•**

ç‚¹å‡»"å¾®ä¿¡ç™»å½•"æŒ‰é’®ã€‚

**é¢„æœŸè¡Œä¸ºï¼š**
- é¡µé¢è·³è½¬åˆ°å¾®ä¿¡æˆæƒé¡µé¢
- URL æ ¼å¼ï¼š`https://open.weixin.qq.com/connect/qrconnect?appid=...`

**æ­¥éª¤ 5ï¼šæ‰«ç æˆæƒ**

1. ä½¿ç”¨æ‰‹æœºå¾®ä¿¡æ‰«æäºŒç»´ç 
2. æŸ¥çœ‹æˆæƒé¡µé¢æ˜¾ç¤ºçš„ä¿¡æ¯ï¼š
   - åº”ç”¨åç§°ï¼šçµå€¼ç”Ÿæ€å›­
   - æˆæƒèŒƒå›´ï¼šè·å¾—ä½ çš„å…¬å¼€ä¿¡æ¯ï¼ˆæ˜µç§°ã€å¤´åƒç­‰ï¼‰
3. ç‚¹å‡»"ç¡®è®¤æˆæƒ"

**æ­¥éª¤ 6ï¼šè§‚å¯Ÿå›è°ƒè¿‡ç¨‹**

æˆæƒæˆåŠŸåï¼Œæµè§ˆå™¨ä¼šè·³è½¬åˆ°å›è°ƒåœ°å€ã€‚

**é¢„æœŸè¡Œä¸ºï¼š**
- è·³è½¬åˆ°ï¼šhttps://abc123.ngrok.io/wechat/callback?code=xxx&state=xxx
- æ˜¾ç¤º"å¤„ç†ä¸­..."åŠ è½½åŠ¨ç”»
- 1-2ç§’åè·³è½¬åˆ°é¦–é¡µæˆ–ä¿¡æ¯å®Œå–„é¡µé¢

**æ­¥éª¤ 7ï¼šéªŒè¯ç”¨æˆ·åˆ›å»º**

åœ¨ç»ˆç«¯çª—å£ä¸­æŸ¥çœ‹æ—¥å¿—ï¼š

```bash
# åœ¨åç«¯æœåŠ¡ç»ˆç«¯çª—å£æŸ¥çœ‹
```

**é¢„æœŸæ—¥å¿—ï¼š**
```
[INFO] å¾®ä¿¡æˆæƒæˆåŠŸï¼Œè·å–ç”¨æˆ·ä¿¡æ¯
[INFO] åˆ›å»ºæ–°ç”¨æˆ·: wx_openid_123456
[INFO] ç”¨æˆ·åˆ›å»ºæˆåŠŸï¼ŒID: 123
```

**æ­¥éª¤ 8ï¼šæµ‹è¯•ä¿¡æ¯å®Œå–„æµç¨‹**

å¦‚æœé¦–æ¬¡å¾®ä¿¡ç™»å½•ï¼Œåº”è¯¥è‡ªåŠ¨è·³è½¬åˆ° `/complete-profile` é¡µé¢ã€‚

**é¢„æœŸè¡Œä¸ºï¼š**
- æ˜¾ç¤ºä¿¡æ¯å®Œå–„è¡¨å•
- è¡¨å•åŒ…å«ï¼šçœŸå®å§“åã€æ‰‹æœºå·ã€é‚®ç®±ç­‰å­—æ®µ
- çœŸå®å§“åå’Œæ‰‹æœºå·ä¸ºå¿…å¡«é¡¹

**æ­¥éª¤ 9ï¼šå¡«å†™å¹¶æäº¤ä¿¡æ¯**

1. å¡«å†™çœŸå®å§“åï¼š`æµ‹è¯•ç”¨æˆ·`
2. å¡«å†™æ‰‹æœºå·ï¼š`13800138000`
3. ç‚¹å‡»"æäº¤ä¿¡æ¯"æŒ‰é’®

**é¢„æœŸè¡Œä¸ºï¼š**
- æ˜¾ç¤º"æäº¤ä¸­..."åŠ è½½çŠ¶æ€
- 1-2ç§’åæ˜¾ç¤º"ä¿¡æ¯å®Œå–„æˆåŠŸï¼"
- è‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ

### 7.6 éªŒè¯æµ‹è¯•ç»“æœ

**æ­¥éª¤ 1ï¼šæ£€æŸ¥æ•°æ®åº“**

```bash
sqlite3 admin-backend/lingzhi_ecosystem.db "SELECT id, username, login_type, wechat_nickname FROM users WHERE login_type='wechat';"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
123|wx_openid_123456|wechat|æµ‹è¯•ç”¨æˆ·
```

**æ­¥éª¤ 2ï¼šæ£€æŸ¥ user_profiles è¡¨**

```bash
sqlite3 admin-backend/lingzhi_ecosystem.db "SELECT * FROM user_profiles WHERE user_id=123;"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
1|123|æµ‹è¯•ç”¨æˆ·|13800138000|@||| ||||1|2026-02-01 16:00:00|2026-02-01 16:00:00|2026-02-01 16:00:00
```

**æ­¥éª¤ 3ï¼šæµ‹è¯•å†æ¬¡ç™»å½•**

1. é€€å‡ºç™»å½•
2. å†æ¬¡ç‚¹å‡»"å¾®ä¿¡ç™»å½•"
3. æ‰«ç æˆæƒ

**é¢„æœŸè¡Œä¸ºï¼š**
- ä¸è·³è½¬åˆ°ä¿¡æ¯å®Œå–„é¡µé¢
- ç›´æ¥è¿›å…¥é¦–é¡µ
- ç”¨æˆ·ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º

---

## å…«ã€éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒè¯¦ç»†æ­¥éª¤

### 8.1 å‡†å¤‡ç”Ÿäº§æœåŠ¡å™¨

**æ­¥éª¤ 1ï¼šç™»å½•ç”Ÿäº§æœåŠ¡å™¨**

```bash
ssh root@123.56.142.143
```

è¾“å…¥å¯†ç ï¼š`Meiyue@root123`

**æ­¥éª¤ 2ï¼šæ›´æ–°ç³»ç»Ÿ**

```bash
apt-get update && apt-get upgrade -y
```

**æ­¥éª¤ 3ï¼šæ£€æŸ¥ç£ç›˜ç©ºé—´**

```bash
df -h
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Filesystem      Size  Used Avail Use% Mounted on
/dev/vda3        40G  4.1G   34G  11% /
```

**æ­¥éª¤ 4ï¼šæ£€æŸ¥å†…å­˜**

```bash
free -h
```

**é¢„æœŸè¾“å‡ºï¼š**
```
              total        used        free      shared  buff/cache   available
Mem:           7.7G        1.2G        5.2G        0.0G        1.3G        6.1G
Swap:            0B          0B          0B
```

### 8.2 éƒ¨ç½²åç«¯ä»£ç 

**æ­¥éª¤ 1ï¼šåœ¨æœ¬åœ°æ‰“åŒ…ä»£ç **

åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /workspace/projects
tar -czf lingzhi-backend-$(date +%Y%m%d).tar.gz admin-backend/
```

**æ­¥éª¤ 2ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨**

```bash
scp lingzhi-backend-$(date +%Y%m%d).tar.gz root@123.56.142.143:/tmp/
```

**æ­¥éª¤ 3ï¼šåœ¨æœåŠ¡å™¨ä¸Šè§£å‹**

```bash
ssh root@123.56.142.143
cd /tmp
tar -xzf lingzhi-backend-*.tar.gz
```

**æ­¥éª¤ 4ï¼šå¤‡ä»½æ—§ä»£ç **

```bash
cd /var/www
cp -r backend backend.backup.$(date +%Y%m%d)
```

**æ­¥éª¤ 5ï¼šå¤åˆ¶æ–°ä»£ç **

```bash
cp -r /tmp/admin-backend/* /var/www/backend/
```

**æ­¥éª¤ 6ï¼šé…ç½® .env æ–‡ä»¶**

```bash
cd /var/www/backend
nano .env
```

æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```env
# ====================================
# å¾®ä¿¡å¼€æ”¾å¹³å°é…ç½®
# ====================================
WECHAT_APP_ID=wx1234567890abcdef
WECHAT_APP_SECRET=1234567890abcdef1234567890abcdef
WECHAT_REDIRECT_URI=https://meiyueart.com/wechat/callback
```

**æ­¥éª¤ 7ï¼šè®¾ç½®æ–‡ä»¶æƒé™**

```bash
chmod 600 .env
```

**æ­¥éª¤ 8ï¼šå®‰è£…ä¾èµ–**

```bash
cd /var/www/backend
pip3 install -r requirements.txt
```

**æ­¥éª¤ 9ï¼šéªŒè¯é…ç½®**

```bash
python3 -c "import os; from dotenv import load_dotenv; load_dotenv(); print('AppID:', os.getenv('WECHAT_APP_ID')); print('å›è°ƒåœ°å€:', os.getenv('WECHAT_REDIRECT_URI'))"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
AppID: wx1234567890abcdef
å›è°ƒåœ°å€: https://meiyueart.com/wechat/callback
```

**æ­¥éª¤ 10ï¼šé‡å¯åç«¯æœåŠ¡**

```bash
systemctl restart lingzhi-api
```

**æ­¥éª¤ 11ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€**

```bash
systemctl status lingzhi-api
```

**é¢„æœŸè¾“å‡ºï¼š**
```
â— lingzhi-api.service - Lingzhi Ecosystem API Service
   Loaded: loaded (/etc/systemd/system/lingzhi-api.service; enabled; preset: enabled)
   Active: active (running) since Sun 2026-02-01 16:00:00 CST; 10s ago
   Main PID: 12345 (python3.13)
      Tasks: 1 (limit: 4124)
   Memory: 2.1M (peak: 2.1M)
        CPU: 6ms
   CGroup: /system.slice/lingzhi-api.service
         â””â”€12345 /usr/local/python3.13/bin/python3.13 /var/www/backend/app.py

Feb 01 16:00:00 iZ2ze3zr62zvydo1d3k8b9Z systemd[1]: Started lingzhi-api.service.
```

**æ­¥éª¤ 12ï¼šæŸ¥çœ‹æ—¥å¿—**

```bash
journalctl -u lingzhi-api -n 50
```

ç¡®ä¿æ²¡æœ‰é”™è¯¯ä¿¡æ¯ã€‚

### 8.3 éƒ¨ç½²å‰ç«¯ä»£ç 

**æ­¥éª¤ 1ï¼šåœ¨æœ¬åœ°æ„å»ºå‰ç«¯**

åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /workspace/projects/web-app
npm run build
```

**æ­¥éª¤ 2ï¼šæ‰“åŒ…æ„å»ºäº§ç‰©**

```bash
cd /workspace/projects
tar -czf lingzhi-frontend-$(date +%Y%m%d).tar.gz web-app/dist/
```

**æ­¥éª¤ 3ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨**

```bash
scp lingzhi-frontend-$(date +%Y%m%d).tar.gz root@123.56.142.143:/tmp/
```

**æ­¥éª¤ 4ï¼šåœ¨æœåŠ¡å™¨ä¸Šè§£å‹**

```bash
ssh root@123.56.142.143
cd /tmp
tar -xzf lingzhi-frontend-*.tar.gz
```

**æ­¥éª¤ 5ï¼šå¤‡ä»½æ—§ä»£ç **

```bash
cd /var/www
cp -r html html.backup.$(date +%Y%m%d)
```

**æ­¥éª¤ 6ï¼šå¤åˆ¶æ–°ä»£ç **

```bash
rm -rf /var/www/html/*
cp -r /tmp/web-app/dist/* /var/www/html/
```

**æ­¥éª¤ 7ï¼šè®¾ç½®æ–‡ä»¶æƒé™**

```bash
chown -R www-data:www-data /var/www/html
chmod -R 755 /var/www/html
```

### 8.4 é…ç½® Nginx

**æ­¥éª¤ 1ï¼šç¼–è¾‘ Nginx é…ç½®**

```bash
nano /etc/nginx/sites-available/meiyueart.com
```

åˆ›å»ºä»¥ä¸‹é…ç½®ï¼š

```nginx
server {
    listen 80;
    server_name meiyueart.com www.meiyueart.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/html;
        try_files $uri $uri/ /index.html;
        index index.html;
        
        # ç¼“å­˜é…ç½®
        add_header Cache-Control "public, max-age=3600";
    }

    # åç«¯ API ä»£ç†
    location /api/ {
        proxy_pass http://localhost:8001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶é…ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        deny all;
    }
}
```

**æ­¥éª¤ 2ï¼šæµ‹è¯•é…ç½®**

```bash
nginx -t
```

**é¢„æœŸè¾“å‡ºï¼š**
```
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

**æ­¥éª¤ 3ï¼šé‡å¯ Nginx**

```bash
systemctl reload nginx
```

**æ­¥éª¤ 4ï¼šæ£€æŸ¥ Nginx çŠ¶æ€**

```bash
systemctl status nginx
```

### 8.5 é…ç½® SSL è¯ä¹¦ï¼ˆæ¨èï¼‰

**æ­¥éª¤ 1ï¼šå®‰è£… Certbot**

```bash
apt-get install certbot python3-certbot-nginx -y
```

**æ­¥éª¤ 2ï¼šç”³è¯·è¯ä¹¦**

```bash
certbot --nginx -d meiyueart.com -d www.meiyueart.com
```

**æ­¥éª¤ 3ï¼šå¡«å†™é‚®ç®±**

```
Enter email address (used for urgent renewal and security notices)
 (Enter 'c' to cancel): your-email@example.com
```

**æ­¥éª¤ 4ï¼šåŒæ„æ¡æ¬¾**

```
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Please read the Terms of Service at
https://letsencrypt.org/documents/LE-SA-v1.4-April-3-2024.pdf.
You must agree in order to register with the ACME server.
Do you agree? - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(Y)es/(N)o: Y
```

**æ­¥éª¤ 5ï¼šé€‰æ‹©æ˜¯å¦å…±äº«é‚®ç®±**

```
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Would you be willing, once your first certificate is successfully received, to
share your email address with the Electronic Frontier Foundation, a founding
partner of the Let's Encrypt project and the non-profit organization that
develops Certbot? We'd like to send you email about our work encrypting the web,
EFF news, campaigns, and ways to support digital freedom.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
(Y)es/(N)o: N
```

**æ­¥éª¤ 6ï¼šé€‰æ‹©é‡å®šå‘æ–¹å¼**

```
Successfully received certificate.

Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: No redirect - Make no further changes to the webserver configuration.
2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for
new sites, or if you're confident your site works on HTTPS. You can undo this
change by editing your web server's configuration.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2
```

**æ­¥éª¤ 7ï¼šéªŒè¯è¯ä¹¦**

```bash
certbot certificates
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Certificate Name: meiyueart.com
  Domains: meiyueart.com www.meiyueart.com
  Expiry Date: 2026-05-01 16:00:00+00:00 (VALID: 89 days)
  Certificate Path: /etc/letsencrypt/live/meiyueart.com/fullchain.pem
  Private Key Path: /etc/letsencrypt/live/meiyueart.com/privkey.pem
```

**æ­¥éª¤ 8ï¼šæµ‹è¯•è‡ªåŠ¨ç»­æœŸ**

```bash
certbot renew --dry-run
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Saving debug log to /var/log/letsencrypt/letsencrypt.log

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Processing certificate for meiyueart.com
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Simulating renewal of an existing certificate for meiyueart.com
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Congratulations, all simulated renewals succeeded!
```

### 8.6 é…ç½®å¾®ä¿¡å¼€æ”¾å¹³å°ç”Ÿäº§å›è°ƒ

**æ­¥éª¤ 1ï¼šæ›´æ–°æˆæƒå›è°ƒåŸŸ**

1. ç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°ï¼šhttps://open.weixin.qq.com/
2. è¿›å…¥"ç®¡ç†ä¸­å¿ƒ" > "ç½‘ç«™åº”ç”¨" > "çµå€¼ç”Ÿæ€å›­"
3. ç‚¹å‡»"å¼€å‘ä¿¡æ¯"æ ‡ç­¾é¡µ
4. æ‰¾åˆ°"æˆæƒå›è°ƒåŸŸ"
5. ç‚¹å‡»"ä¿®æ”¹"
6. è¾“å…¥ç”Ÿäº§åŸŸåï¼š`meiyueart.com`
7. ç‚¹å‡»"ç¡®å®š"ä¿å­˜

**æ­¥éª¤ 2ï¼šæ›´æ–°ç¯å¢ƒå˜é‡**

```bash
nano /var/www/backend/.env
```

ç¡®ä¿é…ç½®å¦‚ä¸‹ï¼š

```env
WECHAT_REDIRECT_URI=https://meiyueart.com/wechat/callback
```

**æ­¥éª¤ 3ï¼šé‡å¯åç«¯æœåŠ¡**

```bash
systemctl restart lingzhi-api
```

---

## ä¹ã€æµ‹è¯•éªŒè¯è¯¦ç»†æ­¥éª¤

### 9.1 åŸºç¡€åŠŸèƒ½æµ‹è¯•

**æµ‹è¯• 1ï¼šè®¿é—®ç½‘ç«™**

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttps://meiyueart.com

**æ£€æŸ¥é¡¹ï¼š**
- [ ] é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] æ—  404 é”™è¯¯
- [ ] åŠ è½½é€Ÿåº¦ < 3 ç§’

**æµ‹è¯• 2ï¼šè®¿é—®ç™»å½•é¡µé¢**

ç‚¹å‡»"ç™»å½•"æŒ‰é’®ï¼Œè¿›å…¥ç™»å½•é¡µé¢ã€‚

**æ£€æŸ¥é¡¹ï¼š**
- [ ] é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] ç™»å½•è¡¨å•æ­£å¸¸
- [ ] "å¾®ä¿¡ç™»å½•"æŒ‰é’®æ˜¾ç¤ºæ­£å¸¸

**æµ‹è¯• 3ï¼šæŸ¥çœ‹å¾®ä¿¡ç™»å½•æŒ‰é’®**

æ£€æŸ¥"å¾®ä¿¡ç™»å½•"æŒ‰é’®ï¼š

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æŒ‰é’®æ˜¾ç¤ºå¾®ä¿¡å›¾æ ‡
- [ ] æŒ‰é’®ä¸ºç»¿è‰²
- [ ] æŒ‰é’®æ–‡å­—ä¸º"å¾®ä¿¡ç™»å½•"
- [ ] æŒ‰é’®å¯ç‚¹å‡»

### 9.2 å¾®ä¿¡ç™»å½•æµç¨‹æµ‹è¯•

**æµ‹è¯• 4ï¼šç‚¹å‡»å¾®ä¿¡ç™»å½•**

ç‚¹å‡»"å¾®ä¿¡ç™»å½•"æŒ‰é’®ã€‚

**æ£€æŸ¥é¡¹ï¼š**
- [ ] è·³è½¬åˆ°å¾®ä¿¡æˆæƒé¡µé¢
- [ ] æˆæƒé¡µé¢ URL æ ¼å¼æ­£ç¡®
- [ ] æˆæƒé¡µé¢æ˜¾ç¤ºåº”ç”¨ä¿¡æ¯

**æµ‹è¯• 5ï¼šæ‰«ç æˆæƒ**

ä½¿ç”¨å¾®ä¿¡æ‰«ç æˆæƒã€‚

**æ£€æŸ¥é¡¹ï¼š**
- [ ] äºŒç»´ç å¯æ‰«æ
- [ ] æˆæƒä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
- [ ] å¯ç‚¹å‡»"ç¡®è®¤æˆæƒ"

**æµ‹è¯• 6ï¼šæˆæƒæˆåŠŸåå›è°ƒ**

æˆæƒæˆåŠŸåï¼Œè§‚å¯Ÿå›è°ƒè¿‡ç¨‹ã€‚

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ­£ç¡®è·³è½¬åˆ°å›è°ƒé¡µé¢
- [ ] å›è°ƒé¡µé¢æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- [ ] 1-2ç§’åè‡ªåŠ¨è·³è½¬

**æµ‹è¯• 7ï¼šéªŒè¯ç™»å½•çŠ¶æ€**

æ£€æŸ¥æ˜¯å¦æˆåŠŸç™»å½•ã€‚

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æˆåŠŸè·³è½¬åˆ°é¦–é¡µæˆ–ä¿¡æ¯å®Œå–„é¡µé¢
- [ ] ç”¨æˆ·ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
- [ ] å¯è®¿é—®éœ€è¦ç™»å½•çš„é¡µé¢

### 9.3 ä¿¡æ¯å®Œå–„æµç¨‹æµ‹è¯•

**æµ‹è¯• 8ï¼šé¦–æ¬¡ç™»å½•ä¿¡æ¯å®Œå–„**

é¦–æ¬¡å¾®ä¿¡ç™»å½•åï¼Œåº”è¯¥è·³è½¬åˆ°ä¿¡æ¯å®Œå–„é¡µé¢ã€‚

**æ£€æŸ¥é¡¹ï¼š**
- [ ] è‡ªåŠ¨è·³è½¬åˆ° `/complete-profile` é¡µé¢
- [ ] é¡µé¢æ ‡é¢˜æ­£ç¡®æ˜¾ç¤º
- [ ] è¡¨å•æ­£å¸¸æ˜¾ç¤º

**æµ‹è¯• 9ï¼šå¡«å†™ä¿¡æ¯**

å¡«å†™è¡¨å•ä¿¡æ¯ï¼š

```
çœŸå®å§“åï¼šå¼ ä¸‰
æ‰‹æœºå·ï¼š13800138000
é‚®ç®±ï¼šzhangsan@example.com
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] è¡¨å•éªŒè¯æ­£å¸¸
- [ ] å¿…å¡«é¡¹æç¤ºæ­£ç¡®
- [ ] æ‰‹æœºå·æ ¼å¼éªŒè¯

**æµ‹è¯• 10ï¼šæäº¤ä¿¡æ¯**

ç‚¹å‡»"æäº¤ä¿¡æ¯"æŒ‰é’®ã€‚

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ˜¾ç¤ºæäº¤ä¸­çŠ¶æ€
- [ ] 1-2ç§’åæ˜¾ç¤ºæˆåŠŸæç¤º
- [ ] è‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ

**æµ‹è¯• 11ï¼šå†æ¬¡ç™»å½•ä¸è·³è½¬å®Œå–„é¡µé¢**

é€€å‡ºç™»å½•ï¼Œå†æ¬¡å¾®ä¿¡ç™»å½•ã€‚

**æ£€æŸ¥é¡¹ï¼š**
- [ ] ä¸å†è·³è½¬åˆ°ä¿¡æ¯å®Œå–„é¡µé¢
- [ ] ç›´æ¥è¿›å…¥é¦–é¡µ
- [ ] ç”¨æˆ·ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º

### 9.4 API æ¥å£æµ‹è¯•

**æµ‹è¯• 12ï¼šæµ‹è¯•è·å–å¾®ä¿¡ç™»å½• URL**

```bash
curl -s https://meiyueart.com/api/wechat/login | python3 -m json.tool
```

**é¢„æœŸè¾“å‡ºï¼š**
```json
{
    "success": true,
    "data": {
        "auth_url": "https://open.weixin.qq.com/connect/qrconnect?...",
        "state": "abc123"
    }
}
```

**æµ‹è¯• 13ï¼šæµ‹è¯•å‰å°ç”¨æˆ·åŠ¨æ€æ¥å£**

```bash
curl -s https://meiyueart.com/api/public/users/recent?limit=5 | python3 -m json.tool
```

**é¢„æœŸè¾“å‡ºï¼š**
```json
{
    "success": true,
    "data": []
}
```

### 9.5 æ—¥å¿—æ£€æŸ¥

**æµ‹è¯• 14ï¼šæ£€æŸ¥åç«¯æ—¥å¿—**

```bash
journalctl -u lingzhi-api -n 50
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æœåŠ¡å¯åŠ¨æ— é”™è¯¯
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] æ— å¼‚å¸¸é”™è¯¯ä¿¡æ¯

**æµ‹è¯• 15ï¼šæ£€æŸ¥ Nginx æ—¥å¿—**

```bash
tail -n 50 /var/log/nginx/access.log
tail -n 50 /var/log/nginx/error.log
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ—  404 é”™è¯¯
- [ ] æ—  500 é”™è¯¯
- [ ] è¯·æ±‚æ­£å¸¸å¤„ç†

---

## åã€é—®é¢˜æ’æŸ¥è¯¦ç»†æ­¥éª¤

### 10.1 é—®é¢˜ï¼šæˆæƒå¤±è´¥ - redirect_uri å‚æ•°é”™è¯¯

**ç°è±¡ï¼š**
å¾®ä¿¡æˆæƒé¡µé¢æ˜¾ç¤º "redirect_uri å‚æ•°é”™è¯¯"

**æ’æŸ¥æ­¥éª¤ï¼š**

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ .env é…ç½®**

```bash
cat /var/www/backend/.env | grep WECHAT_REDIRECT_URI
```

**é¢„æœŸè¾“å‡ºï¼š**
```
WECHAT_REDIRECT_URI=https://meiyueart.com/wechat/callback
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] åè®®ä¸º https
- [ ] åŸŸåæ­£ç¡®
- [ ] è·¯å¾„ä¸º `/wechat/callback`

**æ­¥éª¤ 2ï¼šæ£€æŸ¥å¾®ä¿¡å¼€æ”¾å¹³å°é…ç½®**

ç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°ï¼ŒæŸ¥çœ‹"æˆæƒå›è°ƒåŸŸ"ã€‚

**æ£€æŸ¥é¡¹ï¼š**
- [ ] åªåŒ…å«åŸŸåï¼ˆä¸å«åè®®å’Œè·¯å¾„ï¼‰
- [ ] åŸŸåä¸º `meiyueart.com`
- [ ] ä¸ .env ä¸­çš„åŸŸåä¸€è‡´

**æ­¥éª¤ 3ï¼šæ¯”è¾ƒé…ç½®**

```bash
# æå–åŸŸå
echo "https://meiyueart.com/wechat/callback" | sed 's|https://||' | sed 's|/wechat/callback||'
```

**é¢„æœŸè¾“å‡ºï¼š**
```
meiyueart.com
```

**è§£å†³æ–¹æ¡ˆï¼š**

ç¡®ä¿ä»¥ä¸‹é…ç½®ä¸€è‡´ï¼š

```env
# .env æ–‡ä»¶
WECHAT_REDIRECT_URI=https://meiyueart.com/wechat/callback
```

```
# å¾®ä¿¡å¼€æ”¾å¹³å°
æˆæƒå›è°ƒåŸŸ: meiyueart.com
```

**æ­¥éª¤ 4ï¼šé‡å¯æœåŠ¡**

```bash
systemctl restart lingzhi-api
```

### 10.2 é—®é¢˜ï¼šæˆæƒå¤±è´¥ - AppID æˆ– AppSecret é”™è¯¯

**ç°è±¡ï¼š**
å¾®ä¿¡æˆæƒé¡µé¢æ˜¾ç¤º "AppID æˆ– AppSecret é”™è¯¯"

**æ’æŸ¥æ­¥éª¤ï¼š**

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ AppID**

```bash
cat /var/www/backend/.env | grep WECHAT_APP_ID
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] ä»¥ `wx` å¼€å¤´
- [ ] æ€»å…± 18 ä½
- [ ] æ ¼å¼æ­£ç¡®

**æ­¥éª¤ 2ï¼šæ£€æŸ¥ AppSecret**

```bash
cat /var/www/backend/.env | grep WECHAT_APP_SECRET
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] 32 ä½å­—ç¬¦
- [ ] åªåŒ…å«å­—æ¯å’Œæ•°å­—
- [ ] æ— ç‰¹æ®Šå­—ç¬¦

**æ­¥éª¤ 3ï¼šéªŒè¯é…ç½®**

```bash
python3 -c "
import os
from dotenv import load_dotenv
load_dotenv()
appid = os.getenv('WECHAT_APP_ID')
secret = os.getenv('WECHAT_APP_SECRET')
print(f'AppID: {appid}')
print(f'AppID é•¿åº¦: {len(appid) if appid else 0}')
print(f'AppSecret: {secret[:4]}...{secret[-4:] if secret else \"\"}')
print(f'AppSecret é•¿åº¦: {len(secret) if secret else 0}')
"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
AppID: wx1234567890abcdef
AppID é•¿åº¦: 18
AppSecret: 1234...bcde
AppSecret é•¿åº¦: 32
```

**è§£å†³æ–¹æ¡ˆï¼š**

å¦‚æœé…ç½®é”™è¯¯ï¼Œé‡æ–°é…ç½®ï¼š

```bash
nano /var/www/backend/.env
```

æ›´æ–°ä¸ºæ­£ç¡®çš„å€¼ï¼š

```env
WECHAT_APP_ID=wx1234567890abcdef
WECHAT_APP_SECRET=1234567890abcdef1234567890abcdef
```

**æ­¥éª¤ 4ï¼šé‡å¯æœåŠ¡**

```bash
systemctl restart lingzhi-api
```

### 10.3 é—®é¢˜ï¼šæˆæƒæˆåŠŸä½†å›è°ƒå¤±è´¥

**ç°è±¡ï¼š**
å¾®ä¿¡æˆæƒæˆåŠŸï¼Œä½†å›è°ƒåˆ°æœåŠ¡å™¨æ—¶å¤±è´¥

**æ’æŸ¥æ­¥éª¤ï¼š**

**æ­¥éª¤ 1ï¼šæ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€**

```bash
systemctl status lingzhi-api
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æœåŠ¡çŠ¶æ€ä¸º `active (running)`
- [ ] æ— é”™è¯¯ä¿¡æ¯

**æ­¥éª¤ 2ï¼šæ£€æŸ¥ç«¯å£ç›‘å¬**

```bash
netstat -tlnp | grep 8001
```

**é¢„æœŸè¾“å‡ºï¼š**
```
tcp        0      0 0.0.0.0:8001            0.0.0.0:*               LISTEN      12345/python3.13
```

**æ­¥éª¤ 3ï¼šæµ‹è¯•å›è°ƒåœ°å€å¯è®¿é—®æ€§**

```bash
curl -I https://meiyueart.com/api/wechat/callback
```

**é¢„æœŸè¾“å‡ºï¼š**
```
HTTP/1.1 200 OK
Server: nginx
...
```

**æ­¥éª¤ 4ï¼šæ£€æŸ¥é˜²ç«å¢™**

```bash
ufw status
```

ç¡®ä¿ç«¯å£ 8001 å·²å¼€æ”¾ï¼š

```bash
ufw allow 8001/tcp
```

**æ­¥éª¤ 5ï¼šæ£€æŸ¥ Nginx é…ç½®**

```bash
cat /etc/nginx/sites-available/meiyueart.com | grep location
```

ç¡®ä¿åŒ…å«ä»¥ä¸‹é…ç½®ï¼š

```nginx
location /api/ {
    proxy_pass http://localhost:8001/api/;
    ...
}
```

**æ­¥éª¤ 6ï¼šé‡å¯æœåŠ¡**

```bash
systemctl restart nginx
systemctl restart lingzhi-api
```

### 10.4 é—®é¢˜ï¼šæ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯

**ç°è±¡ï¼š**
æˆæƒæˆåŠŸï¼Œä½†æ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯

**æ’æŸ¥æ­¥éª¤ï¼š**

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ scope é…ç½®**

```bash
grep -n "scope=" admin-backend/app.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
scope=snsapi_userinfo
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] scope åŒ…å« `snsapi_userinfo`
- [ ] ä¸æ˜¯ `snsapi_base`

**æ­¥éª¤ 2ï¼šæŸ¥çœ‹åç«¯æ—¥å¿—**

```bash
journalctl -u lingzhi-api -f
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æŸ¥çœ‹è·å–ç”¨æˆ·ä¿¡æ¯çš„é”™è¯¯
- [ ] æ£€æŸ¥ access_token æ˜¯å¦æœ‰æ•ˆ

**æ­¥éª¤ 3ï¼šæ‰‹åŠ¨æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯**

```bash
# æ›¿æ¢ ACCESS_TOKEN å’Œ OPENID
curl -s "https://api.weixin.qq.com/sns/userinfo?access_token=ACCESS_TOKEN&openid=OPENID" | python3 -m json.tool
```

**é¢„æœŸè¾“å‡ºï¼š**
```json
{
    "openid": "OPENID",
    "nickname": "ç”¨æˆ·æ˜µç§°",
    "sex": 1,
    "province": "å¹¿ä¸œ",
    "city": "æ·±åœ³",
    "country": "ä¸­å›½",
    "headimgurl": "https://thirdwx.qlogo.cn/..."
}
```

**é”™è¯¯æƒ…å†µï¼š**
```json
{
    "errcode": 40001,
    "errmsg": "invalid credential, access_token is invalid or not latest"
}
```

**è§£å†³æ–¹æ¡ˆï¼š**

å¦‚æœ access_token æ— æ•ˆï¼Œæ£€æŸ¥åç«¯ä»£ç ä¸­çš„ access_token è·å–é€»è¾‘ã€‚

### 10.5 é—®é¢˜ï¼šæ•°æ®åº“å­—æ®µä¸å­˜åœ¨

**ç°è±¡ï¼š**
è¿è¡Œæ—¶æç¤ºæ•°æ®åº“å­—æ®µä¸å­˜åœ¨

**æ’æŸ¥æ­¥éª¤ï¼š**

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ users è¡¨ç»“æ„**

```bash
sqlite3 /var/www/backend/lingzhi_ecosystem.db "PRAGMA table_info(users);"
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ˜¯å¦åŒ…å« `login_type` å­—æ®µ
- [ ] æ˜¯å¦åŒ…å« `wechat_openid` å­—æ®µ
- [ ] æ˜¯å¦åŒ…å« `wechat_unionid` å­—æ®µ
- [ ] æ˜¯å¦åŒ…å« `wechat_nickname` å­—æ®µ
- [ ] æ˜¯å¦åŒ…å« `wechat_avatar` å­—æ®µ

**æ­¥éª¤ 2ï¼šæ£€æŸ¥ user_profiles è¡¨æ˜¯å¦å­˜åœ¨**

```bash
sqlite3 /var/www/backend/lingzhi_ecosystem.db "SELECT name FROM sqlite_master WHERE type='table' AND name='user_profiles';"
```

**é¢„æœŸè¾“å‡ºï¼š**
```
user_profiles
```

**æ­¥éª¤ 3ï¼šæ‰‹åŠ¨æ·»åŠ ç¼ºå¤±å­—æ®µ**

å¦‚æœå­—æ®µç¼ºå¤±ï¼Œæ‰‹åŠ¨æ·»åŠ ï¼š

```bash
sqlite3 /var/www/backend/lingzhi_ecosystem.db << 'EOF'
ALTER TABLE users ADD COLUMN login_type TEXT DEFAULT 'phone';
ALTER TABLE users ADD COLUMN wechat_openid TEXT UNIQUE;
ALTER TABLE users ADD COLUMN wechat_unionid TEXT;
ALTER TABLE users ADD COLUMN wechat_nickname TEXT;
ALTER TABLE users ADD COLUMN wechat_avatar TEXT;
EOF
```

**æ­¥éª¤ 4ï¼šåˆ›å»º user_profiles è¡¨**

å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œåˆ›å»ºï¼š

```bash
sqlite3 /var/www/backend/lingzhi_ecosystem.db << 'EOF'
CREATE TABLE user_profiles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER UNIQUE NOT NULL,
    real_name TEXT,
    phone TEXT UNIQUE,
    email TEXT UNIQUE,
    id_card TEXT,
    bank_account TEXT,
    bank_name TEXT,
    address TEXT,
    is_completed BOOLEAN DEFAULT 0,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
EOF
```

**æ­¥éª¤ 5ï¼šé‡å¯æœåŠ¡**

```bash
systemctl restart lingzhi-api
```

---

## é™„å½•

### A. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# åç«¯æœåŠ¡ç®¡ç†
systemctl start lingzhi-api          # å¯åŠ¨æœåŠ¡
systemctl stop lingzhi-api           # åœæ­¢æœåŠ¡
systemctl restart lingzhi-api        # é‡å¯æœåŠ¡
systemctl status lingzhi-api         # æŸ¥çœ‹çŠ¶æ€

# æŸ¥çœ‹æ—¥å¿—
journalctl -u lingzhi-api -f         # å®æ—¶æ—¥å¿—
journalctl -u lingzhi-api -n 50      # æœ€è¿‘50æ¡
journalctl -u lingzhi-api -p err     # åªçœ‹é”™è¯¯

# Nginx ç®¡ç†
systemctl start nginx                # å¯åŠ¨ Nginx
systemctl stop nginx                 # åœæ­¢ Nginx
systemctl restart nginx              # é‡å¯ Nginx
nginx -t                             # æµ‹è¯•é…ç½®

# æ•°æ®åº“æ“ä½œ
sqlite3 lingzhi_ecosystem.db ".schema users"  # æŸ¥çœ‹è¡¨ç»“æ„
sqlite3 lingzhi_ecosystem.db "SELECT * FROM users LIMIT 10"  # æŸ¥è¯¢æ•°æ®

# SSL è¯ä¹¦
certbot certificates                 # æŸ¥çœ‹è¯ä¹¦
certbot renew --dry-run              # æµ‹è¯•ç»­æœŸ
```

### B. é…ç½®æ–‡ä»¶æ¨¡æ¿

**admin-backend/.env**

```env
# JWT é…ç½®
JWT_SECRET=lingzhi-jwt-secret-key-2026

# å¾®ä¿¡å¼€æ”¾å¹³å°é…ç½®
WECHAT_APP_ID=wx1234567890abcdef
WECHAT_APP_SECRET=1234567890abcdef1234567890abcdef
WECHAT_REDIRECT_URI=https://meiyueart.com/wechat/callback

# æœåŠ¡å™¨é…ç½®
SERVER_USER=root
SERVER_HOST=123.56.142.143
SERVER_PASSWORD=Meiyue@root123
SERVER_PATH=/var/www/html

# éƒ¨ç½²é…ç½®
MONITOR_INTERVAL=30
BACKUP_RETENTION_DAYS=7
```

### C. æµ‹è¯•ç”¨ä¾‹æ¸…å•

| æµ‹è¯•é¡¹ | æµ‹è¯•æ­¥éª¤ | é¢„æœŸç»“æœ | å®é™…ç»“æœ | çŠ¶æ€ |
|--------|---------|---------|---------|------|
| è®¿é—®ç½‘ç«™ | æ‰“å¼€ https://meiyueart.com | é¡µé¢æ­£å¸¸æ˜¾ç¤º | | â˜ |
| ç™»å½•é¡µé¢ | ç‚¹å‡»"ç™»å½•"æŒ‰é’® | è¿›å…¥ç™»å½•é¡µé¢ | | â˜ |
| å¾®ä¿¡ç™»å½•æŒ‰é’® | æŸ¥çœ‹ç™»å½•é¡µé¢ | æ˜¾ç¤º"å¾®ä¿¡ç™»å½•"æŒ‰é’® | | â˜ |
| ç‚¹å‡»å¾®ä¿¡ç™»å½• | ç‚¹å‡»"å¾®ä¿¡ç™»å½•"æŒ‰é’® | è·³è½¬åˆ°å¾®ä¿¡æˆæƒé¡µé¢ | | â˜ |
| æ‰«ç æˆæƒ | æ‰«ç å¹¶ç¡®è®¤æˆæƒ | æˆæƒæˆåŠŸ | | â˜ |
| å›è°ƒå¤„ç† | æˆæƒæˆåŠŸå | è‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µæˆ–ä¿¡æ¯å®Œå–„é¡µé¢ | | â˜ |
| ä¿¡æ¯å®Œå–„ | é¦–æ¬¡ç™»å½•å | è·³è½¬åˆ°ä¿¡æ¯å®Œå–„é¡µé¢ | | â˜ |
| æäº¤ä¿¡æ¯ | å¡«å†™å¹¶æäº¤ | æˆåŠŸä¿å­˜å¹¶è·³è½¬ | | â˜ |
| å†æ¬¡ç™»å½• | é€€å‡ºåå†æ¬¡ç™»å½• | ä¸å†è·³è½¬ä¿¡æ¯å®Œå–„é¡µé¢ | | â˜ |
| API æµ‹è¯• | è®¿é—® /api/wechat/login | è¿”å›æˆæƒ URL | | â˜ |

---

## æ€»ç»“

æœ¬æ‰‹å†Œæä¾›äº†å¾®ä¿¡ç™»å½•åŠŸèƒ½ä»é›¶åˆ°éƒ¨ç½²çš„æ¯ä¸€ä¸ªè¯¦ç»†æ“ä½œæ­¥éª¤ã€‚æŒ‰ç…§æœ¬æ‰‹å†Œçš„æ­¥éª¤æ“ä½œï¼Œæ‚¨å¯ä»¥æˆåŠŸå®Œæˆå¾®ä¿¡ç™»å½•åŠŸèƒ½çš„éƒ¨ç½²ã€‚

**å…³é”®ç‚¹å›é¡¾ï¼š**

1. âœ… ç”³è¯·å¾®ä¿¡å¼€æ”¾å¹³å°è´¦å·éœ€è¦ä¼ä¸šè®¤è¯
2. âœ… AppID å’Œ AppSecret éœ€è¦å¦¥å–„ä¿ç®¡
3. âœ… æˆæƒå›è°ƒåŸŸåªå¡«åŸŸåï¼Œä¸å«åè®®å’Œè·¯å¾„
4. âœ… å›è°ƒåœ°å€å¿…é¡»ä¸æˆæƒå›è°ƒåŸŸçš„åŸŸåä¸€è‡´
5. âœ… æ•°æ®åº“éœ€è¦æ·»åŠ å¾®ä¿¡ç›¸å…³å­—æ®µ
6. âœ… å‰åç«¯éƒ½éœ€è¦é…ç½®æ­£ç¡®çš„å›è°ƒåœ°å€
7. âœ… ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ HTTPS
8. âœ… é…ç½®åéœ€è¦é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ

**ä¸‹ä¸€æ­¥ï¼š**

1. æŒ‰ç…§æœ¬æ‰‹å†Œçš„æ­¥éª¤é€æ­¥æ“ä½œ
2. æ¯å®Œæˆä¸€ä¸ªæ­¥éª¤è¿›è¡ŒéªŒè¯
3. é‡åˆ°é—®é¢˜æŸ¥é˜…ç›¸å…³ç« èŠ‚
4. å®Œæˆåä½¿ç”¨æµ‹è¯•ç”¨ä¾‹æ¸…å•éªŒè¯

ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰
